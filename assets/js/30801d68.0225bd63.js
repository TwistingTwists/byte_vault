"use strict";(self.webpackChunkbytevault=self.webpackChunkbytevault||[]).push([[103],{1509:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>m});var s=a(6493),n=a(4848),r=a(8453),i=a(4252),l=a(801);const o={slug:"database-isolation-phantom-read",title:"DB-008: Phantom Read",date:new Date("2025-06-07T00:01:00.000Z"),authors:["abeeshake"],tags:["databases","transactions"]},d=void 0,c={authorsImageUrls:[void 0]},m=[];function g(e){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.A,{toc:m}),"\n","\n",(0,n.jsx)(l.A,{})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(g,{...e})}):g()}},4252:(e,t,a)=>{a.d(t,{A:()=>i});a(6540);var s=a(5195);const n={tableOfContentsInline:"tableOfContentsInline_prmo"};var r=a(4848);function i(e){let{toc:t,minHeadingLevel:a,maxHeadingLevel:i}=e;return(0,r.jsx)("div",{className:n.tableOfContentsInline,children:(0,r.jsx)(s.A,{toc:t,minHeadingLevel:a,maxHeadingLevel:i,className:"table-of-contents",linkClassName:null})})}},5195:(e,t,a)=>{a.d(t,{A:()=>p});var s=a(6540),n=a(6342);function r(e){const t=e.map((e=>({...e,parentIndex:-1,children:[]}))),a=Array(7).fill(-1);t.forEach(((e,t)=>{const s=a.slice(2,e.level);e.parentIndex=Math.max(...s),a[e.level]=t}));const s=[];return t.forEach((e=>{const{parentIndex:a,...n}=e;a>=0?t[a].children.push(n):s.push(n)})),s}function i(e){let{toc:t,minHeadingLevel:a,maxHeadingLevel:s}=e;return t.flatMap((e=>{const t=i({toc:e.children,minHeadingLevel:a,maxHeadingLevel:s});return function(e){return e.level>=a&&e.level<=s}(e)?[{...e,children:t}]:t}))}function l(e){const t=e.getBoundingClientRect();return t.top===t.bottom?l(e.parentNode):t}function o(e,t){let{anchorTopOffset:a}=t;const s=e.find((e=>l(e).top>=a));if(s){return function(e){return e.top>0&&e.bottom<window.innerHeight/2}(l(s))?s:e[e.indexOf(s)-1]??null}return e[e.length-1]??null}function d(){const e=(0,s.useRef)(0),{navbar:{hideOnScroll:t}}=(0,n.p)();return(0,s.useEffect)((()=>{e.current=t?0:document.querySelector(".navbar").clientHeight}),[t]),e}function c(e){const t=(0,s.useRef)(void 0),a=d();(0,s.useEffect)((()=>{if(!e)return()=>{};const{linkClassName:s,linkActiveClassName:n,minHeadingLevel:r,maxHeadingLevel:i}=e;function l(){const e=function(e){return Array.from(document.getElementsByClassName(e))}(s),l=function(e){let{minHeadingLevel:t,maxHeadingLevel:a}=e;const s=[];for(let n=t;n<=a;n+=1)s.push(`h${n}.anchor`);return Array.from(document.querySelectorAll(s.join()))}({minHeadingLevel:r,maxHeadingLevel:i}),d=o(l,{anchorTopOffset:a.current}),c=e.find((e=>d&&d.id===function(e){return decodeURIComponent(e.href.substring(e.href.indexOf("#")+1))}(e)));e.forEach((e=>{!function(e,a){a?(t.current&&t.current!==e&&t.current.classList.remove(n),e.classList.add(n),t.current=e):e.classList.remove(n)}(e,e===c)}))}return document.addEventListener("scroll",l),document.addEventListener("resize",l),l(),()=>{document.removeEventListener("scroll",l),document.removeEventListener("resize",l)}}),[e,a])}var m=a(8774),g=a(4848);function h(e){let{toc:t,className:a,linkClassName:s,isChild:n}=e;return t.length?(0,g.jsx)("ul",{className:n?void 0:a,children:t.map((e=>(0,g.jsxs)("li",{children:[(0,g.jsx)(m.A,{to:`#${e.id}`,className:s??void 0,dangerouslySetInnerHTML:{__html:e.value}}),(0,g.jsx)(h,{isChild:!0,toc:e.children,className:a,linkClassName:s})]},e.id)))}):null}const u=s.memo(h);function p(e){let{toc:t,className:a="table-of-contents table-of-contents__left-border",linkClassName:l="table-of-contents__link",linkActiveClassName:o,minHeadingLevel:d,maxHeadingLevel:m,...h}=e;const p=(0,n.p)(),x=d??p.tableOfContents.minHeadingLevel,b=m??p.tableOfContents.maxHeadingLevel,y=function(e){let{toc:t,minHeadingLevel:a,maxHeadingLevel:n}=e;return(0,s.useMemo)((()=>i({toc:r(t),minHeadingLevel:a,maxHeadingLevel:n})),[t,a,n])}({toc:t,minHeadingLevel:x,maxHeadingLevel:b});return c((0,s.useMemo)((()=>{if(l&&o)return{linkClassName:l,linkActiveClassName:o,minHeadingLevel:x,maxHeadingLevel:b}}),[l,o,x,b])),(0,g.jsx)(u,{toc:y,className:a,linkClassName:l,...h})}},801:(e,t,a)=>{a.d(t,{A:()=>d});var s=a(6540),n=a(4848);const r=[{id:1,name:"Alice",department:"Engineering",salary:9e4},{id:2,name:"Bob",department:"Sales",salary:75e3},{id:4,name:"David",department:"Engineering",salary:85e3}],i=[{step:2,text:"T1 performs its first scan for employees in the 'Engineering' department. It finds Alice and David.",autoPause:!0,isCritical:!1,highlight:{timelineOps:[{transaction:"T1",time:10}],currentOpPanel:!0,scanLogEntries:["T1_s1_10"],dbTableRows:{employees:[r.find((e=>1===e.id)),r.find((e=>4===e.id))].map((e=>e.id))}}},{step:4,text:"T2 inserts a new employee, 'Charlie', into the 'Engineering' department. This insert is currently uncommitted.",autoPause:!0,isCritical:!1,highlight:{uncommittedInserts:["i1"],timelineOps:[{transaction:"T2",time:25}],currentOpPanel:!0}},{step:5,text:"T2 commits. 'Charlie' (id:3) is now a permanent part of the 'Engineering' department in the database.",autoPause:!0,isCritical:!1,highlight:{dbTableRows:{employees:[3]},timelineOps:[{transaction:"T2",time:35}],currentOpPanel:!0}},{step:6,text:"\u26a0\ufe0f PHANTOM READ! T1 performs its second scan for 'Engineering' employees. This time, it sees 'Charlie' (id:3), who wasn't present during the first scan. This new, unexpected row is a 'phantom'. The set of rows has changed.",autoPause:!0,isCritical:!0,highlight:{timelineOps:[{transaction:"T1",time:50},{transaction:"T1",time:10}],currentOpPanel:!0,scanLogEntries:["T1_s2_50","T1_s1_10"],dbTableRows:{employees:[r.find((e=>1===e.id))?.id,r.find((e=>4===e.id))?.id,3].filter((e=>void 0!==e))},phantomRowId:3}},{step:7,text:"T1 commits. The phantom read has occurred. If T1's logic depended on a stable set of rows (e.g., calculating total salary twice), it might now be inconsistent.",autoPause:!1,isCritical:!1,highlight:{timelineOps:[{transaction:"T1",time:60}],currentOpPanel:!0}}],l=()=>{const[e,t]=(0,s.useState)(!1),[a,l]=(0,s.useState)(!1),[o,d]=(0,s.useState)(0),[c,m]=(0,s.useState)(0),[g,h]=(0,s.useState)({tables:{employees:JSON.parse(JSON.stringify(r))}}),[u,p]=(0,s.useState)({}),[x,b]=(0,s.useState)({}),[y,f]=(0,s.useState)([]),[v,j]=(0,s.useState)({text:"",autoPause:!1,isCritical:!1,highlight:{},step:null}),N=(0,s.useRef)(null),w={T1:{color:"#22c55e",operations:[{type:"begin",time:0},{type:"scan",time:10,table:"employees",predicate:e=>"Engineering"===e.department,scanId:"s1"},{type:"scan",time:50,table:"employees",predicate:e=>"Engineering"===e.department,scanId:"s2"},{type:"commit",time:60}]},T2:{color:"#f59e0b",operations:[{type:"begin",time:5},{type:"insert",time:25,table:"employees",data:{id:3,name:"Charlie",department:"Engineering",salary:8e4},insertId:"i1"},{type:"commit",time:35}]}},k=Math.max(...Object.values(w).flatMap((e=>e.operations.map((e=>e.time)))))+10,C=(()=>{const e=[];return Object.entries(w).forEach((t=>{let[a,s]=t;s.operations.forEach((t=>{e.push({...t,transaction:a,color:s.color})}))})),e.sort(((e,t)=>e.time-t.time))})(),T=t=>{if(0===t)d(0),h({tables:{employees:JSON.parse(JSON.stringify(r))}}),p({}),b({}),f([]),j({text:"",autoPause:!1,isCritical:!1,highlight:{},step:null});else{const s=C[t-1];d(s.time);const n=(e=>{const t=C.slice(0,e);let a={tables:{employees:JSON.parse(JSON.stringify(r))}},s={},n={},i=[];const l={};return t.forEach((e=>{const t=e.transaction;if(l[t]||(l[t]={status:"active",pendingInsertIds:[]}),"insert"===e.type)"active"===l[t].status&&(s[e.insertId]={transaction:t,table:e.table,data:e.data,color:e.color},l[t].pendingInsertIds.push(e.insertId));else if("scan"===e.type){const s=(a.tables[e.table]||[]).filter((t=>e.predicate(t)));n[`${t}_${e.scanId}_${e.time}`]={transaction:t,scanId:e.scanId,time:e.time,table:e.table,predicateString:e.predicate.toString(),results:JSON.parse(JSON.stringify(s)),color:e.color}}else"commit"===e.type?"active"===l[t].status&&(l[t].pendingInsertIds.forEach((e=>{const t=s[e];t&&(a.tables[t.table]||(a.tables[t.table]=[]),a.tables[t.table].push(t.data),a.tables[t.table].sort(((e,t)=>e.id-t.id)),delete s[e])})),l[t].status="committed",l[t].pendingInsertIds=[]):"abort"===e.type&&"active"===l[t].status&&(l[t].pendingInsertIds.forEach((e=>{delete s[e]})),l[t].status="aborted",l[t].pendingInsertIds=[]);i.push(e)})),{dbState:a,uncommittedInserts:s,scanLog:n,completed:i}})(t);h(n.dbState),p(n.uncommittedInserts),b(n.scanLog),f(n.completed);const o=i.find((e=>e.step===t));o?(j({...o,step:t}),o.autoPause&&e&&!a&&l(!0)):null!==v.step&&v.step!==t&&j({text:"",autoPause:!1,isCritical:!1,highlight:{},step:null})}};(0,s.useEffect)((()=>{if(e&&!a){const e=setInterval((()=>{m((e=>{if(e>=C.length)return t(!1),l(!1),e;const a=e+1;return T(a),a}))}),1e3);return()=>clearInterval(e)}}),[e,a]);const I=()=>{l(!1),v.autoPause&&v.step===c&&j((e=>({...e,autoPause:!1})))},L=e=>e/k*95,S=0===c||c>C.length?null:C[c-1],O=S&&v.highlight?.currentOpPanel&&v.step===c;return(0,n.jsxs)("div",{className:"w-full min-h-screen bg-gray-50 dark:bg-gray-900 p-6 font-sans",children:[(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-800 dark:text-gray-100 mb-2",children:"Transaction Timeline: Phantom Read Anomaly"}),(0,n.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"T1 scans for 'Engineering' employees. T2 inserts and commits a new 'Engineering' employee. T1's subsequent identical scan finds this new 'phantom' row."})]}),(0,n.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsx)("button",{onClick:()=>{m(0),t(!0),l(!1),j({text:"",autoPause:!1,isCritical:!1,highlight:{},step:null}),m((e=>(1<=C.length&&T(1),1)))},disabled:e&&!a,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400",children:e&&!a?"Running...":e&&a?"Paused":"Auto Run"}),e&&(a?(0,n.jsx)("button",{onClick:I,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:"Resume"}):(0,n.jsx)("button",{onClick:()=>l(!0),className:"px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700",children:"Pause"})),(0,n.jsx)("button",{onClick:()=>{t(!1),l(!1),m(0),T(0)},className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Reset"}),(0,n.jsxs)("div",{className:"border-l border-gray-300 dark:border-gray-600 pl-3 flex gap-2",children:[(0,n.jsx)("button",{onClick:()=>{if(c>0){const e=c-1;m(e),T(e)}},disabled:0===c||e&&!a,className:"px-3 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:bg-gray-400",children:"\u2190 Step"}),(0,n.jsx)("button",{onClick:()=>{if(c<C.length){const e=c+1;m(e),T(e)}},disabled:c>=C.length||e&&!a,className:"px-3 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:bg-gray-400",children:"Step \u2192"})]})]}),(0,n.jsxs)("div",{className:"text-right",children:[(0,n.jsxs)("div",{className:"text-lg font-mono dark:text-gray-100",children:["Step: ",c," / ",C.length]}),(0,n.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Time: ",o]})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm",children:[(0,n.jsxs)("div",{className:"p-3 rounded "+(v.highlight?.dbTableRows?"ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-900/70":"bg-gray-100 dark:bg-gray-700"),children:[(0,n.jsx)("h3",{className:"font-semibold mb-2 dark:text-gray-200",children:"Committed Database State"}),Object.entries(g.tables||{}).map((e=>{let[t,a]=e;return(0,n.jsxs)("div",{className:"mb-2",children:[(0,n.jsx)("h4",{className:"font-medium text-sm dark:text-gray-300 capitalize",children:t}),0===a.length?(0,n.jsx)("p",{className:"text-xs italic dark:text-gray-400",children:"No rows"}):(0,n.jsxs)("table",{className:"w-full text-xs table-auto",children:[(0,n.jsx)("thead",{className:"text-left dark:text-gray-300",children:(0,n.jsx)("tr",{children:a.length>0&&Object.keys(a[0]).map((e=>(0,n.jsx)("th",{className:"p-1 border-b dark:border-gray-600 font-normal",children:e},e)))})}),(0,n.jsx)("tbody",{className:"dark:text-gray-100",children:a.map(((e,a)=>{const s=v.highlight?.dbTableRows?.[t]?.includes(e.id),r=v.highlight?.phantomRowId===e.id&&v.step===c;return(0,n.jsx)("tr",{className:`${s?"bg-blue-100 dark:bg-blue-800":""} ${r?"font-bold text-red-600 dark:text-red-400 ring-1 ring-red-500":""}`,children:Object.values(e).map(((e,t)=>(0,n.jsx)("td",{className:"p-1 border-b dark:border-gray-700",children:String(e)},t)))},a)}))})]})]},t)}))]}),(0,n.jsxs)("div",{className:"p-3 rounded "+(v.highlight?.uncommittedInserts?.length>0?"ring-2 ring-yellow-500 bg-yellow-50 dark:bg-yellow-900/80":"bg-yellow-100 dark:bg-yellow-900/50"),children:[(0,n.jsx)("h3",{className:"font-semibold mb-2 dark:text-gray-200",children:"Uncommitted Inserts"}),Object.entries(u).map((e=>{let[t,a]=e;return(0,n.jsxs)("div",{className:"font-mono text-xs p-1 my-0.5 rounded "+(v.highlight?.uncommittedInserts?.includes(t)?"ring-1 ring-red-500 bg-red-100 dark:bg-red-800":""),children:[(0,n.jsxs)("span",{style:{color:a.color},children:[a.transaction," (",t,")"]}),": INSERT into ",a.table,(0,n.jsx)("pre",{className:"text-xxs whitespace-pre-wrap dark:text-gray-300",children:JSON.stringify(a.data,null,1)})]},t)})),0===Object.keys(u).length&&(0,n.jsx)("div",{className:"text-gray-500 dark:text-gray-400 italic",children:"None"})]}),(0,n.jsxs)("div",{className:"p-3 rounded "+(v.highlight?.scanLogEntries?.length>0?"ring-2 ring-green-500 bg-green-50 dark:bg-green-900/70":"bg-green-100 dark:bg-green-900/50"),children:[(0,n.jsx)("h3",{className:"font-semibold mb-2 dark:text-gray-200",children:"Scan Log"}),Object.entries(x).map((e=>{let[t,a]=e;return(0,n.jsxs)("div",{className:"text-xs p-1 my-0.5 rounded "+(v.highlight?.scanLogEntries?.includes(t)?"ring-1 ring-teal-500 bg-teal-100 dark:bg-teal-800":""),children:[(0,n.jsxs)("div",{className:"font-mono",children:[(0,n.jsxs)("span",{style:{color:a.color},children:[a.transaction," (",a.scanId,"@",a.time,")"]})," on ",a.table]}),(0,n.jsxs)("div",{className:"text-xxs dark:text-gray-300",children:["Predicate: ",a.predicateString]}),(0,n.jsxs)("div",{className:"text-xxs dark:text-gray-300",children:["Results: ",a.results.length," rows ",v.highlight?.scanLogEntries?.includes(t)&&a.results.length>0&&` = ${a.results.map((e=>e.name||e.id)).join(", ")}`]})]},t)})),0===Object.keys(x).length&&(0,n.jsx)("div",{className:"text-gray-500 dark:text-gray-400 italic",children:"No scans yet"})]}),(0,n.jsxs)("div",{className:"p-3 rounded "+(O?"ring-2 ring-purple-500 bg-purple-50 dark:bg-purple-900/70":"bg-blue-100 dark:bg-gray-700"),children:[(0,n.jsx)("h3",{className:"font-semibold mb-2 dark:text-gray-200",children:"Current Operation"}),S?(0,n.jsxs)("div",{className:"font-mono text-sm "+(O?"font-bold text-purple-700 dark:text-purple-300":"dark:text-gray-100"),children:[(0,n.jsx)("span",{style:{color:S.color},children:S.transaction}),": ",S.type.toUpperCase(),S.table&&` on ${S.table}`,S.scanId&&` (ID: ${S.scanId})`,S.insertId&&` (ID: ${S.insertId})`,"scan"===S.type&&(0,n.jsxs)("div",{className:"text-xs dark:text-gray-300",children:["Predicate: ",S.predicate.toString()]}),"insert"===S.type&&(0,n.jsx)("pre",{className:"text-xs whitespace-pre-wrap dark:text-gray-300",children:JSON.stringify(S.data,null,1)})]}):(0,n.jsx)("div",{className:"text-gray-500 dark:text-gray-400 italic",children:"None"})]})]})]}),v.text&&(0,n.jsxs)("div",{className:"my-6 p-4 rounded-lg border-2 transition-all duration-300 ease-in-out "+(v.isCritical?"border-red-400 dark:border-red-500 bg-red-50 dark:bg-red-900/30 shadow-lg scale-105":"border-blue-400 dark:border-blue-500 bg-blue-50 dark:bg-blue-900/30"),children:[(0,n.jsxs)("h3",{className:"text-lg font-semibold mb-2 "+(v.isCritical?"text-red-700 dark:text-red-300":"text-blue-700 dark:text-blue-300"),children:["\ud83d\udd0d Insight at Step ",v.step," (Time: ",C[v.step-1]?.time,")"]}),(0,n.jsx)("p",{className:"text-sm "+(v.isCritical?"text-red-600 dark:text-red-400":"text-blue-600 dark:text-blue-400"),children:v.text}),a&&v.autoPause&&v.step===c&&(0,n.jsx)("button",{onClick:I,className:"mt-3 px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600 text-sm",children:"Continue"})]}),(0,n.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",ref:N,children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-4 dark:text-gray-100",children:"Transaction Timelines"}),(0,n.jsxs)("div",{className:"relative mb-6 pt-3",children:[(0,n.jsx)("div",{className:"absolute top-4 left-0 right-0 h-px bg-gray-300 dark:bg-gray-600"}),(0,n.jsx)("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-2 px-[2.5%] w-[95%]",children:Array.from({length:Math.floor(k/10)+1},((e,t)=>{const a=10*t;return a>k-5?null:(0,n.jsxs)("div",{className:"relative flex flex-col items-center",children:[(0,n.jsx)("div",{className:"absolute w-px h-2 bg-gray-300 dark:bg-gray-600 -top-2"}),(0,n.jsx)("div",{children:a})]},t)}))}),(e||c>0)&&(0,n.jsx)("div",{className:"absolute top-[6px] w-0.5 h-6 bg-red-500 transition-all duration-200 ease-linear z-20",style:{left:`${L(o)}%`},children:(0,n.jsx)("div",{className:"absolute -top-2 -left-[7px] w-3 h-3 bg-red-500 rounded-full border-2 border-white dark:border-gray-800 shadow-md"})})]}),(0,n.jsx)("div",{className:"space-y-6",children:Object.entries(w).map((e=>{let[t,a]=e;return(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsxs)("div",{className:"flex items-center mb-2",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full mr-3 flex-shrink-0",style:{backgroundColor:a.color}}),(0,n.jsx)("h3",{className:"text-lg font-semibold dark:text-gray-100",children:t})]}),(0,n.jsxs)("div",{className:"relative h-8 bg-gray-100 dark:bg-gray-700 rounded",children:[(0,n.jsx)("div",{className:"absolute top-0 left-0 h-full rounded opacity-30",style:{backgroundColor:a.color,width:`${L(a.operations[a.operations.length-1].time)}%`}}),a.operations.map(((e,s)=>{const r=((e,t)=>y.some((a=>a.time===e.time&&a.transaction===t&&a.type===e.type)))(e,t),i=v.highlight?.timelineOps?.some((a=>a.transaction===t&&a.time===e.time))&&null!==v.step;let l=e.type.charAt(0).toUpperCase();"scan"===e.type?l="S":"insert"===e.type&&(l="I");let o=e.type.toUpperCase();if(e.table&&(o+=` ${e.table}`),e.scanId&&(o+=` (ID:${e.scanId})`),e.insertId&&(o+=` (ID:${e.insertId})`),"scan"===e.type&&r){const a=`${t}_${e.scanId}_${e.time}`,s=x[a];s&&(o+=` - Found ${s.results.length} rows`)}return"insert"===e.type&&e.data&&(o+=` - Data: ${e.data.name||e.data.id}`),(0,n.jsxs)("div",{className:`absolute top-0.5 w-7 h-7 rounded-full border-2 flex items-center justify-center text-xs font-bold transition-all duration-300 group\n                        ${r?"bg-white dark:bg-gray-200 shadow-lg scale-105":"bg-gray-200 dark:bg-gray-600 opacity-70"}\n                        ${i?"ring-2 ring-offset-1 ring-red-500 scale-110 z-10":""}\n                      `,style:{left:`calc(${L(e.time)}% - 18px)`,borderColor:a.color,color:r?a.color:"#6b7280"},title:o,children:[l,r&&(0,n.jsxs)("div",{className:"absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2 \n                                        bg-black text-white px-2 py-1 rounded text-xs whitespace-nowrap z-30\n                                        transition-opacity duration-200 opacity-0 group-hover:opacity-100 pointer-events-none",children:[o,(0,n.jsx)("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-black"})]})]},`${t}-${e.type}-${e.time}-${s}`)}))]})]},t)}))}),(0,n.jsxs)("div",{className:"mt-8 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,n.jsx)("h4",{className:"font-semibold mb-2 dark:text-gray-100",children:"Legend"}),(0,n.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-x-4 gap-y-2 text-sm dark:text-gray-300",children:[{char:"B",desc:"Begin"},{char:"S",desc:"Scan (Range Query)"},{char:"I",desc:"Insert"},{char:"C",desc:"Commit"},{char:"A",desc:"Abort"}].map((e=>(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"w-6 h-6 rounded-full border-2 border-gray-500 dark:border-gray-400 bg-white dark:bg-gray-700 flex items-center justify-center text-xs font-bold text-gray-700 dark:text-gray-200",children:e.char}),(0,n.jsx)("span",{children:e.desc})]},e.char)))})]})]}),(0,n.jsxs)("div",{className:"mt-6 bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:[(0,n.jsx)("h3",{className:"font-semibold text-yellow-800 dark:text-yellow-200 mb-2",children:"Understanding Phantom Reads"}),(0,n.jsxs)("p",{className:"text-yellow-700 dark:text-yellow-300 text-sm mb-3",children:["A ",(0,n.jsx)("strong",{children:"Phantom Read"}),' occurs when a transaction executes a range query (e.g., "find all employees in Engineering") twice, and the set of rows returned by the second query is different from the first. This happens because another transaction has inserted or deleted rows that match the query\'s criteria and committed those changes in between the two queries of the first transaction. The newly appeared (or disappeared) rows are called "phantoms."']}),(0,n.jsxs)("div",{className:"bg-yellow-100 dark:bg-yellow-900/50 p-3 rounded text-sm mt-2",children:[(0,n.jsx)("h4",{className:"font-semibold mb-1 dark:text-yellow-100",children:"Key Observation Points:"}),(0,n.jsxs)("ul",{className:"text-xs space-y-1 list-disc list-inside text-yellow-700 dark:text-yellow-300",children:[(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"Step 2:"})," T1's first scan of 'Engineering' employees finds Alice and David."]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"Step 4 & 5:"})," T2 inserts 'Charlie' into 'Engineering' and commits this change."]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"Step 6:"})," T1's second scan of 'Engineering' employees now finds Alice, David, AND 'Charlie'. 'Charlie' is the phantom row."]}),(0,n.jsx)("li",{children:"This anomaly can lead to inconsistencies if T1 was performing calculations or making decisions based on the assumption that the set of rows matching its criteria would not change during its execution."}),(0,n.jsx)("li",{children:"Phantom reads are typically prevented by higher isolation levels like Serializable, or by specific locking strategies (e.g., predicate locks, though not widely implemented, or careful range locking)."})]})]})]})]})};var o=a(5294);const d=()=>(0,n.jsx)(o.A,{title:"Phantom Read Visualization",children:(0,n.jsx)(l,{})})},5294:(e,t,a)=>{a.d(t,{A:()=>i});var s=a(6540),n=a(961),r=a(4848);const i=e=>{let{children:t,title:a}=e;const[i,l]=(0,s.useState)(!1),[o,d]=(0,s.useState)(null);(0,s.useEffect)((()=>{const e=document.createElement("div");return e.style.position="relative",document.body.appendChild(e),d(e),()=>{document.body.removeChild(e)}}),[]),(0,s.useEffect)((()=>(document.body.style.overflow=i?"hidden":"",()=>{document.body.style.overflow=""})),[i]);const c=()=>{l(!i)},m=(0,r.jsxs)("div",{className:"relative",children:[t,(0,r.jsxs)("button",{onClick:c,className:"absolute right-4 top-4 z-50 flex items-center gap-2 px-3 py-2 rounded-lg  bg-blue-600 hover:bg-blue-700 text-white transition-colors duration-200",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M3 4a1 1 0 011-1h4a1 1 0 010 2H5.414l2.293 2.293a1 1 0 11-1.414 1.414L4 6.414V8a1 1 0 01-2 0V4zm14 0a1 1 0 00-1-1h-4a1 1 0 100 2h2.586l-2.293 2.293a1 1 0 001.414 1.414L16 6.414V8a1 1 0 102 0V4zM3 16a1 1 0 001 1h4a1 1 0 100-2H5.414l2.293-2.293a1 1 0 00-1.414-1.414L4 13.586V12a1 1 0 10-2 0v4zm14 0a1 1 0 01-1 1h-4a1 1 0 110-2h2.586l-2.293-2.293a1 1 0 011.414-1.414L16 13.586V12a1 1 0 112 0v4z",clipRule:"evenodd"})}),"Full Screen"]})]}),g=o&&(0,n.createPortal)((0,r.jsx)("div",{className:"fixed inset-0 z-[9999] bg-white overflow-auto",children:(0,r.jsxs)("div",{className:"p-8",children:[a&&(0,r.jsx)("h2",{className:"text-2xl font-bold mb-4",children:a}),t,(0,r.jsxs)("button",{onClick:c,className:"fixed right-4 top-4 z-[10000] flex items-center gap-2 px-3 py-2 rounded-lg  bg-gray-200 hover:bg-gray-300 text-gray-800 transition-colors duration-200",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M3 4a1 1 0 011-1h4a1 1 0 010 2H6.414l2.293 2.293a1 1 0 11-1.414 1.414L5 6.414V8a1 1 0 01-2 0V4zm14 0a1 1 0 00-1-1h-4a1 1 0 100 2h1.586l-2.293 2.293a1 1 0 001.414 1.414L15 6.414V8a1 1 0 102 0V4zM3 16a1 1 0 001 1h4a1 1 0 100-2H6.414l2.293-2.293a1 1 0 00-1.414-1.414L5 13.586V12a1 1 0 10-2 0v4zm14 0a1 1 0 01-1 1h-4a1 1 0 110-2h1.586l-2.293-2.293a1 1 0 011.414-1.414L15 13.586V12a1 1 0 112 0v4z",clipRule:"evenodd"})}),"Exit Full Screen"]})]})}),o);return(0,r.jsxs)(r.Fragment,{children:[m,i&&g]})}},8453:(e,t,a)=>{a.d(t,{R:()=>i,x:()=>l});var s=a(6540);const n={},r=s.createContext(n);function i(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:i(e.components),s.createElement(r.Provider,{value:t},e.children)}},6493:e=>{e.exports=JSON.parse('{"permalink":"/byte_vault/database-isolation-phantom-read","source":"@site/blog/2025-04-23-db-isolation-008-phantom-reads.mdx","title":"DB-008: Phantom Read","description":"","date":"2025-06-07T00:01:00.000Z","tags":[{"inline":false,"label":"Databases","permalink":"/byte_vault/tags/databases","description":"Database systems"},{"inline":false,"label":"Transactions","permalink":"/byte_vault/tags/transactions","description":"Transactions"}],"readingTime":0.08,"hasTruncateMarker":false,"authors":[{"name":"Abhishek Tripathi","title":"Curiosity brings awareness.","url":"https://github.com/TwistingTwists","page":{"permalink":"/byte_vault/authors/abeeshake"},"socials":{"x":"https://x.com/twistin456","github":"https://github.com/TwistingTwists"},"imageURL":"https://github.com/TwistingTwists.png","key":"abeeshake"}],"frontMatter":{"slug":"database-isolation-phantom-read","title":"DB-008: Phantom Read","date":"2025-06-07T00:01:00.000Z","authors":["abeeshake"],"tags":["databases","transactions"]},"unlisted":false,"prevItem":{"title":"DB-010: Dual Anomalies","permalink":"/byte_vault/database-isolation-visualised-dual-anomalies"},"nextItem":{"title":"DB-007: MVCC Visibility Rules","permalink":"/byte_vault/database-isolation-visualised-mvcc-visibility-rules"}}')}}]);