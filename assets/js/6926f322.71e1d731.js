"use strict";(self.webpackChunkbytevault=self.webpackChunkbytevault||[]).push([[7049],{4934:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>d,contentTitle:()=>l,default:()=>m,frontMatter:()=>o,metadata:()=>r,toc:()=>c});var r=a(1222),n=a(4848),s=a(8453),i=a(1096);a(64);const o={slug:"database-isolation-visualised-dirty-writes",title:"Database Isolation (dirty writes)",date:new Date("2025-04-22T00:00:00.000Z"),authors:["abeeshake"],tags:["databases","transactions"],draft:!1},l=void 0,d={authorsImageUrls:[void 0]},c=[{value:"Understanding Dirty Writes: A Database Isolation Problem",id:"understanding-dirty-writes-a-database-isolation-problem",level:2},{value:"What is a Dirty Write?",id:"what-is-a-dirty-write",level:3}];function u(e){const t={h2:"h2",h3:"h3",p:"p",strong:"strong",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.A,{toc:c}),"\n","\n",(0,n.jsx)(t.h2,{id:"understanding-dirty-writes-a-database-isolation-problem",children:"Understanding Dirty Writes: A Database Isolation Problem"}),"\n",(0,n.jsx)(t.h3,{id:"what-is-a-dirty-write",children:"What is a Dirty Write?"}),"\n",(0,n.jsxs)(t.p,{children:["A ",(0,n.jsx)(t.strong,{children:"dirty write"})," occurs when multiple transactions try to update the same data concurrently without proper isolation,\npotentially causing one transaction to overwrite changes made by another uncommitted transaction."]}),"\n",(0,n.jsx)(t.p,{children:"This can lead to inconsistent or incorrect results in applications, especially in systems where multiple users or processes are accessing and modifying the data concurrently."})]})}function m(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(u,{...e})}):u(e)}},64:(e,t,a)=>{a.d(t,{A:()=>m});var r=a(6540);var n=a(4922),s=a(9437);class i{static generateTexture(e){const{text:t,font:a="600 18px Inter, Arial, sans-serif",fontSize:r=18,textColor:n="#fff",backgroundColor:s="rgba(17,24,39,0.92)",borderRadius:o=12,paddingX:l=24,paddingY:d=12,maxWidth:c=320}=e,u=document.createElement("canvas"),m=u.getContext("2d");m.font=a;const p=m.measureText(t),h=Math.min(p.width,c-2*l)+2*l,x=r+2*d;return u.width=h,u.height=x,m.save(),m.beginPath(),i.roundRect(m,0,0,h,x,o),m.fillStyle=s,m.fill(),m.restore(),m.save(),m.font=a,m.textBaseline="middle",m.textAlign="center",m.fillStyle=n,m.shadowColor="rgba(0,0,0,0.7)",m.shadowBlur=2,m.fillText(t,h/2,x/2,c-2*l),m.restore(),u}static roundRect(e,t,a,r,n,s){e.moveTo(t+s,a),e.lineTo(t+r-s,a),e.quadraticCurveTo(t+r,a,t+r,a+s),e.lineTo(t+r,a+n-s),e.quadraticCurveTo(t+r,a+n,t+r-s,a+n),e.lineTo(t+s,a+n),e.quadraticCurveTo(t,a+n,t,a+n-s),e.lineTo(t,a+s),e.quadraticCurveTo(t,a,t+s,a),e.closePath()}}var o=a(4848);const l=e=>{let{events:t,animationState:a,title:l="Transaction Timeline",layout:d="proportional",showConcurrencyLines:c=!0,labelStyle:u="shader",theme:m={background:"#111827",t1Color:"#06b6d4",t2Color:"#f97316",systemColor:"#6366f1",highlightColor:"#eab308"},onEventClick:p}=e;const h=(0,r.useRef)(null),x=(0,r.useRef)(null),g=(0,r.useRef)(null),b=(0,r.useRef)(null),[y,w]=(0,r.useState)(!0),f=(0,r.useRef)(new n.tBo),v=(0,r.useRef)(new n.I9Y),{currentStep:j,totalSteps:T}=a;(0,r.useEffect)((()=>{const e=setTimeout((()=>{w(!1)}),5e3);return()=>clearTimeout(e)}),[]),(0,r.useEffect)((()=>{const e=h.current;if(!e)return;const t=t=>{const a=e.getBoundingClientRect();v.current.x=(t.clientX-a.left)/a.width*2-1,v.current.y=-(t.clientY-a.top)/a.height*2+1,f.current.setFromCamera(v.current,b.current);const r=f.current.intersectObjects(g.current.children,!0).find((e=>"event"===e.object.userData?.type));e.style.cursor=r?"pointer":"default"},a=t=>{const a=e.getBoundingClientRect();v.current.x=(t.clientX-a.left)/a.width*2-1,v.current.y=-(t.clientY-a.top)/a.height*2+1,f.current.setFromCamera(v.current,b.current);const r=f.current.intersectObjects(g.current.children,!0).find((e=>"event"===e.object.userData?.type));r&&p&&p(r.object.userData.event)};return e.addEventListener("pointermove",t),e.addEventListener("click",a),()=>{e.removeEventListener("pointermove",t),e.removeEventListener("click",a)}}),[p]);const N=e=>{const t=.05,a=new n.iNn(12,t,.1),r=new n.V9B({color:m.systemColor,transparent:!0,opacity:.5}),s=new n.eaF(a,r);s.userData={type:"lane",lane:"main"},e.add(s);const i=new n.iNn(12,t,.1),o=new n.V9B({color:m.t1Color,transparent:!0,opacity:.3}),l=new n.eaF(i,o);l.position.y=2,l.userData={type:"lane",lane:"T1"},e.add(l);const d=new n.iNn(12,t,.1),c=new n.V9B({color:m.t2Color,transparent:!0,opacity:.3}),u=new n.eaF(d,c);u.position.y=-2,u.userData={type:"lane",lane:"T2"},e.add(u)},S=(e,t,a,r)=>{e.children.filter((e=>"progress"===e.userData.type)).forEach((t=>e.remove(t)));const s=e=>{for(let t=e.length-1;t>=0;t--)if(e[t].step<a)return e[t].position/r;return 0},i=t.filter((e=>"T1"===e.tx)),o=t.filter((e=>"T2"===e.tx)),l=s(i),d=s(o),c=12*l,u=new n.iNn(c,.05,.1),p=new n.V9B({color:m.t1Color,transparent:!0,opacity:.7}),h=new n.eaF(u,p);h.position.set(-(6-c/2),2,.05),h.userData={type:"progress",tx:"T1"};const x=new n.HiM(m.t1Color,3,3);x.position.set(-(6-c),2,.5),x.userData={type:"progress",tx:"T1-glow"},e.add(h),e.add(x);const g=12*d,b=new n.iNn(g,.05,.1),y=new n.V9B({color:m.t2Color,transparent:!0,opacity:.7}),w=new n.eaF(b,y);w.position.set(-(6-g/2),-2,.05),w.userData={type:"progress",tx:"T2"};const f=new n.HiM(m.t2Color,3,3);f.position.set(-(6-g),-2,.5),f.userData={type:"progress",tx:"T2-glow"},e.add(w),e.add(f)},C=(e,t,a,r)=>{e.children.filter((e=>"event"===e.userData.type||"event-glow"===e.userData.type||"event-pulse"===e.userData.type||"event-connector"===e.userData.type)).forEach((t=>e.remove(t))),t.forEach(((s,i)=>{const o=I(s,t,r);let l=0;"T1"===s.tx&&(l=2),"T2"===s.tx&&(l=-2);const d=a>s.step,c=a===s.step;let u=m.systemColor;if("T1"===s.tx&&(u=m.t1Color),"T2"===s.tx&&(u=m.t2Color),s.highlight&&(u=m.highlightColor),!d&&!c){u=`#${new n.Q1f(u).offsetHSL(0,0,-.3).getHexString()}`}const p=c?.25:.2,h=new n.Gu$(p,16,16),x=new n.V9B({color:u,transparent:!0,opacity:d||c?1:.6}),g=new n.eaF(h,x);if(g.position.set(o,l,.2),g.userData={type:"event",eventIndex:i,action:s.action,tx:s.tx,event:s},e.add(g),d||c){const t=new n.HiM(u,2,1.5);if(t.position.set(o,l,.5),t.userData={type:"event-glow",eventIndex:i},e.add(t),c){const t=new n.Gu$(.1,16,16),a=new n.V9B({color:16777215,transparent:!0,opacity:.7}),r=new n.eaF(t,a);r.position.set(o,l,.3),r.userData={type:"event-pulse",eventIndex:i,createdAt:Date.now()},e.add(r)}}if(s.tx){const t=4,a=new n.iNn(.02,t,.05),r=new n.V9B({color:u,transparent:!0,opacity:.3}),l=new n.eaF(a,r);l.position.set(o,(s.tx,0),.1),l.userData={type:"event-connector",eventIndex:i},e.add(l)}}))},D=(e,t,a,r)=>{e.children.filter((e=>"event-connector"===e.userData.type)).forEach((t=>e.remove(t))),t.forEach(((a,s)=>{if(a.tx){const i=I(a,t,r),o=4;let l=m.systemColor;"T1"===a.tx&&(l=m.t1Color),"T2"===a.tx&&(l=m.t2Color),a.highlight&&(l=m.highlightColor);const d=new n.iNn(.02,o,.05),c=new n.V9B({color:l,transparent:!0,opacity:.3}),u=new n.eaF(d,c);u.position.set(i,(a.tx,0),.1),u.userData={type:"event-connector",eventIndex:s},e.add(u)}}))},R=(e,t,a,r)=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("h3",{className:"absolute top-2 left-4 text-xl font-bold text-white mb-4 pb-2 border-b border-gray-600/50 z-10",children:r}),(0,o.jsx)("div",{className:"absolute top-1/3 left-6 -translate-y-1/2 text-sm font-medium text-cyan-400/90 px-2 py-1 rounded-md bg-cyan-950/30 border border-cyan-500/20 shadow-sm z-10",children:"T1"}),(0,o.jsx)("div",{className:"absolute top-2/3 left-6 -translate-y-1/2 text-sm font-medium text-orange-400/90 px-2 py-1 rounded-md bg-orange-950/30 border border-orange-500/20 shadow-sm z-10",children:"T2"}),e.map(((t,r)=>{const n=I(t,e,a),s="T1"===t.tx?"bottom-10":"top-10";return(0,o.jsx)("div",{className:"absolute left-0 top-1/2 transform -translate-y-1/2 z-20 pointer-events-none",style:{left:16+.68*n+"%"},children:(0,o.jsx)("div",{className:`max-w-40 whitespace-nowrap text-xs font-medium px-2.5 py-1.5 rounded-lg ${s} bg-gray-900/60 border border-gray-500/50 shadow-lg transition-all duration-300 absolute`,style:{overflow:"hidden",textOverflow:"ellipsis",transform:"translateX(-50%)",textShadow:"0 1px 3px rgba(0,0,0,0.7)"},children:t.action})},r)}))]}),k=(()=>{let e=null,t=null,a=null;return{update:(r,s,o,l,d,c)=>{for(e||(e=new n.YJl,r.add(e)),t=s,a=o;e.children.length;){const t=e.children[0];e.remove(t),t.material?.map&&t.material.map.dispose(),t.material&&t.material.dispose(),t.geometry&&t.geometry.dispose()}l.forEach((t=>{const a=d>t.step,r=d===t.step;if(!a&&!r)return;const s=I(t,l,c);let o=0;"T1"===t.tx&&(o=2),"T2"===t.tx&&(o=-2);let u=m.systemColor,p=new n.Q1f(m.systemColor);"T1"===t.tx?(u=m.t1Color,p=new n.Q1f(m.t1Color)):"T2"===t.tx&&(u=m.t2Color,p=new n.Q1f(m.t2Color)),t.highlight&&(u=m.highlightColor,p=new n.Q1f(m.highlightColor));const h=t.labelOffset||0,x=o+("T1"===t.tx?-1.5:1.5)+h,g=i.generateTexture({text:t.action,font:"600 16px Inter, Arial, sans-serif",textColor:"#fff",backgroundColor:u+"40",borderRadius:8,paddingX:12,paddingY:12,maxWidth:220}),b=2/(g.width/g.height),y=((e,t,a)=>new n.BKk({uniforms:{baseTexture:{value:e},glowColor:{value:t},glowIntensity:{value:a},time:{value:0}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n          vUv = uv;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ",fragmentShader:"\n        uniform sampler2D baseTexture;\n        uniform vec3 glowColor;\n        uniform float glowIntensity;\n        uniform float time;\n        varying vec2 vUv;\n        void main() {\n          vec4 texColor = texture2D(baseTexture, vUv);\n          gl_FragColor = texColor;\n          if (glowIntensity > 0.0) {\n            float pulseFactor = 0.5 + 0.5 * sin(time * 3.0);\n            vec3 glow = glowColor * glowIntensity * pulseFactor;\n            gl_FragColor.rgb += glow * texColor.a;\n          }\n        }\n      ",transparent:!0,side:n.$EB}))(new n.GOR(g),p,r?.4:.2),w=new n.bdM(2,b),f=new n.eaF(w,y);f.position.set(s,x,1),f.userData={eventId:t.id,animation:{pulsate:r,fade:!1}},e.add(f)}))},animate:t=>{e&&a&&e.children.forEach((e=>{const r=e;if(r.quaternion.copy(a.quaternion),r.material.uniforms&&(r.material.uniforms.time.value=t/1e3),r.userData.animation){const e=r.userData.animation;if(e.pulsate){const e=1+.1*Math.sin(t/500);r.scale.set(e,e,1)}e.fade&&(r.material.opacity=.5+.5*Math.sin(t/700))}}))}}})(),W=(()=>{let e=null,t=[],a=[];return{update:(r,s,i,o)=>{if(!c)return;for(e||(e=new n.YJl,r.add(e));e.children.length;){const t=e.children[0];e.remove(t),t.material&&t.material.dispose(),t.geometry&&t.geometry.dispose()}t=[],a=[];const l=[];s.forEach((e=>{e.concurrentWith&&e.concurrentWith.forEach((t=>{const a=s.find((e=>e.id===t));a&&(i>=e.step||i>=a.step)&&(l.some((t=>{let[r,n]=t;return r.id===a.id&&n.id===e.id||r.id===e.id&&n.id===a.id}))||l.push([e,a]))}))})),l.forEach((r=>{const[i,l]=r,d=I(i,s,o),c=I(l,s,o),u="T1"===i.tx?2:-2,p="T1"===l.tx?2:-2,h=[new n.Pq0(d,u,.2),new n.Pq0(c,p,.2)],x=(new n.LoY).setFromPoints(h),g=new n.Fvt({color:m.highlightColor,dashSize:.2,gapSize:.1,opacity:.7,transparent:!0});g.dashOffset=0;const b=new n.N1A(x,g);b.computeLineDistances(),e.add(b),t.push(b);const y=new n.Gu$(.1,8,8),w=new n.V9B({color:m.highlightColor,transparent:!0,opacity:.7}),f=new n.eaF(y,w.clone());f.position.set(d,u,.25);const v=new n.eaF(y,w.clone());v.position.set(c,p,.25),e.add(f),e.add(v),a.push(f,v)}))},animate:e=>{t.forEach((t=>{void 0!==t.material.dashOffset&&(t.material.dashOffset=.2*Math.sin(e/400))})),a.forEach((t=>{const a=1+.3*Math.abs(Math.sin(e/500));t.scale.set(a,a,a),void 0!==t.material.opacity&&(t.material.opacity=.5+.5*Math.abs(Math.sin(e/500)))}))}}})(),I=(e,t,a)=>{if("absolute"===d&&void 0!==e.timestamp){const a=V(t);return(e.timestamp-a.min)/(a.max-a.min)*12-6}return e.position/a*12-6},V=e=>{const t=e.filter((e=>void 0!==e.timestamp)).map((e=>e.timestamp));return{min:Math.min(...t),max:Math.max(...t)}};(0,r.useEffect)((()=>{if(!h.current)return;const e=new n.Z58;e.background=new n.Q1f(m.background),g.current=e;const t=new n.ubm(45,h.current.clientWidth/h.current.clientHeight,.1,1e3);t.position.z=10,b.current=t;const a=new s.JeP({antialias:!0,alpha:!0});a.setSize(h.current.clientWidth,h.current.clientHeight),a.setPixelRatio(window.devicePixelRatio),h.current.appendChild(a.domElement),x.current=a,N(e);const r=()=>{h.current&&a&&t&&(t.aspect=h.current.clientWidth/h.current.clientHeight,t.updateProjectionMatrix(),a.setSize(h.current.clientWidth,h.current.clientHeight))};window.addEventListener("resize",r);const i=r=>{requestAnimationFrame(i),k.animate(r),W.animate(r),a&&e&&t&&a.render(e,t)};return i(performance.now()),()=>{window.removeEventListener("resize",r),h.current&&a&&h.current.removeChild(a.domElement),e.clear()}}),[]),(0,r.useEffect)((()=>{g.current&&x.current&&b.current&&(S(g.current,t,j,T),C(g.current,t,j,T),D(g.current,t,j,T),"shader"===u&&k.update(g.current,x.current,b.current,t,j,T),W.update(g.current,t,j,T))}),[t,j,T,u,c,m,d]);return(0,o.jsx)("div",{className:"w-full mt-2 mb-6 px-6 py-4 bg-gray-800/90 backdrop-blur-sm rounded-lg shadow-md border border-gray-700",children:(0,o.jsx)("div",{ref:h,className:"relative h-72 bg-gray-900/50 backdrop-blur rounded-xl border border-gray-700/50 overflow-hidden px-8 py-6 mx-4 my-2 group",onMouseEnter:()=>w(!0),onMouseLeave:()=>w(!1),children:"html"!==u?null:R(t,j,T,l)})})};var d=a(4685);const c=e=>{let{animationState:t,handlePlay:a,handlePause:n,handleStep:s,handleReset:i,handleSpeedChange:l}=e;const c=(0,r.useRef)(null),u=(0,r.useRef)(null),m=(0,r.useRef)(null),p=(0,r.useRef)({play:!1,step:!1,reset:!1}),h=(e,t)=>{if(!p.current[t]){const a=e.current;if(a){const e=a.getBoundingClientRect(),r=(e.left+e.width/2)/window.innerWidth,n=(e.top+e.height/2)/window.innerHeight;(0,d.A)({particleCount:100,spread:70,origin:{x:r,y:n},colors:["#22c55e","#3b82f6","#64748b","#ef4444","#a855f7"]}),p.current[t]=!0}}};(0,r.useEffect)((()=>{0===t.currentStep&&(p.current={play:!1,step:!1,reset:!1})}),[t.currentStep]);return(0,o.jsxs)("div",{className:"w-full max-w-4xl flex flex-wrap justify-center items-center gap-3 mt-4 p-3 bg-gray-800/90 backdrop-blur-sm rounded-lg shadow-md border border-gray-700 sticky bottom-0 z-50",children:[(0,o.jsx)("button",{ref:c,onClick:()=>{h(c,"play"),a()},disabled:t.isRunning&&!t.isPaused,className:"px-5 py-2 text-base bg-blue-600 text-white font-semibold rounded-md shadow hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-all duration-150 ease-in-out relative overflow-visible",children:t.currentStep>=t.totalSteps?"Replay":t.isPaused?"Resume":"Play"}),(0,o.jsx)("button",{onClick:n,disabled:!t.isRunning||t.isPaused,className:"px-5 py-2 text-base bg-yellow-500 text-white font-semibold rounded-md shadow hover:bg-yellow-600 disabled:bg-gray-400 disabled:cursor-not-allowed transition-all duration-150",children:"Pause"}),(0,o.jsx)("button",{ref:u,onClick:()=>{h(u,"step"),s()},disabled:t.isRunning||t.currentStep>=t.totalSteps,className:"px-5 py-2 text-base bg-purple-600 text-white font-semibold rounded-md shadow hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-all duration-150",children:"Step"}),(0,o.jsx)("button",{ref:m,onClick:()=>{h(m,"reset"),i()},className:"px-5 py-2 text-base bg-red-600 text-white font-semibold rounded-md shadow hover:bg-red-700 transition-all duration-150",children:"Reset"}),(0,o.jsxs)("div",{className:"flex items-center gap-3 px-3 md:px-5 py-2 bg-gray-700/50 backdrop-blur-sm rounded-md",children:[(0,o.jsxs)("label",{htmlFor:"speed-slider",className:"text-white text-sm whitespace-nowrap",children:["Speed: x",t.speed.toFixed(1)]}),(0,o.jsx)("input",{id:"speed-slider",type:"range",min:"0.5",max:"2.5",step:"0.5",value:t.speed,onChange:l,className:"w-24 md:w-36 h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-blue-500"})]}),(0,o.jsxs)("div",{className:"hidden md:flex items-center gap-2 px-3 md:px-5 py-2 bg-gray-700/50 backdrop-blur-sm rounded-md",children:[(0,o.jsxs)("span",{className:"text-white text-sm whitespace-nowrap",children:["Progress: ",t.currentStep," / ",t.totalSteps]}),(0,o.jsx)("div",{className:"w-24 md:w-32 bg-gray-600 rounded-full h-2.5 overflow-hidden",children:(0,o.jsx)("div",{className:"bg-green-600 h-2.5 rounded-full transition-all duration-300 ease-out",style:{width:t.currentStep/t.totalSteps*100+"%"}})})]})]})},u=e=>{let{systemState:t,animationState:a,currentStatus:r,issueType:n}=e;const{dbData:s,transaction1:i,transaction2:l}=t,d=(a.currentStep,i.status),c=l.status,u=i.isDirtyRead,m=i.isDirtyWrite||l.isDirtyWrite,p=e=>{switch(e){case"idle":return"Idle";case"reading":return"Reading";case"writing":return"Writing";case"holding_read":return"Holding Read";case"holding_uncommitted_write":return"Holding Uncommitted Write";case"committed":return"Committed";case"error_dirty_read":return"DIRTY READ ERROR";case"error_dirty_write":return"DIRTY WRITE ERROR";default:return e}},h=e=>{switch(e){case"idle":return"text-gray-300";case"reading":case"holding_read":return"text-cyan-400";case"writing":case"holding_uncommitted_write":return"text-orange-400";case"committed":return"text-green-400";case"error_dirty_read":case"error_dirty_write":return"text-yellow-400";default:return"text-white"}};return(0,o.jsxs)("div",{className:"w-full mt-2 mb-6 px-6 py-4 bg-gray-800/90 backdrop-blur-sm rounded-lg shadow-md border border-gray-700",children:[(0,o.jsx)("div",{className:"flex justify-center mb-8",children:(0,o.jsxs)("div",{className:"relative bg-gray-900 rounded-lg border border-gray-600 p-6 w-full max-w-md shadow-lg",children:[(0,o.jsx)("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2 bg-blue-600 text-white px-3 py-1 rounded-md text-sm font-bold",children:"Database"}),(0,o.jsxs)("table",{className:"w-full text-white border-collapse",children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{className:"border-b border-gray-700 py-2 text-left w-1/3",children:"Key"}),(0,o.jsx)("th",{className:"border-b border-gray-700 py-2 text-left w-2/3",children:"Value"})]})}),(0,o.jsxs)("tbody",{children:[(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{className:"py-2 font-mono",children:s.key}),(0,o.jsxs)("td",{className:"py-2 font-mono flex items-center gap-2",children:[(0,o.jsx)("span",{className:"text-blue-400 whitespace-nowrap",children:s.committedValue}),(0,o.jsx)("span",{className:"text-xs text-blue-300 whitespace-nowrap",children:"(committed)"})]})]}),s.uncommittedValue&&(0,o.jsxs)("tr",{className:"bg-red-900/20",children:[(0,o.jsx)("td",{className:"py-2 font-mono",children:s.key}),(0,o.jsxs)("td",{className:"py-2 font-mono flex items-center gap-2",children:[(0,o.jsx)("span",{className:"text-red-400 whitespace-nowrap",children:s.uncommittedValue}),(0,o.jsxs)("span",{className:"text-xs text-red-300 whitespace-nowrap",children:["(uncommitted by ",s.writerTx,")"]})]})]})]})]})]})}),(0,o.jsx)("div",{className:"w-full max-w-4xl mb-4 p-4 bg-gray-800/90 backdrop-blur-sm rounded-lg shadow-md text-center border border-gray-700 mx-auto",children:(0,o.jsxs)("p",{className:"font-medium text-white text-lg leading-tight",children:[(0,o.jsx)("span",{className:"font-bold text-indigo-300",children:"Status:"})," ",r,(0,o.jsxs)("span",{className:"ml-6 text-gray-300 text-base",children:["(Step: ",a.currentStep,"/",a.totalSteps,")"]})]})}),(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,o.jsxs)("div",{className:`relative bg-gray-900 rounded-lg border ${u||m&&i.isDirtyWrite?"border-yellow-500":"border-gray-600"} p-4 shadow-lg`,children:[(0,o.jsx)("div",{className:`absolute -top-3 left-4 ${u||m&&i.isDirtyWrite?"bg-yellow-500":"bg-cyan-600"} text-white px-3 py-1 rounded-md text-sm font-bold`,children:"Transaction 1"}),(0,o.jsxs)("div",{className:"mt-3",children:[(0,o.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,o.jsx)("span",{className:"text-gray-400",children:"Status:"}),(0,o.jsx)("span",{className:`font-medium ${h(d)}`,children:p(d)})]}),i.lastReadValue&&(0,o.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,o.jsx)("span",{className:"text-gray-400",children:"Last Read:"}),(0,o.jsxs)("span",{className:"font-mono "+(u?"text-yellow-400":"text-white"),children:["'",i.lastReadValue,"'",u&&(0,o.jsx)("span",{className:"ml-1 text-xs text-yellow-300",children:"(dirty!)"})]})]}),i.lastWriteValue&&(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("span",{className:"text-gray-400",children:"Last Write:"}),(0,o.jsxs)("span",{className:"font-mono "+(i.isDirtyWrite?"text-yellow-400":"text-white"),children:["'",i.lastWriteValue,"'",i.isDirtyWrite&&(0,o.jsx)("span",{className:"ml-1 text-xs text-yellow-300",children:"(dirty!)"})]})]}),u&&"dirty-read"===n&&(0,o.jsxs)("div",{className:"mt-3 p-2 bg-yellow-900/30 border border-yellow-800 rounded text-yellow-300 text-sm",children:[(0,o.jsx)("span",{className:"font-bold",children:"\u26a0\ufe0f Dirty Read:"})," Reading uncommitted data from T2"]}),i.isDirtyWrite&&"dirty-write"===n&&(0,o.jsxs)("div",{className:"mt-3 p-2 bg-yellow-900/30 border border-yellow-800 rounded text-yellow-300 text-sm",children:[(0,o.jsx)("span",{className:"font-bold",children:"\u26a0\ufe0f Dirty Write:"})," Writing over uncommitted data from T2"]})]})]}),(0,o.jsxs)("div",{className:`relative bg-gray-900 rounded-lg border ${m&&l.isDirtyWrite?"border-yellow-500":"border-gray-600"} p-4 shadow-lg`,children:[(0,o.jsx)("div",{className:`absolute -top-3 left-4 ${m&&l.isDirtyWrite?"bg-yellow-500":"bg-orange-600"} text-white px-3 py-1 rounded-md text-sm font-bold`,children:"Transaction 2"}),(0,o.jsxs)("div",{className:"mt-3",children:[(0,o.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,o.jsx)("span",{className:"text-gray-400",children:"Status:"}),(0,o.jsx)("span",{className:`font-medium ${h(c)}`,children:p(c)})]}),l.lastReadValue&&(0,o.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,o.jsx)("span",{className:"text-gray-400",children:"Last Read:"}),(0,o.jsxs)("span",{className:"font-mono text-white",children:["'",l.lastReadValue,"'"]})]}),l.lastWriteValue&&(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("span",{className:"text-gray-400",children:"Last Write:"}),(0,o.jsxs)("span",{className:"font-mono "+(l.isDirtyWrite?"text-yellow-400":"text-white"),children:["'",l.lastWriteValue,"'",l.isDirtyWrite&&(0,o.jsx)("span",{className:"ml-1 text-xs text-yellow-300",children:"(dirty!)"})]})]}),"holding_uncommitted_write"===c&&(0,o.jsxs)("div",{className:"mt-3 p-2 bg-orange-900/30 border border-orange-800 rounded text-orange-300 text-sm",children:[(0,o.jsx)("span",{className:"font-bold",children:"\ud83d\udd12 Lock:"})," Holding write lock on '",s.key,"'"]}),l.isDirtyWrite&&"dirty-write"===n&&(0,o.jsxs)("div",{className:"mt-3 p-2 bg-yellow-900/30 border border-yellow-800 rounded text-yellow-300 text-sm",children:[(0,o.jsx)("span",{className:"font-bold",children:"\u26a0\ufe0f Dirty Write:"})," Writing over uncommitted data from T1"]})]})]})]})]})},m=()=>{const{animationState:e,setAnimationState:t,handleSpeedChange:a,resetAnimation:n,startAnimation:s,pauseAnimation:i,stepForward:d,setTotalSteps:m}=(e=>{const[t,a]=(0,r.useState)({isRunning:!1,isPaused:!1,currentStep:0,totalSteps:e,speed:1}),n=(0,r.useCallback)((e=>{a((t=>({...t,speed:parseFloat(e.target.value)})))}),[]),s=(0,r.useCallback)((()=>{a((e=>({...e,isRunning:!1,isPaused:!1,currentStep:0})))}),[]),i=(0,r.useCallback)((()=>{a((e=>({...e,isRunning:!0,isPaused:!1})))}),[]),o=(0,r.useCallback)((()=>{a((e=>({...e,isRunning:!1,isPaused:!0})))}),[]),l=(0,r.useCallback)((()=>{a((e=>({...e,currentStep:e.currentStep+1})))}),[]),d=(0,r.useCallback)((e=>{a((t=>({...t,totalSteps:e})))}),[]);return{animationState:t,setAnimationState:a,handleSpeedChange:n,resetAnimation:s,startAnimation:i,pauseAnimation:o,stepForward:l,setTotalSteps:d}})(9),{systemState:p,setSystemState:h,resetSystem:x}=((e,t)=>{const a={status:"idle",lastReadValue:null,lastWriteValue:null,isDirtyRead:!1,isDirtyWrite:!1},[n,s]=(0,r.useState)({dbData:{key:e,committedValue:t,uncommittedValue:null,writerTx:null},transaction1:{...a},transaction2:{...a}}),i=(0,r.useCallback)((()=>{s({dbData:{key:e,committedValue:t,uncommittedValue:null,writerTx:null},transaction1:{...a},transaction2:{...a}})}),[e,t]);return{systemState:n,setSystemState:s,resetSystem:i}})("account_balance","$1000"),[g,b]=(0,r.useState)("Database is in initial state"),y=(0,r.useRef)(null);(0,r.useEffect)((()=>()=>{y.current&&clearInterval(y.current)}),[]);const w=(0,r.useCallback)((()=>{const a=e.currentStep;0===a?b("Database is in initial state"):1===a?(h((e=>({...e,transaction1:{...e.transaction1,status:"idle"}}))),b("Transaction T1 begins")):2===a?(h((e=>({...e,transaction1:{...e.transaction1,status:"reading",lastReadValue:e.dbData.committedValue}}))),b("T1 reads balance=$1000")):3===a?(h((e=>({...e,transaction1:{...e.transaction1,status:"holding_read"}}))),b("T1 calculates new balance: $1000-$200=$800")):4===a?(h((e=>({...e,dbData:{...e.dbData,uncommittedValue:"$800",writerTx:"T1"},transaction1:{...e.transaction1,status:"holding_uncommitted_write",lastWriteValue:"$800"}}))),b("T1 writes balance=$800 but has not committed yet")):5===a?(h((e=>({...e,transaction2:{...e.transaction2,status:"idle"}}))),b("Transaction T2 begins")):6===a?(h((e=>({...e,transaction2:{...e.transaction2,status:"reading",lastReadValue:e.dbData.committedValue}}))),b("T2 reads the committed balance=$1000 (ignoring T1's uncommitted write)")):7===a?(h((e=>({...e,transaction2:{...e.transaction2,status:"holding_read"}}))),b("T2 calculates new balance: $1000-$300=$700")):8===a?(h((e=>({...e,dbData:{...e.dbData,uncommittedValue:"$700",writerTx:"T2"},transaction1:{...e.transaction1,isDirtyWrite:!0},transaction2:{...e.transaction2,status:"error_dirty_write",lastWriteValue:"$700",isDirtyWrite:!0}}))),b("T2 writes balance=$700, overwriting T1's uncommitted write - THIS IS A DIRTY WRITE!")):9===a&&(b("Issue Detected: T2 overwrote T1's uncommitted changes (dirty write). When T1 commits, its changes will be lost!"),i()),a<9?t((e=>({...e,currentStep:e.currentStep+1}))):i()}),[e.currentStep,t,h,i,9]);(0,r.useEffect)((()=>{if(e.isRunning&&!e.isPaused){y.current&&clearInterval(y.current);const t=1e3/e.speed;y.current=setInterval((()=>{e.currentStep<9?w():i()}),t)}else y.current&&clearInterval(y.current);return()=>{y.current&&clearInterval(y.current)}}),[e.isRunning,e.isPaused,e.speed,e.currentStep,w,9,i]);const f=(0,r.useCallback)((()=>{e.currentStep>=9&&(x(),n()),s()}),[e.currentStep,9,x,n,s]),v=(0,r.useCallback)((()=>{e.currentStep<9&&w()}),[e.currentStep,9,w]),j=(0,r.useCallback)((()=>{x(),n(),b("Database is in initial state")}),[x,n]);return(0,o.jsxs)("div",{className:"w-full max-w-4xl mx-auto mt-8 mb-20",children:[(0,o.jsx)("h2",{className:"text-2xl font-bold text-white mb-6",children:"Dirty Write Anomaly Demonstration"}),(0,o.jsxs)("div",{className:"bg-gray-800/80 backdrop-blur-sm rounded-lg border border-gray-700 p-4 mb-6 text-gray-300",children:[(0,o.jsx)("h3",{className:"text-xl font-semibold text-white mb-2",children:"What is a Dirty Write?"}),(0,o.jsx)("p",{className:"mb-3",children:"A dirty write occurs when multiple transactions try to update the same data concurrently without proper isolation, potentially causing one transaction to overwrite changes made by another uncommitted transaction."}),(0,o.jsx)("p",{children:"In this example, Transaction T1 writes a new balance but doesn't commit. Before T1 commits, Transaction T2 also writes to the same record, overwriting T1's uncommitted changes. This leads to lost updates and data inconsistency."})]}),(0,o.jsx)(l,{events:[{step:0,tx:null,action:"Initial State",position:0},{step:1,tx:"T1",action:"Begin Transaction",position:1},{step:2,tx:"T1",action:"Read balance=$1000",position:2},{step:3,tx:"T1",action:"Calculate: $1000-$200",position:3},{step:4,tx:"T1",action:"Write balance=$800",position:4},{step:5,tx:"T2",action:"Begin Transaction",position:5},{step:6,tx:"T2",action:"Read balance=$1000",position:6},{step:7,tx:"T2",action:"Calculate: $1000-$300",position:7},{step:8,tx:"T2",action:"Write balance=$700",position:8,highlight:!0},{step:9,tx:null,action:"Dirty Write Occurred!",position:9}],animationState:e}),(0,o.jsx)(u,{systemState:p,animationState:e,currentStatus:g,issueType:"dirty-write"}),(0,o.jsx)(c,{animationState:e,handlePlay:f,handlePause:i,handleStep:v,handleReset:j,handleSpeedChange:a})]})}},1222:e=>{e.exports=JSON.parse('{"permalink":"/byte_vault/database-isolation-visualised-dirty-writes","source":"@site/blog/2025-04-22-db-isolation-002.mdx","title":"Database Isolation (dirty writes)","description":"Understanding Dirty Writes: A Database Isolation Problem","date":"2025-04-22T00:00:00.000Z","tags":[{"inline":true,"label":"databases","permalink":"/byte_vault/tags/databases"},{"inline":true,"label":"transactions","permalink":"/byte_vault/tags/transactions"}],"readingTime":2.085,"hasTruncateMarker":true,"authors":[{"name":"Abhishek Tripathi","title":"Curiosity brings awareness.","url":"https://github.com/TwistingTwists","page":{"permalink":"/byte_vault/authors/abeeshake"},"socials":{"x":"https://x.com/twistin456","github":"https://github.com/TwistingTwists"},"imageURL":"https://github.com/TwistingTwists.png","key":"abeeshake"}],"frontMatter":{"slug":"database-isolation-visualised-dirty-writes","title":"Database Isolation (dirty writes)","date":"2025-04-22T00:00:00.000Z","authors":["abeeshake"],"tags":["databases","transactions"],"draft":false},"unlisted":false,"nextItem":{"title":"Database Isolation (dirty reads)","permalink":"/byte_vault/database-isolation-visualised-dirty-reads"}}')}}]);