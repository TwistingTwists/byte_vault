"use strict";(self.webpackChunkbytevault=self.webpackChunkbytevault||[]).push([[1826],{1827:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>c});var a=t(7203),n=t(4848),r=t(8453);t(5896),t(5782);const i={slug:"tokio-internals-visualised",title:"Understanding Eventloops by visualisation",date:new Date("2025-04-19T00:00:00.000Z"),authors:["abeeshake"],tags:["rust","tokio","async"],draft:!1},l="Visualizing Tokio Internals: The Journey Begins",o={authorsImageUrls:[void 0]},c=[];function d(e){const s={em:"em",p:"p",...(0,r.R)(),...e.components};return(0,n.jsxs)(s.p,{children:["This document explores the fundamental concepts behind Tokio's executor, starting with ",(0,n.jsx)(s.em,{children:"why"})," we need systems like Tokio and gradually building up the core components. We'll use descriptions of visualizations to make these ideas concrete."]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},5782:(e,s,t)=>{t.d(s,{A:()=>r});var a=t(6540),n=t(4848);const r=e=>{let{question:s,children:t}=e;const[r,i]=(0,a.useState)(!1);return(0,n.jsx)("div",{className:"my-8 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl overflow-hidden",children:(0,n.jsxs)("div",{className:"p-6 space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-start gap-4",children:[(0,n.jsx)("div",{className:"flex-shrink-0 p-3 bg-blue-100 rounded-lg",children:(0,n.jsx)("svg",{className:"w-6 h-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),(0,n.jsxs)("div",{className:"flex-grow",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"After reading this, you will be able to answer:"}),(0,n.jsx)("p",{className:"text-xl font-medium text-blue-900",children:s})]})]}),(0,n.jsx)("div",{className:`\n            transition-all duration-500 ease-in-out \n            ${r?"max-h-96 opacity-100":"max-h-0 opacity-0"}\n          `,children:(0,n.jsx)("div",{className:"pt-4 border-t border-blue-100",children:t})}),(0,n.jsx)("button",{onClick:()=>i(!r),className:" inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-blue-700 bg-blue-100 rounded-lg transition-all duration-200 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 ",children:r?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})}),"Hide Answer"]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),"Show Answer"]})})]})})}},5896:(e,s,t)=>{t.d(s,{A:()=>i});var a=t(6540),n=t(4685),r=t(4848);const i=()=>{const[e,s]=(0,a.useState)(10),[t,i]=(0,a.useState)(!1),[l,o]=(0,a.useState)(1),[c,d]=(0,a.useState)([]),[h,m]=(0,a.useState)(!1),u=(0,a.useRef)(null),[x,g]=(0,a.useState)({cpuCores:8,cpuUsage:[5,3,4,2,5,3,2,4],memoryUsage:8,threadCount:12,requestsPerSecond:0,queueSize:0,cpuAverage:0,threadCountPercentage:0,throughputPercentage:0,queuePercentage:0}),p=(0,a.useRef)(null),v=()=>{if(t){s((e=>{let s;s=e<100?5*l:e<500?20*l:Math.floor(.1*e*l);const t=e+s;return Math.min(Math.floor(t),2e3)}));const e=500/l;p.current=setTimeout(v,e)}};(0,a.useEffect)((()=>(t?p.current=setTimeout(v,500/l):p.current&&clearTimeout(p.current),()=>{p.current&&clearTimeout(p.current)})),[t,l,v]),(0,a.useEffect)((()=>{const s=(e=>{const s=e>500?1.5:e>100?1.2:1,t=Math.min(1*e,5e3),a=2*t,n=Math.min(Math.floor(a/16e3*100),100);let r=[];const i=Math.pow(e/100,1.5)*s;let l=8*Math.min(Math.floor(1*e*.5+5*i),100);for(let m=0;m<8;m++){const e=.7+.6*Math.random(),s=l/(8-m),t=Math.min(Math.floor(s*e),100);r.push(t),l-=t}let o=0;o=e<=100?.9*e:90+.2*(e-100)*Math.exp(-e/800);const c=Math.min(Math.floor(o/1.2),100),d=e<=100?Math.floor(.1*e):Math.floor(10+Math.pow(e-100,1.5)/100),h=Math.min(Math.floor(t/5e3*100),100);return{cpuCores:8,cpuUsage:r,cpuAverage:Math.floor(r.reduce(((e,s)=>e+s),0)/r.length),memoryUsage:n,threadCount:t,threadCountPercentage:h,requestsPerSecond:Math.floor(o),throughputPercentage:c,queueSize:d,queuePercentage:Math.min(Math.floor(d/1e3*100),100)}})(e);g(s),d((t=>{const a=[...t,{connections:e,cpuAverage:s.cpuAverage,memoryUsage:s.memoryUsage,threadCountPercentage:s.threadCountPercentage,throughputPercentage:s.throughputPercentage,queuePercentage:s.queuePercentage}];return a.length>100?a.slice(a.length-100):a}))}),[e]);const j=e=>e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");return(0,r.jsxs)("div",{className:"visualization-container bg-gray-100 p-6 rounded-lg shadow-md space-y-6",children:[(0,r.jsxs)("div",{className:"bg-black text-green-400 p-4 rounded font-mono text-sm h-64 overflow-y-auto",children:[(0,r.jsxs)("div",{className:"mb-2",children:[(0,r.jsx)("span",{className:"text-blue-400",children:"htop - "}),(0,r.jsx)("span",{className:"text-white",children:"Thread-Per-Connection Server"})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,r.jsx)("span",{children:"Active Connections:"}),(0,r.jsx)("span",{className:e>500?"text-red-500":e>100?"text-yellow-400":"",children:j(e)})]}),(0,r.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,r.jsx)("span",{children:"Threads:"}),(0,r.jsx)("span",{className:x.threadCount>1e3?"text-red-500":x.threadCount>200?"text-yellow-400":"",children:j(x.threadCount)})]}),(0,r.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,r.jsx)("span",{children:"Requests/sec:"}),(0,r.jsx)("span",{className:x.requestsPerSecond<x.threadCount/5?"text-red-500":x.requestsPerSecond<x.threadCount/2?"text-yellow-400":"text-green-300",children:j(x.requestsPerSecond)})]}),(0,r.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,r.jsx)("span",{children:"Request Queue:"}),(0,r.jsx)("span",{className:x.queueSize>100?"text-red-500":x.queueSize>20?"text-yellow-400":"",children:j(x.queueSize)})]})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("div",{className:"text-white mb-1",children:"CPU Usage"}),x.cpuUsage.map(((e,s)=>(0,r.jsx)("div",{className:"mb-2",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"w-12",children:`CPU ${s}`}),(0,r.jsx)("div",{className:"w-full bg-gray-700 h-4 ml-2 mr-2 rounded-sm",children:(0,r.jsx)("div",{className:"h-full rounded-sm "+(e>90?"bg-red-500":e>70?"bg-yellow-400":"bg-green-500"),style:{width:`${e}%`}})}),(0,r.jsx)("span",{className:"w-8 text-right",children:`${e}%`})]})},s))),(0,r.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,r.jsx)("span",{className:"w-12",children:"Average:"}),(0,r.jsx)("div",{className:"w-full bg-gray-700 h-4 ml-2 mr-2 rounded-sm",children:(0,r.jsx)("div",{className:"h-full rounded-sm "+(x.cpuAverage>90?"bg-red-500":x.cpuAverage>70?"bg-yellow-400":"bg-green-500"),style:{width:`${x.cpuAverage}%`}})}),(0,r.jsx)("span",{className:"w-8 text-right",children:`${x.cpuAverage}%`})]})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("div",{className:"text-white mb-1",children:"Memory Usage"}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"w-12",children:"Mem"}),(0,r.jsx)("div",{className:"w-full bg-gray-700 h-4 ml-2 mr-2 rounded-sm",children:(0,r.jsx)("div",{className:"h-full rounded-sm "+(x.memoryUsage>90?"bg-red-500":x.memoryUsage>70?"bg-yellow-400":"bg-blue-500"),style:{width:`${x.memoryUsage}%`}})}),(0,r.jsx)("span",{className:"w-8 text-right",children:`${x.memoryUsage}%`})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-white mb-1",children:"Top Threads"}),(0,r.jsxs)("div",{className:"grid grid-cols-12 text-xs mb-1 border-b border-gray-700",children:[(0,r.jsx)("div",{className:"col-span-1",children:"PID"}),(0,r.jsx)("div",{className:"col-span-3",children:"USER"}),(0,r.jsx)("div",{className:"col-span-1",children:"PR"}),(0,r.jsx)("div",{className:"col-span-1",children:"NI"}),(0,r.jsx)("div",{className:"col-span-2",children:"CPU%"}),(0,r.jsx)("div",{className:"col-span-2",children:"MEM%"}),(0,r.jsx)("div",{className:"col-span-2",children:"CMD"})]}),e>0&&Array.from({length:Math.min(10,x.threadCount)}).map(((s,t)=>{const a=Math.min(99,Math.floor(20*Math.random())+(e>500?5:2)),n=Math.min(5,.2+.3*Math.random());return(0,r.jsxs)("div",{className:"grid grid-cols-12 text-xs mb-1",children:[(0,r.jsx)("div",{className:"col-span-1",children:1e3+t}),(0,r.jsx)("div",{className:"col-span-3",children:"server"}),(0,r.jsx)("div",{className:"col-span-1",children:"20"}),(0,r.jsx)("div",{className:"col-span-1",children:"0"}),(0,r.jsx)("div",{className:"col-span-2 "+(a>70?"text-red-400":""),children:a.toFixed(1)}),(0,r.jsx)("div",{className:"col-span-2",children:n.toFixed(1)}),(0,r.jsx)("div",{className:"col-span-2",children:"http-conn"})]},t)})),x.threadCount>10&&(0,r.jsxs)("div",{className:"text-gray-500 text-xs mt-1",children:["... and ",j(x.threadCount-10)," more threads"]})]})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h3",{className:"text-lg font-bold",children:"Thread-Per-Connection Resource Monitor"}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsx)("button",{ref:u,onClick:()=>{if(!t){const e=u.current;if(e){const s=e.getBoundingClientRect(),t=(s.left+s.width/2)/window.innerWidth,a=(s.top+s.height/2)/window.innerHeight;(0,n.A)({particleCount:100,spread:70,origin:{x:t,y:a},colors:["#22c55e","#3b82f6","#64748b","#ef4444","#a855f7"]})}}i(!t)},onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),className:`\n              px-6 py-3 rounded-lg font-medium text-white\n              shadow-lg transform transition-all duration-200\n              ${t?"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700":"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700"}\n              ${h?"scale-105 -translate-y-0.5":""}\n              active:scale-95 active:shadow-md\n              border border-white/10\n              hover:shadow-xl\n              hover:border-white/20\n            `,children:(0,r.jsx)("span",{className:"flex items-center gap-2",children:t?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),"Stop Simulation"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),"Start Simulation"]})})}),(0,r.jsx)("button",{onClick:()=>{i(!1),s(10),d([])},className:" px-6 py-3 rounded-lg font-medium bg-gradient-to-r from-gray-600 to-gray-700 text-white shadow-lg transform transition-all duration-200 hover:from-gray-700 hover:to-gray-800 hover:scale-105 hover:-translate-y-0.5 hover:shadow-xl active:scale-95 active:shadow-md border border-white/10 hover:border-white/20 ",children:(0,r.jsxs)("span",{className:"flex items-center gap-2",children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Reset"]})})]})]}),(0,r.jsxs)("div",{className:"bg-white p-4 rounded shadow space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Simulate Connection Load"}),(0,r.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,r.jsx)("input",{type:"range",min:"1",max:"2000",value:e,onChange:e=>{i(!1),s(parseInt(e.target.value))},className:"w-full"}),(0,r.jsx)("span",{className:"text-sm font-mono bg-gray-100 p-1 rounded",children:j(e)})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Simulation Speed"}),(0,r.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,r.jsx)("span",{className:"text-xs",children:"Slow"}),(0,r.jsx)("input",{type:"range",min:"0.5",max:"5",step:"0.5",value:l,onChange:e=>o(parseFloat(e.target.value)),className:"w-full"}),(0,r.jsx)("span",{className:"text-xs",children:"Fast"}),(0,r.jsxs)("span",{className:"text-sm font-mono bg-gray-100 p-1 rounded",children:[l,"x"]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Performance Impact"}),(0,r.jsxs)("div",{className:"relative h-64 border border-gray-300 rounded p-2",children:[(0,r.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 border-t border-gray-300 flex justify-between px-2 text-xs text-gray-500",children:[(0,r.jsx)("div",{children:"0"}),(0,r.jsx)("div",{children:"500"}),(0,r.jsx)("div",{children:"1,000"}),(0,r.jsx)("div",{children:"1,500"}),(0,r.jsx)("div",{children:"2,000"})]}),(0,r.jsx)("div",{className:"absolute left-0 top-0 bottom-10 flex items-center",children:(0,r.jsx)("div",{className:"transform -rotate-90 text-xs text-gray-500 whitespace-nowrap",children:"Resource Utilization (%)"})}),(0,r.jsx)("div",{className:"absolute bottom-0 w-0.5 bg-red-500 h-full opacity-50",style:{left:e/2e3*100+"%",height:"calc(100% - 15px)"}}),(0,r.jsx)("div",{className:"w-full h-full",children:(()=>{if(c.length<2)return null;const e=e=>c.map(((s,t)=>(0===t?"M":"L")+`${s.connections/2e3*100},${100-100*s[e]/100}`)).join(" ");return(0,r.jsxs)("svg",{className:"w-full h-full",viewBox:"0 0 100 100",preserveAspectRatio:"none",children:[(0,r.jsx)("path",{d:e("cpuAverage"),fill:"none",stroke:"#22c55e",strokeWidth:"1.5"}),(0,r.jsx)("path",{d:e("memoryUsage"),fill:"none",stroke:"#3b82f6",strokeWidth:"1.5"}),(0,r.jsx)("path",{d:e("threadCountPercentage"),fill:"none",stroke:"#64748b",strokeWidth:"1.5"}),(0,r.jsx)("path",{d:e("throughputPercentage"),fill:"none",stroke:"#ef4444",strokeWidth:"1.5"}),(0,r.jsx)("path",{d:e("queuePercentage"),fill:"none",stroke:"#a855f7",strokeWidth:"1.5"})]})})()}),(0,r.jsxs)("div",{className:"absolute top-2 right-2 bg-white/80 p-2 rounded text-xs space-y-1",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"w-3 h-3 bg-green-500 mr-2"}),(0,r.jsx)("div",{children:"CPU Usage"})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"w-3 h-3 bg-blue-500 mr-2"}),(0,r.jsx)("div",{children:"Memory Usage"})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"w-3 h-3 bg-gray-500 mr-2"}),(0,r.jsx)("div",{children:"Thread Count"})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"w-3 h-3 bg-red-500 mr-2"}),(0,r.jsx)("div",{children:"Throughput"})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"w-3 h-3 bg-purple-500 mr-2"}),(0,r.jsx)("div",{children:"Request Queue"})]})]})]})]}),(0,r.jsxs)("div",{className:"p-3 rounded "+(e>500?"bg-red-100":e>100?"bg-yellow-100":"bg-green-100"),children:[(0,r.jsx)("h4",{className:"font-medium mb-1",children:"System Status:"}),e<=50&&(0,r.jsx)("p",{className:"text-sm",children:"System is handling connections efficiently. Resources are well-utilized with minimal overhead."}),e>50&&e<=300&&(0,r.jsx)("p",{className:"text-sm",children:"System load increasing. Thread creation is consuming memory and CPU resources."}),e>300&&e<=800&&(0,r.jsx)("p",{className:"text-sm",children:"Warning: High thread count causing significant context switching overhead. Throughput is plateauing despite increasing resource consumption."}),e>800&&(0,r.jsx)("p",{className:"text-sm",children:"Critical: System is overwhelmed with threads. Context switching overhead is degrading performance. Throughput is decreasing despite increased resource usage. Request queue is growing rapidly."})]})]}),(0,r.jsxs)("div",{className:"text-center text-sm text-gray-600",children:[(0,r.jsx)("strong",{children:"Figure 1:"})," Interactive visualization of thread-per-connection scaling issues. As connection count increases, resources are consumed by thread overhead, while throughput plateaus and then declines due to context switching costs."]})]})}},7203:e=>{e.exports=JSON.parse('{"permalink":"/byte_vault/blog/tokio-internals-visualised","source":"@site/blog/2025-04-19-tokio-internals.mdx","title":"Understanding Eventloops by visualisation","description":"This document explores the fundamental concepts behind Tokio\'s executor, starting with why we need systems like Tokio and gradually building up the core components. We\'ll use descriptions of visualizations to make these ideas concrete.","date":"2025-04-19T00:00:00.000Z","tags":[{"inline":false,"label":"Rust","permalink":"/byte_vault/blog/tags/rust","description":"Rust lang"},{"inline":false,"label":"Tokio","permalink":"/byte_vault/blog/tags/tokio","description":"Tokio async runtime"},{"inline":false,"label":"Async","permalink":"/byte_vault/blog/tags/async","description":"Asynchronous programming"}],"readingTime":2.105,"hasTruncateMarker":true,"authors":[{"name":"Abhishek Tripathi","title":"Curiosity brings awareness.","url":"https://github.com/TwistingTwists","page":{"permalink":"/byte_vault/blog/authors/abeeshake"},"socials":{"x":"https://x.com/twistin456","github":"https://github.com/TwistingTwists"},"imageURL":"https://github.com/TwistingTwists.png","key":"abeeshake"}],"frontMatter":{"slug":"tokio-internals-visualised","title":"Understanding Eventloops by visualisation","date":"2025-04-19T00:00:00.000Z","authors":["abeeshake"],"tags":["rust","tokio","async"],"draft":false},"unlisted":false,"nextItem":{"title":"Writing","permalink":"/byte_vault/blog/writing"}}')}}]);