"use strict";(self.webpackChunkbytevault=self.webpackChunkbytevault||[]).push([[7159],{6176:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>d,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>m});var s=a(4965),i=a(4848),r=a(8453),n=a(1096),l=a(5751);const o={slug:"database-isolation-visualised-mvcc-visibility-rules",title:"MVCC Visibility Rules",date:new Date("2025-05-23T00:01:00.000Z"),authors:["abeeshake"],tags:["databases","transactions"]},d=void 0,c={authorsImageUrls:[void 0]},m=[];function x(e){return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.A,{toc:m}),"\n","\n",(0,i.jsx)(l.A,{})]})}function u(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(x,{...e})}):x()}},1096:(e,t,a)=>{a.d(t,{A:()=>n});a(6540);var s=a(1021);const i={tableOfContentsInline:"tableOfContentsInline_prmo"};var r=a(4848);function n(e){let{toc:t,minHeadingLevel:a,maxHeadingLevel:n}=e;return(0,r.jsx)("div",{className:i.tableOfContentsInline,children:(0,r.jsx)(s.A,{toc:t,minHeadingLevel:a,maxHeadingLevel:n,className:"table-of-contents",linkClassName:null})})}},1021:(e,t,a)=>{a.d(t,{A:()=>h});var s=a(6540),i=a(3115);function r(e){const t=e.map((e=>({...e,parentIndex:-1,children:[]}))),a=Array(7).fill(-1);t.forEach(((e,t)=>{const s=a.slice(2,e.level);e.parentIndex=Math.max(...s),a[e.level]=t}));const s=[];return t.forEach((e=>{const{parentIndex:a,...i}=e;a>=0?t[a].children.push(i):s.push(i)})),s}function n(e){let{toc:t,minHeadingLevel:a,maxHeadingLevel:s}=e;return t.flatMap((e=>{const t=n({toc:e.children,minHeadingLevel:a,maxHeadingLevel:s});return function(e){return e.level>=a&&e.level<=s}(e)?[{...e,children:t}]:t}))}function l(e){const t=e.getBoundingClientRect();return t.top===t.bottom?l(e.parentNode):t}function o(e,t){let{anchorTopOffset:a}=t;const s=e.find((e=>l(e).top>=a));if(s){return function(e){return e.top>0&&e.bottom<window.innerHeight/2}(l(s))?s:e[e.indexOf(s)-1]??null}return e[e.length-1]??null}function d(){const e=(0,s.useRef)(0),{navbar:{hideOnScroll:t}}=(0,i.p)();return(0,s.useEffect)((()=>{e.current=t?0:document.querySelector(".navbar").clientHeight}),[t]),e}function c(e){const t=(0,s.useRef)(void 0),a=d();(0,s.useEffect)((()=>{if(!e)return()=>{};const{linkClassName:s,linkActiveClassName:i,minHeadingLevel:r,maxHeadingLevel:n}=e;function l(){const e=function(e){return Array.from(document.getElementsByClassName(e))}(s),l=function(e){let{minHeadingLevel:t,maxHeadingLevel:a}=e;const s=[];for(let i=t;i<=a;i+=1)s.push(`h${i}.anchor`);return Array.from(document.querySelectorAll(s.join()))}({minHeadingLevel:r,maxHeadingLevel:n}),d=o(l,{anchorTopOffset:a.current}),c=e.find((e=>d&&d.id===function(e){return decodeURIComponent(e.href.substring(e.href.indexOf("#")+1))}(e)));e.forEach((e=>{!function(e,a){a?(t.current&&t.current!==e&&t.current.classList.remove(i),e.classList.add(i),t.current=e):e.classList.remove(i)}(e,e===c)}))}return document.addEventListener("scroll",l),document.addEventListener("resize",l),l(),()=>{document.removeEventListener("scroll",l),document.removeEventListener("resize",l)}}),[e,a])}var m=a(6289),x=a(4848);function u(e){let{toc:t,className:a,linkClassName:s,isChild:i}=e;return t.length?(0,x.jsx)("ul",{className:i?void 0:a,children:t.map((e=>(0,x.jsxs)("li",{children:[(0,x.jsx)(m.A,{to:`#${e.id}`,className:s??void 0,dangerouslySetInnerHTML:{__html:e.value}}),(0,x.jsx)(u,{isChild:!0,toc:e.children,className:a,linkClassName:s})]},e.id)))}):null}const g=s.memo(u);function h(e){let{toc:t,className:a="table-of-contents table-of-contents__left-border",linkClassName:l="table-of-contents__link",linkActiveClassName:o,minHeadingLevel:d,maxHeadingLevel:m,...u}=e;const h=(0,i.p)(),b=d??h.tableOfContents.minHeadingLevel,p=m??h.tableOfContents.maxHeadingLevel,v=function(e){let{toc:t,minHeadingLevel:a,maxHeadingLevel:i}=e;return(0,s.useMemo)((()=>n({toc:r(t),minHeadingLevel:a,maxHeadingLevel:i})),[t,a,i])}({toc:t,minHeadingLevel:b,maxHeadingLevel:p});return c((0,s.useMemo)((()=>{if(l&&o)return{linkClassName:l,linkActiveClassName:o,minHeadingLevel:b,maxHeadingLevel:p}}),[l,o,b,p])),(0,x.jsx)(g,{toc:v,className:a,linkClassName:l,...u})}},5751:(e,t,a)=>{a.d(t,{A:()=>m});var s=a(6540),i=a(961),r=a(4848);const n=e=>{let{children:t,title:a}=e;const[n,l]=(0,s.useState)(!1),[o,d]=(0,s.useState)(null);(0,s.useEffect)((()=>{const e=document.createElement("div");return e.style.position="relative",document.body.appendChild(e),d(e),()=>{document.body.removeChild(e)}}),[]),(0,s.useEffect)((()=>(document.body.style.overflow=n?"hidden":"",()=>{document.body.style.overflow=""})),[n]);const c=()=>{l(!n)},m=(0,r.jsxs)("div",{className:"relative",children:[t,(0,r.jsxs)("button",{onClick:c,className:"absolute right-4 top-4 z-50 flex items-center gap-2 px-3 py-2 rounded-lg  bg-blue-600 hover:bg-blue-700 text-white transition-colors duration-200",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M3 4a1 1 0 011-1h4a1 1 0 010 2H5.414l2.293 2.293a1 1 0 11-1.414 1.414L4 6.414V8a1 1 0 01-2 0V4zm14 0a1 1 0 00-1-1h-4a1 1 0 100 2h2.586l-2.293 2.293a1 1 0 001.414 1.414L16 6.414V8a1 1 0 102 0V4zM3 16a1 1 0 001 1h4a1 1 0 100-2H5.414l2.293-2.293a1 1 0 00-1.414-1.414L4 13.586V12a1 1 0 10-2 0v4zm14 0a1 1 0 01-1 1h-4a1 1 0 110-2h2.586l-2.293-2.293a1 1 0 011.414-1.414L16 13.586V12a1 1 0 112 0v4z",clipRule:"evenodd"})}),"Full Screen"]})]}),x=o&&(0,i.createPortal)((0,r.jsx)("div",{className:"fixed inset-0 z-[9999] bg-white overflow-auto",children:(0,r.jsxs)("div",{className:"p-8",children:[a&&(0,r.jsx)("h2",{className:"text-2xl font-bold mb-4",children:a}),t,(0,r.jsxs)("button",{onClick:c,className:"fixed right-4 top-4 z-[10000] flex items-center gap-2 px-3 py-2 rounded-lg  bg-gray-200 hover:bg-gray-300 text-gray-800 transition-colors duration-200",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M3 4a1 1 0 011-1h4a1 1 0 010 2H6.414l2.293 2.293a1 1 0 11-1.414 1.414L5 6.414V8a1 1 0 01-2 0V4zm14 0a1 1 0 00-1-1h-4a1 1 0 100 2h1.586l-2.293 2.293a1 1 0 001.414 1.414L15 6.414V8a1 1 0 102 0V4zM3 16a1 1 0 001 1h4a1 1 0 100-2H6.414l2.293-2.293a1 1 0 00-1.414-1.414L5 13.586V12a1 1 0 10-2 0v4zm14 0a1 1 0 01-1 1h-4a1 1 0 110-2h1.586l-2.293-2.293a1 1 0 011.414-1.414L15 13.586V12a1 1 0 112 0v4z",clipRule:"evenodd"})}),"Exit Full Screen"]})]})}),o);return(0,r.jsxs)(r.Fragment,{children:[m,n&&x]})},l={name:"MVCC Visibility Rules Demonstration",description:"Illustrates how transactions see data based on snapshot isolation. Focus on T3's reads and how its snapshot (taken at t=40) affects what it sees from T1 and T2, even after they commit.",initialDataItems:{DataA:[{id:"vA0",value:100,txMin:0,txMax:null,txMinName:"Initial",txMaxName:null}],DataB:[{id:"vB0",value:500,txMin:0,txMax:null,txMinName:"Initial",txMaxName:null}]},transactions:{T1:{color:"#3b82f6",operations:[{type:"begin",time:0},{type:"read",time:5,target:"DataA"},{type:"write",time:10,target:"DataA",value:110},{type:"read",time:15,target:"DataA",comment:"T1 reads its own write"},{type:"commit",time:45}]},T2:{color:"#10b981",operations:[{type:"begin",time:20},{type:"read",time:25,target:"DataA",comment:"T1's write is uncommitted"},{type:"write",time:30,target:"DataB",value:520},{type:"read",time:35,target:"DataB",comment:"T2 reads its own write"},{type:"commit",time:50}]},T3:{color:"#f59e0b",operations:[{type:"begin",time:40,comment:"Snapshot taken before T1/T2 commit"},{type:"read",time:55,target:"DataA",comment:"T1 committed (t=45), T2 committed (t=50)"},{type:"read",time:60,target:"DataB",comment:"T1 committed (t=45), T2 committed (t=50)"},{type:"commit",time:70}]}},keyMoments:[{step:3,text:"T1 writes DataA=110. This creates a new version (vA1) by T1 (uncommitted) and marks the initial version (vA0) as superseded by T1 (uncommitted).",autoPause:!0,highlight:{currentOpPanel:!0,dataItemVersions:{DataA:["vA0","vA1"]}}},{step:4,text:"T1 reads DataA. It sees its own uncommitted write (vA1, value 110).",autoPause:!0,highlight:{currentOpPanel:!0,transactionSpecificRead:{txName:"T1",item:"DataA",versionId:"vA1",step:4}}},{step:6,text:"T2 (snapshot: {0}) reads DataA. T1's write (vA1) is uncommitted. T1's invalidation of vA0 (txMax=1) is also uncommitted. So, T2 sees the initial version vA0 (value 100).",autoPause:!0,isCritical:!0,highlight:{currentOpPanel:!0,transactionSpecificRead:{txName:"T2",item:"DataA",versionId:"vA0",step:6}}},{step:9,text:"T1 commits. Its creation of vA1 (DataA=110) and invalidation of vA0 are now permanent. Global committed set now includes TxID 1.",autoPause:!0,highlight:{currentOpPanel:!0,dataItemVersions:{DataA:["vA0","vA1"]},committedTx:1}},{step:10,text:"T2 commits. Its creation of vB1 (DataB=520) and invalidation of vB0 are now permanent. Global committed set now includes TxID 1, 2.",autoPause:!0,highlight:{currentOpPanel:!0,dataItemVersions:{DataB:["vB0","vB1"]},committedTx:2}},{step:11,text:"T3 (snapshot: {0}, taken at t=40) begins. At this time, neither T1 nor T2 had committed.",autoPause:!0,highlight:{currentOpPanel:!0,transactionState:"T3"}},{step:12,text:"SNAPSHOT ISOLATION: T3 reads DataA. T1 *is now globally committed*. However, T3's snapshot only contains {0}. \n- vA0 (txMin:0, txMax:1(T1)): txMin 0 is in T3's snapshot. txMax 1 (T1) is NOT in T3's snapshot. So, vA0 is visible to T3 (value 100).\n- vA1 (txMin:1(T1)): txMin 1 (T1) is NOT in T3's snapshot. So, vA1 is NOT visible to T3.",autoPause:!0,isCritical:!0,highlight:{currentOpPanel:!0,transactionSpecificRead:{txName:"T3",item:"DataA",versionId:"vA0",step:12}}},{step:13,text:"SNAPSHOT ISOLATION: T3 reads DataB. T2 *is now globally committed*. However, T3's snapshot only contains {0}.\n- vB0 (txMin:0, txMax:2(T2)): txMin 0 is in T3's snapshot. txMax 2 (T2) is NOT in T3's snapshot. So, vB0 is visible to T3 (value 500).\n- vB1 (txMin:2(T2)): txMin 2 (T2) is NOT in T3's snapshot. So, vB1 is NOT visible to T3.",autoPause:!0,isCritical:!0,highlight:{currentOpPanel:!0,transactionSpecificRead:{txName:"T3",item:"DataB",versionId:"vB0",step:13}}}]};let o=0;const d=e=>`${e}${o++}`,c=()=>{const[e,t]=(0,s.useState)(!1),[a,i]=(0,s.useState)(!1),[n,c]=(0,s.useState)(0),[m,x]=(0,s.useState)(0),[u,g]=(0,s.useState)({}),[h,b]=(0,s.useState)({}),[p,v]=(0,s.useState)(new Set([0])),[f,y]=(0,s.useState)([]),[N,k]=(0,s.useState)({}),j=(0,s.useRef)(1),w=(0,s.useRef)(null),T=(0,s.useRef)(null),{transactions:M,keyMoments:C,initialDataItems:A}=l,I=(0,s.useCallback)((()=>{const e=[];return Object.entries(M).forEach((t=>{let[a,s]=t;s.operations.forEach((t=>{e.push({...t,transaction:a,color:s.color})}))})),e.sort(((e,t)=>e.time-t.time))}),[M]),S=(0,s.useRef)(I()).current,O=(0,s.useMemo)((()=>Math.max(...S.map((e=>e.time)))+10),[S]),L=(0,s.useCallback)((()=>{o=0;const e=JSON.parse(JSON.stringify(A));Object.keys(e).forEach((t=>{e[t].forEach((e=>{const a="DataA"===t?"vA":"vB";e.id=d(a)}))})),g(e),b({}),v(new Set([0])),y([]),k({}),j.current=1}),[A]);(0,s.useEffect)((()=>{L()}),[L]);const D=(0,s.useCallback)(((e,t,a)=>{if(!t||!e)return null;const s=e.filter((e=>{const a=e.txMin===t.id,s=t.snapshotCommittedTxIds.has(e.txMin);if(!a&&!s)return!1;if(null===e.txMax)return!0;return!t.snapshotCommittedTxIds.has(e.txMax)}));return s.sort(((e,t)=>{if(t.txMin!==e.txMin)return t.txMin-e.txMin;const a=parseInt(e.id.substring(2)||"0");return parseInt(t.id.substring(2)||"0")-a})),s.length>0?s[0]:null}),[]),H=(0,s.useCallback)((e=>{o=0;let t=JSON.parse(JSON.stringify(A));Object.keys(t).forEach((e=>{t[e].forEach((t=>{const a="DataA"===e?"vA":"vB";t.id=d(a)}))}));let a={},s=new Set([0]),i=1,r=[];return S.slice(0,e).forEach((e=>{const n=e,l=n.transaction;if("begin"===n.type){const e=i++;a[l]={id:e,name:l,startTime:n.time,snapshotCommittedTxIds:new Set(s),status:"active",reads:[],writesMade:[]}}else if("active"===a[l]?.status){const e=a[l],i=n,r=n;if("read"===n.type){const a=t[r.target],i=D(a,e,s);e.reads.push({item:r.target,value:i?.value,versionId:i?.id,versionTxMin:i?.txMin,time:n.time})}else if("write"===n.type){const a=t[i.target],r=D(a,e,s),n={id:d("DataA"===i.target?"vA":"vB"),value:i.value,txMin:e.id,txMax:null,txMinName:e.name,txMaxName:null};if(r){const t=a.find((e=>e.id===r.id));t&&null===t.txMax&&(t.txMax=e.id,t.txMaxName=e.name)}a.push(n),e.writesMade.push({item:i.target,newVersionId:n.id,oldVersionId:r?.id})}else"commit"===n.type?(s.add(e.id),e.status="committed"):"abort"===n.type&&(e.status="aborted",Object.keys(t).forEach((a=>{t[a]=t[a].filter((t=>t.txMin!==e.id)),t[a].forEach((t=>{t.txMax===e.id&&(t.txMax=null,t.txMaxName=null)}))})))}r.push({...n,txId:a[l]?.id})})),{dbVersions:t,txDetails:a,committedIds:s,completedOps:r,nextTxId:i}}),[S,D,A]),V=(0,s.useCallback)((t=>{if(0===t)L(),c(0);else{const s=S[t-1];c(s.time);const r=H(t);g(r.dbVersions),b(r.txDetails),v(r.committedIds),y(r.completedOps),j.current=r.nextTxId;const n=C.find((e=>e.step===t));n?(k({...n,step:t}),n.autoPause&&e&&!a&&i(!0)):N.step&&N.step!==t&&k({})}}),[S,H,L,e,a,N.step,C]);(0,s.useEffect)((()=>{if(e&&!a){const e=setInterval((()=>{x((e=>{if(e>=S.length)return t(!1),i(!1),e;const a=e+1;return V(a),a}))}),1300);return()=>clearInterval(e)}}),[e,a,S.length,V]);const R=()=>{i(!1),N.autoPause&&N.step===m&&k((e=>({...e,autoPause:!1})))},E=e=>e/O*95,P=m>0?S[m-1]:null,B=P&&N.highlight?.currentOpPanel&&N.step===m,$=e=>{if(0===e)return"Initial";const t=Object.entries(h).find((t=>{let[a,s]=t;return s.id===e}));return t?t[0]:`Tx${e}`},[z,_]=(0,s.useState)("10rem");return(0,s.useEffect)((()=>{if(T.current){const e=Object.keys(M).length;_(2.5*e-1+1+"rem")}}),[M]),(0,r.jsxs)("div",{className:"w-full min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 p-4 sm:p-6 font-sans",children:[(0,r.jsxs)("header",{className:"mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold mb-1",children:l.name}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:l.description})]}),(0,r.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-4 mb-6",children:(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3 mb-3",children:[(0,r.jsxs)("div",{className:"flex gap-2 flex-wrap justify-center",children:[(0,r.jsx)("button",{onClick:()=>{V(0),t(!0),i(!1),x(1),V(1)},disabled:e&&!a,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400 dark:disabled:bg-gray-600 text-sm",children:"Auto Run"}),e&&(a?(0,r.jsx)("button",{onClick:R,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 text-sm",children:"Resume"}):(0,r.jsx)("button",{onClick:()=>i(!0),className:"px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600 text-sm",children:"Pause"})),(0,r.jsx)("button",{onClick:()=>{t(!1),i(!1),x(0),V(0)},className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 dark:bg-gray-600 dark:hover:bg-gray-700 text-sm",children:"Reset"}),(0,r.jsxs)("div",{className:"sm:border-l border-gray-300 dark:border-gray-700 sm:pl-2 flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>{if(m>0){const e=m-1;x(e),V(e)}},disabled:0===m||e&&!a,className:"px-3 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:bg-gray-400 dark:disabled:bg-gray-600 text-sm",children:"\u2190 Step"}),(0,r.jsx)("button",{onClick:()=>{if(m<S.length){const e=m+1;x(e),V(e)}},disabled:m>=S.length||e&&!a,className:"px-3 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:bg-gray-400 dark:disabled:bg-gray-600 text-sm",children:"Step \u2192"})]})]}),(0,r.jsxs)("div",{className:"text-right text-xs sm:text-sm",children:[(0,r.jsxs)("div",{className:"font-mono text-gray-700 dark:text-gray-300",children:["Step: ",m,"/",S.length," | Time: ",n]}),(0,r.jsxs)("div",{className:"text-gray-500 dark:text-gray-400",children:["Next TxID: ",j.current," | Committed: [",[...p].sort(((e,t)=>e-t)).join(", "),"]"]})]})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-4 mb-6 text-xs sm:text-sm",children:[(0,r.jsxs)("div",{className:"lg:col-span-3 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-xl",children:[(0,r.jsx)("h3",{className:"font-semibold mb-3 text-base sm:text-lg border-b border-gray-200 dark:border-gray-700 pb-2 text-gray-800 dark:text-gray-200",children:"Data Item Versions (Global State)"}),Object.entries(u).map((e=>{let[t,a]=e;return(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("h4",{className:"font-medium text-fuchsia-500 dark:text-fuchsia-400 mb-1 text-sm sm:text-base",children:[t,":"]}),(0,r.jsx)("div",{className:"space-y-1.5 max-h-60 overflow-y-auto pr-2",children:a.map((e=>{const a=N.highlight?.dataItemVersions?.[t]?.includes(e.id),s=Object.values(h).find((t=>t.id===e.txMin)),i=Object.values(h).find((t=>t.id===e.txMax));let n="";return n=0===e.txMin?"Initial":p.has(e.txMin)?`Committed by ${$(e.txMin)}`:`Uncommitted by ${$(e.txMin)}`,null!==e.txMax&&(n+=p.has(e.txMax)?` / Superseded by committed ${$(e.txMax)}`:` / Marked by uncommitted ${$(e.txMax)}`),(0,r.jsxs)("div",{className:"p-1.5 rounded text-xs font-mono flex flex-col sm:flex-row sm:justify-between sm:items-center\n                      "+(a?"ring-2 ring-yellow-500 dark:ring-yellow-400 bg-gray-100 dark:bg-gray-700":"bg-gray-50 dark:bg-gray-850_custom"),children:[" ",(0,r.jsxs)("div",{className:"flex-grow text-gray-700 dark:text-gray-300",children:["ID: ",(0,r.jsx)("span",{className:"text-yellow-600 dark:text-yellow-400",children:e.id}),", Val: ",(0,r.jsx)("span",{className:"text-green-600 dark:text-green-400 font-semibold",children:e.value}),(0,r.jsx)("br",{className:"sm:hidden"}),(0,r.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:" txMin:"})," ",(0,r.jsx)("span",{style:{color:s?.name?M[s.name]?.color:"inherit"},children:$(e.txMin)}),",",(0,r.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:" txMax:"})," ",(0,r.jsx)("span",{style:{color:i?.name?M[i.name]?.color:"inherit"},children:null===e.txMax?"NULL":$(e.txMax)})]}),(0,r.jsxs)("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 mt-1 sm:mt-0 sm:ml-2 self-start sm:self-center",children:["(",n,")"]})]},e.id)}))})]},t)}))]}),(0,r.jsxs)("div",{className:"lg:col-span-2 space-y-4",children:[(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-3 rounded-lg shadow-xl "+(B?"ring-2 ring-purple-500 dark:ring-purple-400":""),children:[(0,r.jsx)("h3",{className:"font-semibold mb-2 border-b border-gray-200 dark:border-gray-700 pb-1 text-sm sm:text-base text-gray-800 dark:text-gray-200",children:"Current Operation"}),P?(0,r.jsxs)("div",{className:"font-mono text-xs "+(B?"text-purple-600 dark:text-purple-300 font-bold":"text-gray-700 dark:text-gray-300"),children:[(0,r.jsxs)("span",{style:{color:P.color},children:[P.transaction," (TxID: ",h[P.transaction]?.id,")"]}),": ",P.type.toUpperCase(),P.target&&` ${P.target}`,void 0!==P.value&&` = ${P.value}`,P.comment&&(0,r.jsxs)("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 block italic",children:["(",P.comment,")"]})]}):(0,r.jsx)("div",{className:"text-gray-500 dark:text-gray-400 italic",children:"None"})]}),(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-3 rounded-lg shadow-xl max-h-80 overflow-y-auto",children:[(0,r.jsx)("h3",{className:"font-semibold mb-2 border-b border-gray-200 dark:border-gray-700 pb-1 text-sm sm:text-base text-gray-800 dark:text-gray-200",children:"Transaction States & Snapshots"}),Object.values(h).length>0?Object.values(h).map((e=>(0,r.jsxs)("div",{className:"mb-2 p-2 rounded text-[11px] sm:text-xs\n                "+(N.highlight?.transactionState===e.name?"bg-gray-100 dark:bg-gray-700 ring-1 ring-sky-500 dark:ring-sky-400":"bg-gray-50 dark:bg-gray-850_custom"),children:[(0,r.jsxs)("p",{className:"font-bold",style:{color:M[e.name]?.color},children:[e.name," (ID: ",e.id,") St: ",(0,r.jsx)("span",{className:"committed"===e.status?"text-green-500 dark:text-green-400":"aborted"===e.status?"text-red-500 dark:text-red-400":"text-yellow-500 dark:text-yellow-400",children:e.status})," (t=",e.startTime,")"]}),(0,r.jsxs)("p",{className:"font-mono text-gray-600 dark:text-gray-400",children:["Snap TxIDs: ",(0,r.jsxs)("span",{className:"text-fuchsia-600 dark:text-fuchsia-400",children:["[",[...e.snapshotCommittedTxIds].sort(((e,t)=>e-t)).join(", "),"]"]})]}),e.reads.map(((t,a)=>(0,r.jsxs)("p",{className:"pl-1\n                    "+(N.highlight?.transactionSpecificRead?.txName===e.name&&N.highlight?.transactionSpecificRead?.item===t.item&&N.highlight?.transactionSpecificRead?.versionId===t.versionId&&N.highlight?.transactionSpecificRead?.step===m?"text-yellow-600 dark:text-yellow-300 font-semibold":"text-gray-700 dark:text-gray-300"),children:["\u21b3 Read ",(0,r.jsx)("span",{className:"",children:t.item})," (t=",t.time,"): Val ",(0,r.jsx)("span",{className:"",children:void 0===t.value?"N/A":t.value})," (from ",t.versionId||"N/A",")"]},a)))]},e.id))):(0,r.jsx)("div",{className:"text-gray-500 dark:text-gray-400 italic text-xs",children:"No active transactions."})]})]})]}),N.text&&(0,r.jsxs)("div",{className:"my-4 p-3 sm:p-4 rounded-lg border-2 transition-all duration-300 ease-in-out "+(N.isCritical?"border-red-400 dark:border-red-500 bg-red-50 dark:bg-red-900/30 shadow-lg":"border-blue-400 dark:border-blue-500 bg-blue-50 dark:bg-blue-900/30"),children:[(0,r.jsxs)("h3",{className:"text-sm sm:text-base font-semibold mb-1 sm:mb-2 "+(N.isCritical?"text-red-700 dark:text-red-300":"text-blue-700 dark:text-blue-300"),children:["\ud83d\udd0d Insight at Step ",N.step," (Time: ",P?.time,")"]}),(0,r.jsx)("p",{className:"text-xs sm:text-sm whitespace-pre-line "+(N.isCritical?"text-red-600 dark:text-red-400":"text-blue-600 dark:text-blue-400"),children:N.text}),a&&N.autoPause&&N.step===m&&(0,r.jsx)("button",{onClick:R,className:"mt-2 px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600 text-xs sm:text-sm",children:"Continue"})]}),(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-4 sm:p-6",ref:w,children:[(0,r.jsx)("h2",{className:"text-base sm:text-xl font-semibold mb-2 text-gray-800 dark:text-gray-200",children:"Transaction Timelines"})," ",(0,r.jsxs)("div",{className:"relative mb-4 pt-4",children:[" ",(0,r.jsx)("div",{className:"absolute top-4 left-0 right-0 h-px bg-gray-300 dark:bg-gray-600 z-0"})," ",(0,r.jsxs)("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-2 px-[2.5%] w-[95%] relative z-10",children:[" ",Array.from({length:Math.floor(O/10)+1},((e,t)=>{const a=10*t;return a>O-5?null:(0,r.jsxs)("div",{className:"relative flex flex-col items-center",children:[(0,r.jsx)("div",{className:"absolute w-px h-2 bg-gray-300 dark:bg-gray-600 -top-2"}),(0,r.jsx)("div",{children:a})]},t)}))]}),(e||m>0)&&(0,r.jsxs)("div",{className:"absolute top-4 w-0.5 bg-red-500 transition-all duration-200 ease-linear z-20",style:{left:`${E(n)}%`,height:z},children:[(0,r.jsx)("div",{className:"absolute -top-3.5 -left-[7px] w-3.5 h-3.5 bg-red-500 rounded-full border-2 border-white dark:border-gray-900 shadow-md"})," "]})]}),(0,r.jsxs)("div",{className:"space-y-3 relative",ref:T,children:[" ",Object.entries(M).map((e=>{let[t,a]=e;return(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)("div",{className:"flex items-center mb-0.5",children:[" ",(0,r.jsx)("div",{className:"w-2.5 h-2.5 rounded-full mr-1.5 flex-shrink-0",style:{backgroundColor:a.color}})," ",(0,r.jsx)("h3",{className:"text-xs sm:text-sm font-semibold text-gray-800 dark:text-gray-200",children:t})]}),(0,r.jsxs)("div",{className:"relative h-6 bg-gray-100 dark:bg-gray-700 rounded",children:[" ",(0,r.jsx)("div",{className:"absolute top-0 left-0 h-full rounded opacity-30",style:{backgroundColor:a.color,width:`${E(a.operations[a.operations.length-1].time)}%`}}),a.operations.map(((e,s)=>{const i=f.find((a=>a.transaction===t&&a.time===e.time&&a.type===e.type)),n=void 0!==i,l=N.highlight?.timelineOps?.some((a=>a.transaction===t&&a.time===e.time))&&N.step===m;let o=`${e.type.toUpperCase()}`;if(e.target&&(o+=` ${e.target}`),void 0!==e.value&&(o+=` = ${e.value}`),i&&"read"===e.type){const a=h[t],s=a?.reads.find((t=>t.item===e.target&&t.time===e.time));s&&(o+=` -> ${s.value} (v: ${s.versionId})`)}return(0,r.jsxs)("div",{className:`absolute top-0.5 w-5 h-5 rounded-full border flex items-center justify-center text-[9px] font-bold transition-all duration-300 group\n                        ${n?"bg-white dark:bg-gray-200 shadow-md scale-105 border-2":"bg-gray-200 dark:bg-gray-600 opacity-70 border-gray-400 dark:border-gray-500"}\n                        ${l?"ring-2 sm:ring-offset-1 ring-red-500 dark:ring-red-400 scale-110 sm:scale-125 z-10 border-2":"border"}`,style:{left:`calc(${E(e.time)}% - 10px)`,borderColor:n||l?a.color:void 0,color:n||l?a.color:"text-gray-500 dark:text-gray-400"},title:o,children:[e.type.charAt(0).toUpperCase(),n&&(0,r.jsxs)("div",{className:"absolute bottom-full mb-1 left-1/2 transform -translate-x-1/2 bg-black text-white px-1.5 py-0.5 rounded text-[9px] whitespace-nowrap z-30 opacity-0 group-hover:opacity-100 pointer-events-none",children:[o,(0,r.jsx)("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 border-[3px] border-transparent border-t-black"})," "]})]},`${t}-${e.time}-${s}`)}))]})]},t)}))]}),(0,r.jsxs)("div",{className:"mt-6 pt-3 border-t border-gray-200 dark:border-gray-700 text-xs",children:[(0,r.jsx)("h4",{className:"font-semibold mb-1 text-gray-700 dark:text-gray-300",children:"Legend"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-x-3 gap-y-1 text-gray-600 dark:text-gray-400",children:["Begin","Read","Write","Commit","Abort"].map((e=>(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsx)("div",{className:"w-5 h-5 rounded-full border-2 border-gray-400 dark:border-gray-500 bg-gray-50 dark:bg-gray-700 flex items-center justify-center font-bold text-gray-700 dark:text-gray-200",children:e.charAt(0)}),(0,r.jsx)("span",{children:e})]},e)))})]})]})]})},m=()=>(0,r.jsx)(n,{title:"MVCC Visibility Rules Visualization",children:(0,r.jsx)(c,{})})},8453:(e,t,a)=>{a.d(t,{R:()=>n,x:()=>l});var s=a(6540);const i={},r=s.createContext(i);function n(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:n(e.components),s.createElement(r.Provider,{value:t},e.children)}},4965:e=>{e.exports=JSON.parse('{"permalink":"/byte_vault/database-isolation-visualised-mvcc-visibility-rules","source":"@site/blog/2025-04-23-db-isolation-007.mdx","title":"MVCC Visibility Rules","description":"","date":"2025-05-23T00:01:00.000Z","tags":[{"inline":false,"label":"Databases","permalink":"/byte_vault/tags/databases","description":"Database systems"},{"inline":false,"label":"Transactions","permalink":"/byte_vault/tags/transactions","description":"Transactions"}],"readingTime":0.065,"hasTruncateMarker":false,"authors":[{"name":"Abhishek Tripathi","title":"Curiosity brings awareness.","url":"https://github.com/TwistingTwists","page":{"permalink":"/byte_vault/authors/abeeshake"},"socials":{"x":"https://x.com/twistin456","github":"https://github.com/TwistingTwists"},"imageURL":"https://github.com/TwistingTwists.png","key":"abeeshake"}],"frontMatter":{"slug":"database-isolation-visualised-mvcc-visibility-rules","title":"MVCC Visibility Rules","date":"2025-05-23T00:01:00.000Z","authors":["abeeshake"],"tags":["databases","transactions"]},"unlisted":false,"nextItem":{"title":"Database Isolation (dirty reads)","permalink":"/byte_vault/database-isolation-visualised-dirty-reads"}}')}}]);