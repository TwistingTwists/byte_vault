"use strict";(self.webpackChunkbytevault=self.webpackChunkbytevault||[]).push([[3446],{770:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>d,default:()=>m,frontMatter:()=>l,metadata:()=>n,toc:()=>u});var n=a(1222),s=a(4848),r=a(8453),i=a(1096),o=a(64);const l={slug:"database-isolation-visualised-dirty-writes",title:"Database Isolation (dirty writes)",date:new Date("2025-04-22T00:00:00.000Z"),authors:["abeeshake"],tags:["databases","transactions"],draft:!1},d=void 0,c={authorsImageUrls:[void 0]},u=[{value:"Understanding Dirty Writes: A Database Isolation Problem",id:"understanding-dirty-writes-a-database-isolation-problem",level:2},{value:"What is a Dirty Write?",id:"what-is-a-dirty-write",level:3},{value:"Example Scenario",id:"example-scenario",level:3},{value:"Initial Database State",id:"initial-database-state",level:4},{value:"Step-by-Step: Dirty Write in Action",id:"step-by-step-dirty-write-in-action",level:3},{value:"1. T1 Reads the Original Value",id:"1-t1-reads-the-original-value",level:4},{value:"2. T2 Updates the Value (But Doesn&#39;t Commit)",id:"2-t2-updates-the-value-but-doesnt-commit",level:4},{value:"3. T1 Reads Again (Dirty Write!)",id:"3-t1-reads-again-dirty-write",level:4},{value:"4. T2 Commits",id:"4-t2-commits",level:4},{value:"5. T1 Commits",id:"5-t1-commits",level:4},{value:"Why is This a Problem?",id:"why-is-this-a-problem",level:2},{value:"Visualizing the Dirty Write",id:"visualizing-the-dirty-write",level:2},{value:"Conclusion",id:"conclusion",level:2}];function h(e){const t={br:"br",code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.A,{toc:u}),"\n","\n",(0,s.jsx)(t.h2,{id:"understanding-dirty-writes-a-database-isolation-problem",children:"Understanding Dirty Writes: A Database Isolation Problem"}),"\n",(0,s.jsx)(t.h3,{id:"what-is-a-dirty-write",children:"What is a Dirty Write?"}),"\n",(0,s.jsxs)(t.p,{children:["A ",(0,s.jsx)(t.strong,{children:"dirty write"})," occurs when multiple transactions try to update the same data concurrently without proper isolation,\npotentially causing one transaction to overwrite changes made by another uncommitted transaction."]}),"\n",(0,s.jsx)(t.p,{children:"This can lead to inconsistent or incorrect results in applications, especially in systems where multiple users or processes are accessing and modifying the data concurrently."}),"\n","\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h3,{id:"example-scenario",children:"Example Scenario"}),"\n",(0,s.jsx)(t.p,{children:"Let's walk through a concrete example to see how a dirty write can happen."}),"\n",(0,s.jsx)(t.h4,{id:"initial-database-state",children:"Initial Database State"}),"\n",(0,s.jsx)(t.p,{children:"Suppose we have a simple database table:"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"key"}),(0,s.jsx)(t.th,{children:"value"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"name"}),(0,s.jsx)(t.td,{children:"abhishek"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"age"}),(0,s.jsx)(t.td,{children:"42"})]})]})]}),"\n",(0,s.jsxs)(t.p,{children:["Two transactions, ",(0,s.jsx)(t.strong,{children:"T1"})," and ",(0,s.jsx)(t.strong,{children:"T2"}),", will interact with the ",(0,s.jsx)(t.code,{children:"name"})," row."]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h3,{id:"step-by-step-dirty-write-in-action",children:"Step-by-Step: Dirty Write in Action"}),"\n",(0,s.jsx)(t.h4,{id:"1-t1-reads-the-original-value",children:"1. T1 Reads the Original Value"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"T1"})," starts and reads the value of ",(0,s.jsx)(t.code,{children:"name"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["It sees:",(0,s.jsx)(t.br,{}),"\n",(0,s.jsx)(t.code,{children:"name = 'abhishek'"})," (the committed value)."]}),"\n"]}),"\n",(0,s.jsx)(t.h4,{id:"2-t2-updates-the-value-but-doesnt-commit",children:"2. T2 Updates the Value (But Doesn't Commit)"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"T2"})," starts and updates ",(0,s.jsx)(t.code,{children:"name"})," to ",(0,s.jsx)(t.code,{children:"'john'"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["This change is ",(0,s.jsx)(t.strong,{children:"not yet committed"})," to the database."]}),"\n",(0,s.jsx)(t.li,{children:"Other transactions should ideally not see this uncommitted value."}),"\n"]}),"\n",(0,s.jsx)(t.h4,{id:"3-t1-reads-again-dirty-write",children:"3. T1 Reads Again (Dirty Write!)"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"T1"})," reads the value of ",(0,s.jsx)(t.code,{children:"name"})," again."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsxs)(t.strong,{children:["Because the database isolation level is low (e.g., READ UNCOMMITTED), T1 sees ",(0,s.jsx)(t.code,{children:"name = 'john'"})]}),", even though T2 hasn't committed."]}),"\n",(0,s.jsxs)(t.li,{children:["This is a ",(0,s.jsx)(t.strong,{children:"dirty write"}),": T1 is reading data that might be rolled back."]}),"\n"]}),"\n",(0,s.jsx)(t.h4,{id:"4-t2-commits",children:"4. T2 Commits"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"T2"})," now commits its change."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"name = 'john'"})," is now the official, permanent value."]}),"\n"]}),"\n",(0,s.jsx)(t.h4,{id:"5-t1-commits",children:"5. T1 Commits"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"T1"})," commits, possibly basing its logic on the dirty value it read earlier."]}),"\n"]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h2,{id:"why-is-this-a-problem",children:"Why is This a Problem?"}),"\n",(0,s.jsxs)(t.p,{children:["If ",(0,s.jsx)(t.strong,{children:"T2"})," had rolled back instead of committing, ",(0,s.jsx)(t.strong,{children:"T1"})," would have read a value that never officially existed in the database. This can cause application bugs, data corruption, or security issues."]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h2,{id:"visualizing-the-dirty-write",children:"Visualizing the Dirty Write"}),"\n",(0,s.jsx)(t.p,{children:"The animation below demonstrates this scenario step-by-step. You can see how the database and transactions interact, and exactly when the dirty write occurs."}),"\n",(0,s.jsx)(o.A,{}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,s.jsx)(t.p,{children:"Dirty writes are a classic example of why database isolation levels matter. By default, most production databases avoid dirty writes by using stricter isolation (like READ COMMITTED or higher). However, understanding this scenario helps you appreciate the trade-offs between performance and consistency in concurrent systems."})]})}function m(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},64:(e,t,a)=>{a.d(t,{A:()=>h});var n=a(6540);var s=a(4922),r=a(9437);class i{static generateTexture(e){const{text:t,font:a="600 18px Inter, Arial, sans-serif",fontSize:n=18,textColor:s="#fff",backgroundColor:r="rgba(17,24,39,0.92)",borderRadius:o=12,paddingX:l=24,paddingY:d=12,maxWidth:c=320}=e,u=document.createElement("canvas"),h=u.getContext("2d");h.font=a;const m=h.measureText(t),p=Math.min(m.width,c-2*l)+2*l,x=n+2*d;return u.width=p,u.height=x,h.save(),h.beginPath(),i.roundRect(h,0,0,p,x,o),h.fillStyle=r,h.fill(),h.restore(),h.save(),h.font=a,h.textBaseline="middle",h.textAlign="center",h.fillStyle=s,h.shadowColor="rgba(0,0,0,0.7)",h.shadowBlur=2,h.fillText(t,p/2,x/2,c-2*l),h.restore(),u}static roundRect(e,t,a,n,s,r){e.moveTo(t+r,a),e.lineTo(t+n-r,a),e.quadraticCurveTo(t+n,a,t+n,a+r),e.lineTo(t+n,a+s-r),e.quadraticCurveTo(t+n,a+s,t+n-r,a+s),e.lineTo(t+r,a+s),e.quadraticCurveTo(t,a+s,t,a+s-r),e.lineTo(t,a+r),e.quadraticCurveTo(t,a,t+r,a),e.closePath()}}var o=a(4848);const l=e=>{let{events:t,animationState:a,title:l="Transaction Timeline",layout:d="proportional",showConcurrencyLines:c=!0,labelStyle:u="shader",theme:h={background:"#111827",t1Color:"#06b6d4",t2Color:"#f97316",systemColor:"#6366f1",highlightColor:"#eab308"},onEventClick:m}=e;const p=(0,n.useRef)(null),x=(0,n.useRef)(null),b=(0,n.useRef)(null),g=(0,n.useRef)(null),[y,w]=(0,n.useState)(!0),f=(0,n.useRef)(new s.tBo),v=(0,n.useRef)(new s.I9Y),{currentStep:j,totalSteps:T}=a;(0,n.useEffect)((()=>{const e=setTimeout((()=>{w(!1)}),5e3);return()=>clearTimeout(e)}),[]),(0,n.useEffect)((()=>{const e=p.current;if(!e)return;const t=t=>{const a=e.getBoundingClientRect();v.current.x=(t.clientX-a.left)/a.width*2-1,v.current.y=-(t.clientY-a.top)/a.height*2+1,f.current.setFromCamera(v.current,g.current);const n=f.current.intersectObjects(b.current.children,!0).find((e=>"event"===e.object.userData?.type));e.style.cursor=n?"pointer":"default"},a=t=>{const a=e.getBoundingClientRect();v.current.x=(t.clientX-a.left)/a.width*2-1,v.current.y=-(t.clientY-a.top)/a.height*2+1,f.current.setFromCamera(v.current,g.current);const n=f.current.intersectObjects(b.current.children,!0).find((e=>"event"===e.object.userData?.type));n&&m&&m(n.object.userData.event)};return e.addEventListener("pointermove",t),e.addEventListener("click",a),()=>{e.removeEventListener("pointermove",t),e.removeEventListener("click",a)}}),[m]);const D=e=>{const t=.05,a=new s.iNn(12,t,.1),n=new s.V9B({color:h.systemColor,transparent:!0,opacity:.5}),r=new s.eaF(a,n);r.userData={type:"lane",lane:"main"},e.add(r);const i=new s.iNn(12,t,.1),o=new s.V9B({color:h.t1Color,transparent:!0,opacity:.3}),l=new s.eaF(i,o);l.position.y=2,l.userData={type:"lane",lane:"T1"},e.add(l);const d=new s.iNn(12,t,.1),c=new s.V9B({color:h.t2Color,transparent:!0,opacity:.3}),u=new s.eaF(d,c);u.position.y=-2,u.userData={type:"lane",lane:"T2"},e.add(u)},S=(e,t,a,n)=>{e.children.filter((e=>"progress"===e.userData.type)).forEach((t=>e.remove(t)));const r=e=>{for(let t=e.length-1;t>=0;t--)if(e[t].step<a)return e[t].position/n;return 0},i=t.filter((e=>"T1"===e.tx)),o=t.filter((e=>"T2"===e.tx)),l=r(i),d=r(o),c=12*l,u=new s.iNn(c,.05,.1),m=new s.V9B({color:h.t1Color,transparent:!0,opacity:.7}),p=new s.eaF(u,m);p.position.set(-(6-c/2),2,.05),p.userData={type:"progress",tx:"T1"};const x=new s.HiM(h.t1Color,3,3);x.position.set(-(6-c),2,.5),x.userData={type:"progress",tx:"T1-glow"},e.add(p),e.add(x);const b=12*d,g=new s.iNn(b,.05,.1),y=new s.V9B({color:h.t2Color,transparent:!0,opacity:.7}),w=new s.eaF(g,y);w.position.set(-(6-b/2),-2,.05),w.userData={type:"progress",tx:"T2"};const f=new s.HiM(h.t2Color,3,3);f.position.set(-(6-b),-2,.5),f.userData={type:"progress",tx:"T2-glow"},e.add(w),e.add(f)},C=(e,t,a,n)=>{e.children.filter((e=>"event"===e.userData.type||"event-glow"===e.userData.type||"event-pulse"===e.userData.type||"event-connector"===e.userData.type)).forEach((t=>e.remove(t))),t.forEach(((r,i)=>{const o=I(r,t,n);let l=0;"T1"===r.tx&&(l=2),"T2"===r.tx&&(l=-2);const d=a>r.step,c=a===r.step;let u=h.systemColor;if("T1"===r.tx&&(u=h.t1Color),"T2"===r.tx&&(u=h.t2Color),r.highlight&&(u=h.highlightColor),!d&&!c){u=`#${new s.Q1f(u).offsetHSL(0,0,-.3).getHexString()}`}const m=c?.25:.2,p=new s.Gu$(m,16,16),x=new s.V9B({color:u,transparent:!0,opacity:d||c?1:.6}),b=new s.eaF(p,x);if(b.position.set(o,l,.2),b.userData={type:"event",eventIndex:i,action:r.action,tx:r.tx,event:r},e.add(b),d||c){const t=new s.HiM(u,2,1.5);if(t.position.set(o,l,.5),t.userData={type:"event-glow",eventIndex:i},e.add(t),c){const t=new s.Gu$(.1,16,16),a=new s.V9B({color:16777215,transparent:!0,opacity:.7}),n=new s.eaF(t,a);n.position.set(o,l,.3),n.userData={type:"event-pulse",eventIndex:i,createdAt:Date.now()},e.add(n)}}if(r.tx){const t=4,a=new s.iNn(.02,t,.05),n=new s.V9B({color:u,transparent:!0,opacity:.3}),l=new s.eaF(a,n);l.position.set(o,(r.tx,0),.1),l.userData={type:"event-connector",eventIndex:i},e.add(l)}}))},N=(e,t,a,n)=>{e.children.filter((e=>"event-connector"===e.userData.type)).forEach((t=>e.remove(t))),t.forEach(((a,r)=>{if(a.tx){const i=I(a,t,n),o=4;let l=h.systemColor;"T1"===a.tx&&(l=h.t1Color),"T2"===a.tx&&(l=h.t2Color),a.highlight&&(l=h.highlightColor);const d=new s.iNn(.02,o,.05),c=new s.V9B({color:l,transparent:!0,opacity:.3}),u=new s.eaF(d,c);u.position.set(i,(a.tx,0),.1),u.userData={type:"event-connector",eventIndex:r},e.add(u)}}))},R=(e,t,a,n)=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("h3",{className:"absolute top-2 left-4 text-xl font-bold text-white mb-4 pb-2 border-b border-gray-600/50 z-10",children:n}),(0,o.jsx)("div",{className:"absolute top-1/3 left-6 -translate-y-1/2 text-sm font-medium text-cyan-400/90 px-2 py-1 rounded-md bg-cyan-950/30 border border-cyan-500/20 shadow-sm z-10",children:"T1"}),(0,o.jsx)("div",{className:"absolute top-2/3 left-6 -translate-y-1/2 text-sm font-medium text-orange-400/90 px-2 py-1 rounded-md bg-orange-950/30 border border-orange-500/20 shadow-sm z-10",children:"T2"}),e.map(((t,n)=>{const s=I(t,e,a),r="T1"===t.tx?"bottom-10":"top-10";return(0,o.jsx)("div",{className:"absolute left-0 top-1/2 transform -translate-y-1/2 z-20 pointer-events-none",style:{left:16+.68*s+"%"},children:(0,o.jsx)("div",{className:`max-w-40 whitespace-nowrap text-xs font-medium px-2.5 py-1.5 rounded-lg ${r} bg-gray-900/60 border border-gray-500/50 shadow-lg transition-all duration-300 absolute`,style:{overflow:"hidden",textOverflow:"ellipsis",transform:"translateX(-50%)",textShadow:"0 1px 3px rgba(0,0,0,0.7)"},children:t.action})},n)}))]}),k=(()=>{let e=null,t=null,a=null;return{update:(n,r,o,l,d,c)=>{for(e||(e=new s.YJl,n.add(e)),t=r,a=o;e.children.length;){const t=e.children[0];e.remove(t),t.material?.map&&t.material.map.dispose(),t.material&&t.material.dispose(),t.geometry&&t.geometry.dispose()}l.forEach((t=>{const a=d>t.step,n=d===t.step;if(!a&&!n)return;const r=I(t,l,c);let o=0;"T1"===t.tx&&(o=2),"T2"===t.tx&&(o=-2);let u=h.systemColor,m=new s.Q1f(h.systemColor);"T1"===t.tx?(u=h.t1Color,m=new s.Q1f(h.t1Color)):"T2"===t.tx&&(u=h.t2Color,m=new s.Q1f(h.t2Color)),t.highlight&&(u=h.highlightColor,m=new s.Q1f(h.highlightColor));const p=t.labelOffset||0,x=o+("T1"===t.tx?-1.5:1.5)+p,b=i.generateTexture({text:t.action,font:"600 16px Inter, Arial, sans-serif",textColor:"#fff",backgroundColor:u+"40",borderRadius:8,paddingX:12,paddingY:12,maxWidth:220}),g=2/(b.width/b.height),y=((e,t,a)=>new s.BKk({uniforms:{baseTexture:{value:e},glowColor:{value:t},glowIntensity:{value:a},time:{value:0}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n          vUv = uv;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ",fragmentShader:"\n        uniform sampler2D baseTexture;\n        uniform vec3 glowColor;\n        uniform float glowIntensity;\n        uniform float time;\n        varying vec2 vUv;\n        void main() {\n          vec4 texColor = texture2D(baseTexture, vUv);\n          gl_FragColor = texColor;\n          if (glowIntensity > 0.0) {\n            float pulseFactor = 0.5 + 0.5 * sin(time * 3.0);\n            vec3 glow = glowColor * glowIntensity * pulseFactor;\n            gl_FragColor.rgb += glow * texColor.a;\n          }\n        }\n      ",transparent:!0,side:s.$EB}))(new s.GOR(b),m,n?.4:.2),w=new s.bdM(2,g),f=new s.eaF(w,y);f.position.set(r,x,1),f.userData={eventId:t.id,animation:{pulsate:n,fade:!1}},e.add(f)}))},animate:t=>{e&&a&&e.children.forEach((e=>{const n=e;if(n.quaternion.copy(a.quaternion),n.material.uniforms&&(n.material.uniforms.time.value=t/1e3),n.userData.animation){const e=n.userData.animation;if(e.pulsate){const e=1+.1*Math.sin(t/500);n.scale.set(e,e,1)}e.fade&&(n.material.opacity=.5+.5*Math.sin(t/700))}}))}}})(),W=(()=>{let e=null,t=[],a=[];return{update:(n,r,i,o)=>{if(!c)return;for(e||(e=new s.YJl,n.add(e));e.children.length;){const t=e.children[0];e.remove(t),t.material&&t.material.dispose(),t.geometry&&t.geometry.dispose()}t=[],a=[];const l=[];r.forEach((e=>{e.concurrentWith&&e.concurrentWith.forEach((t=>{const a=r.find((e=>e.id===t));a&&(i>=e.step||i>=a.step)&&(l.some((t=>{let[n,s]=t;return n.id===a.id&&s.id===e.id||n.id===e.id&&s.id===a.id}))||l.push([e,a]))}))})),l.forEach((n=>{const[i,l]=n,d=I(i,r,o),c=I(l,r,o),u="T1"===i.tx?2:-2,m="T1"===l.tx?2:-2,p=[new s.Pq0(d,u,.2),new s.Pq0(c,m,.2)],x=(new s.LoY).setFromPoints(p),b=new s.Fvt({color:h.highlightColor,dashSize:.2,gapSize:.1,opacity:.7,transparent:!0});b.dashOffset=0;const g=new s.N1A(x,b);g.computeLineDistances(),e.add(g),t.push(g);const y=new s.Gu$(.1,8,8),w=new s.V9B({color:h.highlightColor,transparent:!0,opacity:.7}),f=new s.eaF(y,w.clone());f.position.set(d,u,.25);const v=new s.eaF(y,w.clone());v.position.set(c,m,.25),e.add(f),e.add(v),a.push(f,v)}))},animate:e=>{t.forEach((t=>{void 0!==t.material.dashOffset&&(t.material.dashOffset=.2*Math.sin(e/400))})),a.forEach((t=>{const a=1+.3*Math.abs(Math.sin(e/500));t.scale.set(a,a,a),void 0!==t.material.opacity&&(t.material.opacity=.5+.5*Math.abs(Math.sin(e/500)))}))}}})(),I=(e,t,a)=>{if("absolute"===d&&void 0!==e.timestamp){const a=V(t);return(e.timestamp-a.min)/(a.max-a.min)*12-6}return e.position/a*12-6},V=e=>{const t=e.filter((e=>void 0!==e.timestamp)).map((e=>e.timestamp));return{min:Math.min(...t),max:Math.max(...t)}};(0,n.useEffect)((()=>{if(!p.current)return;const e=new s.Z58;e.background=new s.Q1f(h.background),b.current=e;const t=new s.ubm(45,p.current.clientWidth/p.current.clientHeight,.1,1e3);t.position.z=10,g.current=t;const a=new r.JeP({antialias:!0,alpha:!0});a.setSize(p.current.clientWidth,p.current.clientHeight),a.setPixelRatio(window.devicePixelRatio),p.current.appendChild(a.domElement),x.current=a,D(e);const n=()=>{p.current&&a&&t&&(t.aspect=p.current.clientWidth/p.current.clientHeight,t.updateProjectionMatrix(),a.setSize(p.current.clientWidth,p.current.clientHeight))};window.addEventListener("resize",n);const i=n=>{requestAnimationFrame(i),k.animate(n),W.animate(n),a&&e&&t&&a.render(e,t)};return i(performance.now()),()=>{window.removeEventListener("resize",n),p.current&&a&&p.current.removeChild(a.domElement),e.clear()}}),[]),(0,n.useEffect)((()=>{b.current&&x.current&&g.current&&(S(b.current,t,j,T),C(b.current,t,j,T),N(b.current,t,j,T),"shader"===u&&k.update(b.current,x.current,g.current,t,j,T),W.update(b.current,t,j,T))}),[t,j,T,u,c,h,d]);return(0,o.jsx)("div",{className:"w-full mt-2 mb-6 px-6 py-4 bg-gray-800/90 backdrop-blur-sm rounded-lg shadow-md border border-gray-700",children:(0,o.jsx)("div",{ref:p,className:"relative h-72 bg-gray-900/50 backdrop-blur rounded-xl border border-gray-700/50 overflow-hidden px-8 py-6 mx-4 my-2 group",onMouseEnter:()=>w(!0),onMouseLeave:()=>w(!1),children:"html"!==u?null:R(t,j,T,l)})})};var d=a(4685);const c=e=>{let{animationState:t,handlePlay:a,handlePause:s,handleStep:r,handleReset:i,handleSpeedChange:l}=e;const c=(0,n.useRef)(null),u=(0,n.useRef)(null),h=(0,n.useRef)(null),m=(0,n.useRef)({play:!1,step:!1,reset:!1}),p=(e,t)=>{if(!m.current[t]){const a=e.current;if(a){const e=a.getBoundingClientRect(),n=(e.left+e.width/2)/window.innerWidth,s=(e.top+e.height/2)/window.innerHeight;(0,d.A)({particleCount:100,spread:70,origin:{x:n,y:s},colors:["#22c55e","#3b82f6","#64748b","#ef4444","#a855f7"]}),m.current[t]=!0}}};(0,n.useEffect)((()=>{0===t.currentStep&&(m.current={play:!1,step:!1,reset:!1})}),[t.currentStep]);return(0,o.jsxs)("div",{className:"w-full max-w-4xl flex flex-wrap justify-center items-center gap-3 mt-4 p-3 bg-gray-800/90 backdrop-blur-sm rounded-lg shadow-md border border-gray-700 sticky bottom-0 z-50",children:[(0,o.jsx)("button",{ref:c,onClick:()=>{p(c,"play"),a()},disabled:t.isRunning&&!t.isPaused,className:"px-5 py-2 text-base bg-blue-600 text-white font-semibold rounded-md shadow hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-all duration-150 ease-in-out relative overflow-visible",children:t.currentStep>=t.totalSteps?"Replay":t.isPaused?"Resume":"Play"}),(0,o.jsx)("button",{onClick:s,disabled:!t.isRunning||t.isPaused,className:"px-5 py-2 text-base bg-yellow-500 text-white font-semibold rounded-md shadow hover:bg-yellow-600 disabled:bg-gray-400 disabled:cursor-not-allowed transition-all duration-150",children:"Pause"}),(0,o.jsx)("button",{ref:u,onClick:()=>{p(u,"step"),r()},disabled:t.isRunning||t.currentStep>=t.totalSteps,className:"px-5 py-2 text-base bg-purple-600 text-white font-semibold rounded-md shadow hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-all duration-150",children:"Step"}),(0,o.jsx)("button",{ref:h,onClick:()=>{p(h,"reset"),i()},className:"px-5 py-2 text-base bg-red-600 text-white font-semibold rounded-md shadow hover:bg-red-700 transition-all duration-150",children:"Reset"}),(0,o.jsxs)("div",{className:"flex items-center gap-3 px-3 md:px-5 py-2 bg-gray-700/50 backdrop-blur-sm rounded-md",children:[(0,o.jsxs)("label",{htmlFor:"speed-slider",className:"text-white text-sm whitespace-nowrap",children:["Speed: x",t.speed.toFixed(1)]}),(0,o.jsx)("input",{id:"speed-slider",type:"range",min:"0.5",max:"2.5",step:"0.5",value:t.speed,onChange:l,className:"w-24 md:w-36 h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-blue-500"})]}),(0,o.jsxs)("div",{className:"hidden md:flex items-center gap-2 px-3 md:px-5 py-2 bg-gray-700/50 backdrop-blur-sm rounded-md",children:[(0,o.jsxs)("span",{className:"text-white text-sm whitespace-nowrap",children:["Progress: ",t.currentStep," / ",t.totalSteps]}),(0,o.jsx)("div",{className:"w-24 md:w-32 bg-gray-600 rounded-full h-2.5 overflow-hidden",children:(0,o.jsx)("div",{className:"bg-green-600 h-2.5 rounded-full transition-all duration-300 ease-out",style:{width:t.currentStep/t.totalSteps*100+"%"}})})]})]})},u=e=>{let{systemState:t,animationState:a,currentStatus:n,issueType:s}=e;const{dbData:r,transaction1:i,transaction2:l}=t,d=(a.currentStep,i.status),c=l.status,u=i.isDirtyRead,h=i.isDirtyWrite||l.isDirtyWrite,m=e=>{switch(e){case"idle":return"Idle";case"reading":return"Reading";case"writing":return"Writing";case"holding_read":return"Holding Read";case"holding_uncommitted_write":return"Holding Uncommitted Write";case"committed":return"Committed";case"error_dirty_read":return"DIRTY READ ERROR";case"error_dirty_write":return"DIRTY WRITE ERROR";default:return e}},p=e=>{switch(e){case"idle":return"text-gray-300";case"reading":case"holding_read":return"text-cyan-400";case"writing":case"holding_uncommitted_write":return"text-orange-400";case"committed":return"text-green-400";case"error_dirty_read":case"error_dirty_write":return"text-yellow-400";default:return"text-white"}};return(0,o.jsxs)("div",{className:"w-full mt-2 mb-6 px-6 py-4 bg-gray-800/90 backdrop-blur-sm rounded-lg shadow-md border border-gray-700",children:[(0,o.jsx)("div",{className:"flex justify-center mb-8",children:(0,o.jsxs)("div",{className:"relative bg-gray-900 rounded-lg border border-gray-600 p-6 w-full max-w-md shadow-lg",children:[(0,o.jsx)("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2 bg-blue-600 text-white px-3 py-1 rounded-md text-sm font-bold",children:"Database"}),(0,o.jsxs)("table",{className:"w-full text-white border-collapse",children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{className:"border-b border-gray-700 py-2 text-left w-1/3",children:"Key"}),(0,o.jsx)("th",{className:"border-b border-gray-700 py-2 text-left w-2/3",children:"Value"})]})}),(0,o.jsxs)("tbody",{children:[(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{className:"py-2 font-mono",children:r.key}),(0,o.jsxs)("td",{className:"py-2 font-mono flex items-center gap-2",children:[(0,o.jsx)("span",{className:"text-blue-400 whitespace-nowrap",children:r.committedValue}),(0,o.jsx)("span",{className:"text-xs text-blue-300 whitespace-nowrap",children:"(committed)"})]})]}),r.uncommittedValue&&(0,o.jsxs)("tr",{className:"bg-red-900/20",children:[(0,o.jsx)("td",{className:"py-2 font-mono",children:r.key}),(0,o.jsxs)("td",{className:"py-2 font-mono flex items-center gap-2",children:[(0,o.jsx)("span",{className:"text-red-400 whitespace-nowrap",children:r.uncommittedValue}),(0,o.jsxs)("span",{className:"text-xs text-red-300 whitespace-nowrap",children:["(uncommitted by ",r.writerTx,")"]})]})]})]})]})]})}),(0,o.jsx)("div",{className:"w-full max-w-4xl mb-4 p-4 bg-gray-800/90 backdrop-blur-sm rounded-lg shadow-md text-center border border-gray-700 mx-auto",children:(0,o.jsxs)("p",{className:"font-medium text-white text-lg leading-tight",children:[(0,o.jsx)("span",{className:"font-bold text-indigo-300",children:"Status:"})," ",n,(0,o.jsxs)("span",{className:"ml-6 text-gray-300 text-base",children:["(Step: ",a.currentStep,"/",a.totalSteps,")"]})]})}),(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,o.jsxs)("div",{className:`relative bg-gray-900 rounded-lg border ${u||h&&i.isDirtyWrite?"border-yellow-500":"border-gray-600"} p-4 shadow-lg`,children:[(0,o.jsx)("div",{className:`absolute -top-3 left-4 ${u||h&&i.isDirtyWrite?"bg-yellow-500":"bg-cyan-600"} text-white px-3 py-1 rounded-md text-sm font-bold`,children:"Transaction 1"}),(0,o.jsxs)("div",{className:"mt-3",children:[(0,o.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,o.jsx)("span",{className:"text-gray-400",children:"Status:"}),(0,o.jsx)("span",{className:`font-medium ${p(d)}`,children:m(d)})]}),i.lastReadValue&&(0,o.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,o.jsx)("span",{className:"text-gray-400",children:"Last Read:"}),(0,o.jsxs)("span",{className:"font-mono "+(u?"text-yellow-400":"text-white"),children:["'",i.lastReadValue,"'",u&&(0,o.jsx)("span",{className:"ml-1 text-xs text-yellow-300",children:"(dirty!)"})]})]}),i.lastWriteValue&&(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("span",{className:"text-gray-400",children:"Last Write:"}),(0,o.jsxs)("span",{className:"font-mono "+(i.isDirtyWrite?"text-yellow-400":"text-white"),children:["'",i.lastWriteValue,"'",i.isDirtyWrite&&(0,o.jsx)("span",{className:"ml-1 text-xs text-yellow-300",children:"(dirty!)"})]})]}),u&&"dirty-read"===s&&(0,o.jsxs)("div",{className:"mt-3 p-2 bg-yellow-900/30 border border-yellow-800 rounded text-yellow-300 text-sm",children:[(0,o.jsx)("span",{className:"font-bold",children:"\u26a0\ufe0f Dirty Read:"})," Reading uncommitted data from T2"]}),i.isDirtyWrite&&"dirty-write"===s&&(0,o.jsxs)("div",{className:"mt-3 p-2 bg-yellow-900/30 border border-yellow-800 rounded text-yellow-300 text-sm",children:[(0,o.jsx)("span",{className:"font-bold",children:"\u26a0\ufe0f Dirty Write:"})," Writing over uncommitted data from T2"]})]})]}),(0,o.jsxs)("div",{className:`relative bg-gray-900 rounded-lg border ${h&&l.isDirtyWrite?"border-yellow-500":"border-gray-600"} p-4 shadow-lg`,children:[(0,o.jsx)("div",{className:`absolute -top-3 left-4 ${h&&l.isDirtyWrite?"bg-yellow-500":"bg-orange-600"} text-white px-3 py-1 rounded-md text-sm font-bold`,children:"Transaction 2"}),(0,o.jsxs)("div",{className:"mt-3",children:[(0,o.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,o.jsx)("span",{className:"text-gray-400",children:"Status:"}),(0,o.jsx)("span",{className:`font-medium ${p(c)}`,children:m(c)})]}),l.lastReadValue&&(0,o.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,o.jsx)("span",{className:"text-gray-400",children:"Last Read:"}),(0,o.jsxs)("span",{className:"font-mono text-white",children:["'",l.lastReadValue,"'"]})]}),l.lastWriteValue&&(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("span",{className:"text-gray-400",children:"Last Write:"}),(0,o.jsxs)("span",{className:"font-mono "+(l.isDirtyWrite?"text-yellow-400":"text-white"),children:["'",l.lastWriteValue,"'",l.isDirtyWrite&&(0,o.jsx)("span",{className:"ml-1 text-xs text-yellow-300",children:"(dirty!)"})]})]}),"holding_uncommitted_write"===c&&(0,o.jsxs)("div",{className:"mt-3 p-2 bg-orange-900/30 border border-orange-800 rounded text-orange-300 text-sm",children:[(0,o.jsx)("span",{className:"font-bold",children:"\ud83d\udd12 Lock:"})," Holding write lock on '",r.key,"'"]}),l.isDirtyWrite&&"dirty-write"===s&&(0,o.jsxs)("div",{className:"mt-3 p-2 bg-yellow-900/30 border border-yellow-800 rounded text-yellow-300 text-sm",children:[(0,o.jsx)("span",{className:"font-bold",children:"\u26a0\ufe0f Dirty Write:"})," Writing over uncommitted data from T1"]})]})]})]})]})},h=()=>{const{animationState:e,setAnimationState:t,handleSpeedChange:a,resetAnimation:s,startAnimation:r,pauseAnimation:i,stepForward:d,setTotalSteps:h}=(e=>{const[t,a]=(0,n.useState)({isRunning:!1,isPaused:!1,currentStep:0,totalSteps:e,speed:1}),s=(0,n.useCallback)((e=>{a((t=>({...t,speed:parseFloat(e.target.value)})))}),[]),r=(0,n.useCallback)((()=>{a((e=>({...e,isRunning:!1,isPaused:!1,currentStep:0})))}),[]),i=(0,n.useCallback)((()=>{a((e=>({...e,isRunning:!0,isPaused:!1})))}),[]),o=(0,n.useCallback)((()=>{a((e=>({...e,isRunning:!1,isPaused:!0})))}),[]),l=(0,n.useCallback)((()=>{a((e=>({...e,currentStep:e.currentStep+1})))}),[]),d=(0,n.useCallback)((e=>{a((t=>({...t,totalSteps:e})))}),[]);return{animationState:t,setAnimationState:a,handleSpeedChange:s,resetAnimation:r,startAnimation:i,pauseAnimation:o,stepForward:l,setTotalSteps:d}})(9),{systemState:m,setSystemState:p,resetSystem:x}=((e,t)=>{const a={status:"idle",lastReadValue:null,lastWriteValue:null,isDirtyRead:!1,isDirtyWrite:!1},[s,r]=(0,n.useState)({dbData:{key:e,committedValue:t,uncommittedValue:null,writerTx:null},transaction1:{...a},transaction2:{...a}}),i=(0,n.useCallback)((()=>{r({dbData:{key:e,committedValue:t,uncommittedValue:null,writerTx:null},transaction1:{...a},transaction2:{...a}})}),[e,t]);return{systemState:s,setSystemState:r,resetSystem:i}})("account_balance","$1000"),[b,g]=(0,n.useState)("Database is in initial state"),y=(0,n.useRef)(null);(0,n.useEffect)((()=>()=>{y.current&&clearInterval(y.current)}),[]);const w=(0,n.useCallback)((()=>{const a=e.currentStep;0===a?g("Database is in initial state"):1===a?(p((e=>({...e,transaction1:{...e.transaction1,status:"idle"}}))),g("Transaction T1 begins")):2===a?(p((e=>({...e,transaction1:{...e.transaction1,status:"reading",lastReadValue:e.dbData.committedValue}}))),g("T1 reads balance=$1000")):3===a?(p((e=>({...e,transaction1:{...e.transaction1,status:"holding_read"}}))),g("T1 calculates new balance: $1000-$200=$800")):4===a?(p((e=>({...e,dbData:{...e.dbData,uncommittedValue:"$800",writerTx:"T1"},transaction1:{...e.transaction1,status:"holding_uncommitted_write",lastWriteValue:"$800"}}))),g("T1 writes balance=$800 but has not committed yet")):5===a?(p((e=>({...e,transaction2:{...e.transaction2,status:"idle"}}))),g("Transaction T2 begins")):6===a?(p((e=>({...e,transaction2:{...e.transaction2,status:"reading",lastReadValue:e.dbData.committedValue}}))),g("T2 reads the committed balance=$1000 (ignoring T1's uncommitted write)")):7===a?(p((e=>({...e,transaction2:{...e.transaction2,status:"holding_read"}}))),g("T2 calculates new balance: $1000-$300=$700")):8===a?(p((e=>({...e,dbData:{...e.dbData,uncommittedValue:"$700",writerTx:"T2"},transaction1:{...e.transaction1,isDirtyWrite:!0},transaction2:{...e.transaction2,status:"error_dirty_write",lastWriteValue:"$700",isDirtyWrite:!0}}))),g("T2 writes balance=$700, overwriting T1's uncommitted write - THIS IS A DIRTY WRITE!")):9===a&&(g("Issue Detected: T2 overwrote T1's uncommitted changes (dirty write). When T1 commits, its changes will be lost!"),i()),a<9?t((e=>({...e,currentStep:e.currentStep+1}))):i()}),[e.currentStep,t,p,i,9]);(0,n.useEffect)((()=>{if(e.isRunning&&!e.isPaused){y.current&&clearInterval(y.current);const t=1e3/e.speed;y.current=setInterval((()=>{e.currentStep<9?w():i()}),t)}else y.current&&clearInterval(y.current);return()=>{y.current&&clearInterval(y.current)}}),[e.isRunning,e.isPaused,e.speed,e.currentStep,w,9,i]);const f=(0,n.useCallback)((()=>{e.currentStep>=9&&(x(),s()),r()}),[e.currentStep,9,x,s,r]),v=(0,n.useCallback)((()=>{e.currentStep<9&&w()}),[e.currentStep,9,w]),j=(0,n.useCallback)((()=>{x(),s(),g("Database is in initial state")}),[x,s]);return(0,o.jsxs)("div",{className:"w-full max-w-4xl mx-auto mt-8 mb-20",children:[(0,o.jsx)("h2",{className:"text-2xl font-bold text-white mb-6",children:"Dirty Write Anomaly Demonstration"}),(0,o.jsxs)("div",{className:"bg-gray-800/80 backdrop-blur-sm rounded-lg border border-gray-700 p-4 mb-6 text-gray-300",children:[(0,o.jsx)("h3",{className:"text-xl font-semibold text-white mb-2",children:"What is a Dirty Write?"}),(0,o.jsx)("p",{className:"mb-3",children:"A dirty write occurs when multiple transactions try to update the same data concurrently without proper isolation, potentially causing one transaction to overwrite changes made by another uncommitted transaction."}),(0,o.jsx)("p",{children:"In this example, Transaction T1 writes a new balance but doesn't commit. Before T1 commits, Transaction T2 also writes to the same record, overwriting T1's uncommitted changes. This leads to lost updates and data inconsistency."})]}),(0,o.jsx)(l,{events:[{step:0,tx:null,action:"Initial State",position:0},{step:1,tx:"T1",action:"Begin Transaction",position:1},{step:2,tx:"T1",action:"Read balance=$1000",position:2},{step:3,tx:"T1",action:"Calculate: $1000-$200",position:3},{step:4,tx:"T1",action:"Write balance=$800",position:4},{step:5,tx:"T2",action:"Begin Transaction",position:5},{step:6,tx:"T2",action:"Read balance=$1000",position:6},{step:7,tx:"T2",action:"Calculate: $1000-$300",position:7},{step:8,tx:"T2",action:"Write balance=$700",position:8,highlight:!0},{step:9,tx:null,action:"Dirty Write Occurred!",position:9}],animationState:e}),(0,o.jsx)(u,{systemState:m,animationState:e,currentStatus:b,issueType:"dirty-write"}),(0,o.jsx)(c,{animationState:e,handlePlay:f,handlePause:i,handleStep:v,handleReset:j,handleSpeedChange:a})]})}},1222:e=>{e.exports=JSON.parse('{"permalink":"/byte_vault/database-isolation-visualised-dirty-writes","source":"@site/blog/2025-04-22-db-isolation-002.mdx","title":"Database Isolation (dirty writes)","description":"Understanding Dirty Writes: A Database Isolation Problem","date":"2025-04-22T00:00:00.000Z","tags":[{"inline":true,"label":"databases","permalink":"/byte_vault/tags/databases"},{"inline":true,"label":"transactions","permalink":"/byte_vault/tags/transactions"}],"readingTime":2.085,"hasTruncateMarker":true,"authors":[{"name":"Abhishek Tripathi","title":"Curiosity brings awareness.","url":"https://github.com/TwistingTwists","page":{"permalink":"/byte_vault/authors/abeeshake"},"socials":{"x":"https://x.com/twistin456","github":"https://github.com/TwistingTwists"},"imageURL":"https://github.com/TwistingTwists.png","key":"abeeshake"}],"frontMatter":{"slug":"database-isolation-visualised-dirty-writes","title":"Database Isolation (dirty writes)","date":"2025-04-22T00:00:00.000Z","authors":["abeeshake"],"tags":["databases","transactions"],"draft":false},"unlisted":false,"nextItem":{"title":"Database Isolation (dirty reads)","permalink":"/byte_vault/database-isolation-visualised-dirty-reads"}}')}}]);