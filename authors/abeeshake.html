<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-authors-posts-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Abhishek Tripathi - 15 posts | Byte Vault</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://twistingtwists.github.io/byte_vault/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://twistingtwists.github.io/byte_vault/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://twistingtwists.github.io/byte_vault/authors/abeeshake"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="Abhishek Tripathi - 15 posts | Byte Vault"><meta data-rh="true" name="docusaurus_tag" content="blog_authors_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_authors_posts"><link data-rh="true" rel="icon" href="/byte_vault/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://twistingtwists.github.io/byte_vault/authors/abeeshake"><link data-rh="true" rel="alternate" href="https://twistingtwists.github.io/byte_vault/authors/abeeshake" hreflang="en"><link data-rh="true" rel="alternate" href="https://twistingtwists.github.io/byte_vault/authors/abeeshake" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/byte_vault/rss.xml" title="Byte Vault RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/byte_vault/atom.xml" title="Byte Vault Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-B9R18KF2Y1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-B9R18KF2Y1",{})</script>





<script src="/scripts/processMultiline.ts" async></script><link rel="stylesheet" href="/byte_vault/assets/css/styles.5632c914.css">
<script src="/byte_vault/assets/js/runtime~main.9a43f41a.js" defer="defer"></script>
<script src="/byte_vault/assets/js/main.44ba613e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/byte_vault/img/logo.svg"><link rel="preload" as="image" href="https://github.com/TwistingTwists.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/byte_vault/"><div class="navbar__logo"><img src="/byte_vault/img/logo.svg" alt="Byte Vault" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/byte_vault/img/logo.svg" alt="Byte Vault" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Byte Vault</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/byte_vault/">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/TwistingTwists/bytevault" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/byte_vault/claude-code-context-engineering-v2">The Day I Taught Claude Code to Work Without Me (And How You Can Too)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/byte_vault/database-isolation-visualised-dual-anomalies">DB-010: Dual Anomalies</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/byte_vault/database-isolation-phantom-read">DB-008: Phantom Read</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/byte_vault/database-isolation-visualised-mvcc-visibility-rules">DB-007: MVCC Visibility Rules</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/byte_vault/database-isolation-visualised-dirty-reads">DB-001: Database Isolation (dirty reads)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/byte_vault/tokio-internals-visualised">Understanding Eventloops (Tokio Internals)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/byte_vault/connection-pooling-in-depth">Connection Pooling - in Depth</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/byte_vault/reliable-structured-outputs-with-llms">Reliable Structured Outputs with LLMs</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/byte_vault/string-interning-rust">String interning in Rust</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/byte_vault/rust-tips-tricks">Rust tricks for the average developer (me)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/byte_vault/neat-bash-script">Neat bash script</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/byte_vault/streaming-http-to-disk">Streaming HTTP to Disk</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/byte_vault/deep-flattening-in-rust-using-recursive-types">Deep Flattening in Rust - Using Recursive Types </a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/byte_vault/how-to-solve-reverse-proxy-performance-issues-in-caddy-server-a-300-performance-boost-using-unix-sockets">Caddy Reverse Proxy Performance: 300% Boost with Unix Sockets</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/byte_vault/1brc-same-tricks-across-languages">1brc - same tricks across languages</a></li></ul></div></nav></aside><main class="col col--7"><header class="margin-bottom--xl"><div class="avatar margin-bottom--sm author-as-h1_n9oJ"><a class="avatar__photo-link" href="/byte_vault/authors/abeeshake"><img class="avatar__photo authorImage_XqGP" src="https://github.com/TwistingTwists.png" alt="Abhishek Tripathi"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/byte_vault/authors/abeeshake"><h1 class="authorName_yefp">Abhishek Tripathi</h1></a></div><small class="authorTitle_nd0D" title="Curiosity brings awareness.">Curiosity brings awareness.</small><div class="authorSocials_rSDt"><a href="https://x.com/twistin456" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="X"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="none" viewBox="0 0 1200 1227" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf xSvg_y3PF"><path d="M714.163 519.284 1160.89 0h-105.86L667.137 450.887 357.328 0H0l468.492 681.821L0 1226.37h105.866l409.625-476.152 327.181 476.152H1200L714.137 519.284h.026ZM569.165 687.828l-47.468-67.894-377.686-540.24h162.604l304.797 435.991 47.468 67.894 396.2 566.721H892.476L569.165 687.854v-.026Z"></path></svg></a><a href="https://github.com/TwistingTwists" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a></div></div></div><a href="/byte_vault/authors">View all authors</a></header><hr><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/byte_vault/claude-code-context-engineering-v2">The Day I Taught Claude Code to Work Without Me (And How You Can Too)</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-07-21T00:00:00.000Z">July 21, 2025</time> ¬∑ <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/byte_vault/authors/abeeshake"><img class="avatar__photo authorImage_XqGP" src="https://github.com/TwistingTwists.png" alt="Abhishek Tripathi"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/byte_vault/authors/abeeshake"><span class="authorName_yefp">Abhishek Tripathi</span></a></div><small class="authorTitle_nd0D" title="Curiosity brings awareness.">Curiosity brings awareness.</small><div class="authorSocials_rSDt"><a href="https://x.com/twistin456" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="X"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="none" viewBox="0 0 1200 1227" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf xSvg_y3PF"><path d="M714.163 519.284 1160.89 0h-105.86L667.137 450.887 357.328 0H0l468.492 681.821L0 1226.37h105.866l409.625-476.152 327.181 476.152H1200L714.137 519.284h.026ZM569.165 687.828l-47.468-67.894-377.686-540.24h162.604l304.797 435.991 47.468 67.894 396.2 566.721H892.476L569.165 687.854v-.026Z"></path></svg></a><a href="https://github.com/TwistingTwists" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a></div></div></div></div></div></header><div class="markdown"><div style="border:2px solid #ffb300;border-radius:8px;background:#fffbe7;padding:1em;margin:1em 0;box-shadow:0 2px 8px rgba(0,0,0,0.06)"><b style="font-size:1.2em">üßÉ TL;DR</b><ul style="margin:0"><li><b>Problem:</b> <!-- -->You&#x27;re trapped micromanaging Claude Code instead of building</li><li><b>Solution:</b> <!-- -->Train Claude Code once, then let it work autonomously</li><li><b>How it Works:</b> <!-- -->Strategic context engineering: CLAUDE.md files, systematic workflows, and learning capture</li><li><b>Benefit:</b> <!-- -->Claude Code becomes your autonomous teammate</li></ul></div>
<p>Here is <a href="https://gist.github.com/tripathi456/bfaf9add4b70bff131cd574c2f93cfac" target="_blank" rel="noopener noreferrer">CLAUDE.md</a></p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" title="Artificial Intelligence" class="tag_zVej tagRegular_sFm0" href="/byte_vault/tags/ai">AI</a></li><li class="tag_QGVx"><a rel="tag" title="Context engineering and prompt optimization" class="tag_zVej tagRegular_sFm0" href="/byte_vault/tags/context-engineering">Context Engineering</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/byte_vault/tags/claude-code">claude-code</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/byte_vault/tags/productivity">productivity</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about The Day I Taught Claude Code to Work Without Me (And How You Can Too)" href="/byte_vault/claude-code-context-engineering-v2"><b>Read more</b></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/byte_vault/database-isolation-visualised-dual-anomalies">DB-010: Dual Anomalies</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-06-12T00:00:00.000Z">June 12, 2025</time> ¬∑ <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/byte_vault/authors/abeeshake"><img class="avatar__photo authorImage_XqGP" src="https://github.com/TwistingTwists.png" alt="Abhishek Tripathi"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/byte_vault/authors/abeeshake"><span class="authorName_yefp">Abhishek Tripathi</span></a></div><small class="authorTitle_nd0D" title="Curiosity brings awareness.">Curiosity brings awareness.</small><div class="authorSocials_rSDt"><a href="https://x.com/twistin456" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="X"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="none" viewBox="0 0 1200 1227" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf xSvg_y3PF"><path d="M714.163 519.284 1160.89 0h-105.86L667.137 450.887 357.328 0H0l468.492 681.821L0 1226.37h105.866l409.625-476.152 327.181 476.152H1200L714.137 519.284h.026ZM569.165 687.828l-47.468-67.894-377.686-540.24h162.604l304.797 435.991 47.468 67.894 396.2 566.721H892.476L569.165 687.854v-.026Z"></path></svg></a><a href="https://github.com/TwistingTwists" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a></div></div></div></div></div></header><div class="markdown"><div class="tableOfContentsInline_prmo"></div>
<!-- -->
<div class="relative"><div class="w-full min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 p-4 sm:p-6 font-sans"><header class="mb-6"><h1 class="text-2xl sm:text-3xl font-bold mb-1">Combined Anomaly: Dirty Read Leads to Lost Update</h1><p class="text-sm text-gray-600 dark:text-gray-400">A more complex scenario with 3 transactions on a non-MVCC system. It shows how T2 performing a &#x27;Dirty Read&#x27; on T1&#x27;s uncommitted data directly enables the &#x27;Lost Update&#x27; anomaly when T1 later aborts.</p></header><div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-4 mb-6"><div class="flex flex-col sm:flex-row items-center justify-between gap-3 mb-3"><div class="flex gap-2 flex-wrap justify-center"><button class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400 text-sm">Auto Run</button><button class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 text-sm">Reset</button><div class="sm:border-l border-gray-300 dark:border-gray-700 sm:pl-2 flex gap-2"><button disabled="" class="px-3 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:bg-gray-400 text-sm">‚Üê Step</button><button class="px-3 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:bg-gray-400 text-sm">Step ‚Üí</button></div></div><div class="text-right text-xs sm:text-sm"><div class="font-mono text-gray-700 dark:text-gray-300">Step: <!-- -->0<!-- -->/<!-- -->10<!-- --> | Time: <!-- -->0</div><div class="text-gray-500 dark:text-gray-400">Next TxID: <!-- -->1</div></div></div></div><div class="grid grid-cols-1 lg:grid-cols-5 gap-4 mb-6 text-xs sm:text-sm"><div class="lg:col-span-3 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-xl"><h3 class="font-semibold mb-3 text-base sm:text-lg border-b border-gray-200 dark:border-gray-700 pb-2">Database State (No Versions)</h3></div><div class="lg:col-span-2 space-y-4"><div class="bg-white dark:bg-gray-800 p-3 rounded-lg shadow-xl"><h3 class="font-semibold mb-2 border-b border-gray-200 dark:border-gray-700 pb-1 text-sm sm:text-base">Current Operation</h3><div class="text-gray-500 italic">None</div></div><div class="bg-white dark:bg-gray-800 p-3 rounded-lg shadow-xl max-h-96 overflow-y-auto"><h3 class="font-semibold mb-2 border-b border-gray-200 dark:border-gray-700 pb-1 text-sm sm:text-base">Transaction States &amp; Undo Logs</h3><div class="text-gray-500 italic text-xs">No active transactions.</div></div></div></div><div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-4 sm:p-6"><h2 class="text-base sm:text-xl font-semibold mb-2 text-gray-800 dark:text-gray-200">Transaction Timelines</h2><div class="relative mb-4 pt-4"><div class="absolute top-4 left-0 right-0 h-px bg-gray-300 dark:bg-gray-600"></div><div class="flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-2 px-[2.5%] w-[95%]"><div class="relative flex flex-col items-center"><div class="absolute w-px h-2 bg-gray-300 dark:bg-gray-600 -top-2"></div><div>0</div></div><div class="relative flex flex-col items-center"><div class="absolute w-px h-2 bg-gray-300 dark:bg-gray-600 -top-2"></div><div>10</div></div><div class="relative flex flex-col items-center"><div class="absolute w-px h-2 bg-gray-300 dark:bg-gray-600 -top-2"></div><div>20</div></div><div class="relative flex flex-col items-center"><div class="absolute w-px h-2 bg-gray-300 dark:bg-gray-600 -top-2"></div><div>30</div></div><div class="relative flex flex-col items-center"><div class="absolute w-px h-2 bg-gray-300 dark:bg-gray-600 -top-2"></div><div>40</div></div><div class="relative flex flex-col items-center"><div class="absolute w-px h-2 bg-gray-300 dark:bg-gray-600 -top-2"></div><div>50</div></div><div class="relative flex flex-col items-center"><div class="absolute w-px h-2 bg-gray-300 dark:bg-gray-600 -top-2"></div><div>60</div></div><div class="relative flex flex-col items-center"><div class="absolute w-px h-2 bg-gray-300 dark:bg-gray-600 -top-2"></div><div>70</div></div><div class="relative flex flex-col items-center"><div class="absolute w-px h-2 bg-gray-300 dark:bg-gray-600 -top-2"></div><div>80</div></div><div class="relative flex flex-col items-center"><div class="absolute w-px h-2 bg-gray-300 dark:bg-gray-600 -top-2"></div><div>90</div></div><div class="relative flex flex-col items-center"><div class="absolute w-px h-2 bg-gray-300 dark:bg-gray-600 -top-2"></div><div>100</div></div></div></div><div class="space-y-3 relative"><div class="relative"><div class="flex items-center mb-0.5"><div class="w-2.5 h-2.5 rounded-full mr-1.5 shrink-0" style="background-color:#3b82f6"></div><h3 class="text-xs sm:text-sm font-semibold text-gray-800 dark:text-gray-200">T1</h3></div><div class="relative h-6 bg-gray-100 dark:bg-gray-700 rounded"><div class="absolute top-0 left-0 h-full rounded opacity-30" style="background-color:#3b82f6;width:86.36363636363636%"></div><div class="absolute top-0.5 w-5 h-5 rounded-full border flex items-center justify-center text-[9px] font-bold transition-all bg-gray-200 dark:bg-gray-600 opacity-70 border-gray-400" style="left:calc(8.636363636363637% - 10px);color:text-gray-500" title="BEGIN">B</div><div class="absolute top-0.5 w-5 h-5 rounded-full border flex items-center justify-center text-[9px] font-bold transition-all bg-gray-200 dark:bg-gray-600 opacity-70 border-gray-400" style="left:calc(25.909090909090907% - 10px);color:text-gray-500" title="WRITE">W</div><div class="absolute top-0.5 w-5 h-5 rounded-full border flex items-center justify-center text-[9px] font-bold transition-all bg-gray-200 dark:bg-gray-600 opacity-70 border-gray-400" style="left:calc(86.36363636363636% - 10px);color:text-gray-500" title="ABORT">A</div></div></div><div class="relative"><div class="flex items-center mb-0.5"><div class="w-2.5 h-2.5 rounded-full mr-1.5 shrink-0" style="background-color:#e11d48"></div><h3 class="text-xs sm:text-sm font-semibold text-gray-800 dark:text-gray-200">T2</h3></div><div class="relative h-6 bg-gray-100 dark:bg-gray-700 rounded"><div class="absolute top-0 left-0 h-full rounded opacity-30" style="background-color:#e11d48;width:69.0909090909091%"></div><div class="absolute top-0.5 w-5 h-5 rounded-full border flex items-center justify-center text-[9px] font-bold transition-all bg-gray-200 dark:bg-gray-600 opacity-70 border-gray-400" style="left:calc(17.272727272727273% - 10px);color:text-gray-500" title="BEGIN">B</div><div class="absolute top-0.5 w-5 h-5 rounded-full border flex items-center justify-center text-[9px] font-bold transition-all bg-gray-200 dark:bg-gray-600 opacity-70 border-gray-400" style="left:calc(43.18181818181818% - 10px);color:text-gray-500" title="READ">R</div><div class="absolute top-0.5 w-5 h-5 rounded-full border flex items-center justify-center text-[9px] font-bold transition-all bg-gray-200 dark:bg-gray-600 opacity-70 border-gray-400" style="left:calc(51.81818181818181% - 10px);color:text-gray-500" title="WRITE">W</div><div class="absolute top-0.5 w-5 h-5 rounded-full border flex items-center justify-center text-[9px] font-bold transition-all bg-gray-200 dark:bg-gray-600 opacity-70 border-gray-400" style="left:calc(69.0909090909091% - 10px);color:text-gray-500" title="COMMIT">C</div></div></div><div class="relative"><div class="flex items-center mb-0.5"><div class="w-2.5 h-2.5 rounded-full mr-1.5 shrink-0" style="background-color:#f59e0b"></div><h3 class="text-xs sm:text-sm font-semibold text-gray-800 dark:text-gray-200">T3</h3></div><div class="relative h-6 bg-gray-100 dark:bg-gray-700 rounded"><div class="absolute top-0 left-0 h-full rounded opacity-30" style="background-color:#f59e0b;width:77.72727272727273%"></div><div class="absolute top-0.5 w-5 h-5 rounded-full border flex items-center justify-center text-[9px] font-bold transition-all bg-gray-200 dark:bg-gray-600 opacity-70 border-gray-400" style="left:calc(34.54545454545455% - 10px);color:text-gray-500" title="BEGIN">B</div><div class="absolute top-0.5 w-5 h-5 rounded-full border flex items-center justify-center text-[9px] font-bold transition-all bg-gray-200 dark:bg-gray-600 opacity-70 border-gray-400" style="left:calc(60.45454545454545% - 10px);color:text-gray-500" title="READ">R</div><div class="absolute top-0.5 w-5 h-5 rounded-full border flex items-center justify-center text-[9px] font-bold transition-all bg-gray-200 dark:bg-gray-600 opacity-70 border-gray-400" style="left:calc(77.72727272727273% - 10px);color:text-gray-500" title="COMMIT">C</div></div></div></div></div></div><button class="absolute right-4 top-4 z-50 flex items-center gap-2 px-3 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white transition-colors duration-200"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 4a1 1 0 011-1h4a1 1 0 010 2H5.414l2.293 2.293a1 1 0 11-1.414 1.414L4 6.414V8a1 1 0 01-2 0V4zm14 0a1 1 0 00-1-1h-4a1 1 0 100 2h2.586l-2.293 2.293a1 1 0 001.414 1.414L16 6.414V8a1 1 0 102 0V4zM3 16a1 1 0 001 1h4a1 1 0 100-2H5.414l2.293-2.293a1 1 0 00-1.414-1.414L4 13.586V12a1 1 0 10-2 0v4zm14 0a1 1 0 01-1 1h-4a1 1 0 110-2h2.586l-2.293-2.293a1 1 0 011.414-1.414L16 13.586V12a1 1 0 112 0v4z" clip-rule="evenodd"></path></svg>Full Screen</button></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" title="Database systems" class="tag_zVej tagRegular_sFm0" href="/byte_vault/tags/databases">Databases</a></li><li class="tag_QGVx"><a rel="tag" title="Transactions" class="tag_zVej tagRegular_sFm0" href="/byte_vault/tags/transactions">Transactions</a></li><li class="tag_QGVx"><a rel="tag" title="Multi-Version Concurrency Control" class="tag_zVej tagRegular_sFm0" href="/byte_vault/tags/mvcc">MVCC</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/byte_vault/database-isolation-phantom-read">DB-008: Phantom Read</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-06-07T00:01:00.000Z">June 7, 2025</time> ¬∑ <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/byte_vault/authors/abeeshake"><img class="avatar__photo authorImage_XqGP" src="https://github.com/TwistingTwists.png" alt="Abhishek Tripathi"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/byte_vault/authors/abeeshake"><span class="authorName_yefp">Abhishek Tripathi</span></a></div><small class="authorTitle_nd0D" title="Curiosity brings awareness.">Curiosity brings awareness.</small><div class="authorSocials_rSDt"><a href="https://x.com/twistin456" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="X"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="none" viewBox="0 0 1200 1227" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf xSvg_y3PF"><path d="M714.163 519.284 1160.89 0h-105.86L667.137 450.887 357.328 0H0l468.492 681.821L0 1226.37h105.866l409.625-476.152 327.181 476.152H1200L714.137 519.284h.026ZM569.165 687.828l-47.468-67.894-377.686-540.24h162.604l304.797 435.991 47.468 67.894 396.2 566.721H892.476L569.165 687.854v-.026Z"></path></svg></a><a href="https://github.com/TwistingTwists" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a></div></div></div></div></div></header><div class="markdown"><div class="tableOfContentsInline_prmo"></div>
<!-- -->
<div class="relative"><div class="w-full min-h-screen bg-gray-50 dark:bg-gray-900 p-6 font-sans"><div class="mb-6"><h1 class="text-3xl font-bold text-gray-800 dark:text-gray-100 mb-2">Transaction Timeline: Phantom Read Anomaly</h1><p class="text-gray-600 dark:text-gray-400">T1 scans for &#x27;Engineering&#x27; employees. T2 inserts and commits a new &#x27;Engineering&#x27; employee. T1&#x27;s subsequent identical scan finds this new &#x27;phantom&#x27; row.</p></div><div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-6"><div class="flex items-center justify-between mb-4"><div class="flex gap-3"><button class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400">Auto Run</button><button class="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700">Reset</button><div class="border-l border-gray-300 dark:border-gray-600 pl-3 flex gap-2"><button disabled="" class="px-3 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:bg-gray-400">‚Üê Step</button><button class="px-3 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:bg-gray-400">Step ‚Üí</button></div></div><div class="text-right"><div class="text-lg font-mono dark:text-gray-100">Step: <!-- -->0<!-- --> / <!-- -->7</div><div class="text-xs text-gray-500 dark:text-gray-400">Time: <!-- -->0</div></div></div><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm"><div class="p-3 rounded bg-gray-100 dark:bg-gray-700"><h3 class="font-semibold mb-2 dark:text-gray-200">Committed Database State</h3><div class="mb-2"><h4 class="font-medium text-sm dark:text-gray-300 capitalize">employees</h4><table class="w-full text-xs table-auto"><thead class="text-left dark:text-gray-300"><tr><th class="p-1 border-b dark:border-gray-600 font-normal">id</th><th class="p-1 border-b dark:border-gray-600 font-normal">name</th><th class="p-1 border-b dark:border-gray-600 font-normal">department</th><th class="p-1 border-b dark:border-gray-600 font-normal">salary</th></tr></thead><tbody class="dark:text-gray-100"><tr class=""><td class="p-1 border-b dark:border-gray-700">1</td><td class="p-1 border-b dark:border-gray-700">Alice</td><td class="p-1 border-b dark:border-gray-700">Engineering</td><td class="p-1 border-b dark:border-gray-700">90000</td></tr><tr class=""><td class="p-1 border-b dark:border-gray-700">2</td><td class="p-1 border-b dark:border-gray-700">Bob</td><td class="p-1 border-b dark:border-gray-700">Sales</td><td class="p-1 border-b dark:border-gray-700">75000</td></tr><tr class=""><td class="p-1 border-b dark:border-gray-700">4</td><td class="p-1 border-b dark:border-gray-700">David</td><td class="p-1 border-b dark:border-gray-700">Engineering</td><td class="p-1 border-b dark:border-gray-700">85000</td></tr></tbody></table></div></div><div class="p-3 rounded bg-yellow-100 dark:bg-yellow-900/50"><h3 class="font-semibold mb-2 dark:text-gray-200">Uncommitted Inserts</h3><div class="text-gray-500 dark:text-gray-400 italic">None</div></div><div class="p-3 rounded bg-green-100 dark:bg-green-900/50"><h3 class="font-semibold mb-2 dark:text-gray-200">Scan Log</h3><div class="text-gray-500 dark:text-gray-400 italic">No scans yet</div></div><div class="p-3 rounded bg-blue-100 dark:bg-gray-700"><h3 class="font-semibold mb-2 dark:text-gray-200">Current Operation</h3><div class="text-gray-500 dark:text-gray-400 italic">None</div></div></div></div><div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6"><h2 class="text-xl font-semibold mb-4 dark:text-gray-100">Transaction Timelines</h2><div class="relative mb-6 pt-3"><div class="absolute top-4 left-0 right-0 h-px bg-gray-300 dark:bg-gray-600"></div><div class="flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-2 px-[2.5%] w-[95%]"><div class="relative flex flex-col items-center"><div class="absolute w-px h-2 bg-gray-300 dark:bg-gray-600 -top-2"></div><div>0</div></div><div class="relative flex flex-col items-center"><div class="absolute w-px h-2 bg-gray-300 dark:bg-gray-600 -top-2"></div><div>10</div></div><div class="relative flex flex-col items-center"><div class="absolute w-px h-2 bg-gray-300 dark:bg-gray-600 -top-2"></div><div>20</div></div><div class="relative flex flex-col items-center"><div class="absolute w-px h-2 bg-gray-300 dark:bg-gray-600 -top-2"></div><div>30</div></div><div class="relative flex flex-col items-center"><div class="absolute w-px h-2 bg-gray-300 dark:bg-gray-600 -top-2"></div><div>40</div></div><div class="relative flex flex-col items-center"><div class="absolute w-px h-2 bg-gray-300 dark:bg-gray-600 -top-2"></div><div>50</div></div><div class="relative flex flex-col items-center"><div class="absolute w-px h-2 bg-gray-300 dark:bg-gray-600 -top-2"></div><div>60</div></div></div></div><div class="space-y-6"><div class="relative"><div class="flex items-center mb-2"><div class="w-3 h-3 rounded-full mr-3 flex-shrink-0" style="background-color:#22c55e"></div><h3 class="text-lg font-semibold dark:text-gray-100">T1</h3></div><div class="relative h-8 bg-gray-100 dark:bg-gray-700 rounded"><div class="absolute top-0 left-0 h-full rounded opacity-30" style="background-color:#22c55e;width:81.42857142857143%"></div><div class="absolute top-0.5 w-7 h-7 rounded-full border-2 flex items-center justify-center text-xs font-bold transition-all duration-300 group bg-gray-200 dark:bg-gray-600 opacity-70" style="left:calc(0% - 18px);border-color:#22c55e;color:#6b7280" title="BEGIN">B</div><div class="absolute top-0.5 w-7 h-7 rounded-full border-2 flex items-center justify-center text-xs font-bold transition-all duration-300 group bg-gray-200 dark:bg-gray-600 opacity-70" style="left:calc(13.571428571428571% - 18px);border-color:#22c55e;color:#6b7280" title="SCAN employees (ID:s1)">S</div><div class="absolute top-0.5 w-7 h-7 rounded-full border-2 flex items-center justify-center text-xs font-bold transition-all duration-300 group bg-gray-200 dark:bg-gray-600 opacity-70" style="left:calc(67.85714285714286% - 18px);border-color:#22c55e;color:#6b7280" title="SCAN employees (ID:s2)">S</div><div class="absolute top-0.5 w-7 h-7 rounded-full border-2 flex items-center justify-center text-xs font-bold transition-all duration-300 group bg-gray-200 dark:bg-gray-600 opacity-70" style="left:calc(81.42857142857143% - 18px);border-color:#22c55e;color:#6b7280" title="COMMIT">C</div></div></div><div class="relative"><div class="flex items-center mb-2"><div class="w-3 h-3 rounded-full mr-3 flex-shrink-0" style="background-color:#f59e0b"></div><h3 class="text-lg font-semibold dark:text-gray-100">T2</h3></div><div class="relative h-8 bg-gray-100 dark:bg-gray-700 rounded"><div class="absolute top-0 left-0 h-full rounded opacity-30" style="background-color:#f59e0b;width:47.5%"></div><div class="absolute top-0.5 w-7 h-7 rounded-full border-2 flex items-center justify-center text-xs font-bold transition-all duration-300 group bg-gray-200 dark:bg-gray-600 opacity-70" style="left:calc(6.785714285714286% - 18px);border-color:#f59e0b;color:#6b7280" title="BEGIN">B</div><div class="absolute top-0.5 w-7 h-7 rounded-full border-2 flex items-center justify-center text-xs font-bold transition-all duration-300 group bg-gray-200 dark:bg-gray-600 opacity-70" style="left:calc(33.92857142857143% - 18px);border-color:#f59e0b;color:#6b7280" title="INSERT employees (ID:i1) - Data: Charlie">I</div><div class="absolute top-0.5 w-7 h-7 rounded-full border-2 flex items-center justify-center text-xs font-bold transition-all duration-300 group bg-gray-200 dark:bg-gray-600 opacity-70" style="left:calc(47.5% - 18px);border-color:#f59e0b;color:#6b7280" title="COMMIT">C</div></div></div></div><div class="mt-8 pt-4 border-t border-gray-200 dark:border-gray-700"><h4 class="font-semibold mb-2 dark:text-gray-100">Legend</h4><div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-x-4 gap-y-2 text-sm dark:text-gray-300"><div class="flex items-center gap-2"><div class="w-6 h-6 rounded-full border-2 border-gray-500 dark:border-gray-400 bg-white dark:bg-gray-700 flex items-center justify-center text-xs font-bold text-gray-700 dark:text-gray-200">B</div><span>Begin</span></div><div class="flex items-center gap-2"><div class="w-6 h-6 rounded-full border-2 border-gray-500 dark:border-gray-400 bg-white dark:bg-gray-700 flex items-center justify-center text-xs font-bold text-gray-700 dark:text-gray-200">S</div><span>Scan (Range Query)</span></div><div class="flex items-center gap-2"><div class="w-6 h-6 rounded-full border-2 border-gray-500 dark:border-gray-400 bg-white dark:bg-gray-700 flex items-center justify-center text-xs font-bold text-gray-700 dark:text-gray-200">I</div><span>Insert</span></div><div class="flex items-center gap-2"><div class="w-6 h-6 rounded-full border-2 border-gray-500 dark:border-gray-400 bg-white dark:bg-gray-700 flex items-center justify-center text-xs font-bold text-gray-700 dark:text-gray-200">C</div><span>Commit</span></div><div class="flex items-center gap-2"><div class="w-6 h-6 rounded-full border-2 border-gray-500 dark:border-gray-400 bg-white dark:bg-gray-700 flex items-center justify-center text-xs font-bold text-gray-700 dark:text-gray-200">A</div><span>Abort</span></div></div></div></div><div class="mt-6 bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4"><h3 class="font-semibold text-yellow-800 dark:text-yellow-200 mb-2">Understanding Phantom Reads</h3><p class="text-yellow-700 dark:text-yellow-300 text-sm mb-3">A <strong>Phantom Read</strong> occurs when a transaction executes a range query (e.g., &quot;find all employees in Engineering&quot;) twice, and the set of rows returned by the second query is different from the first. This happens because another transaction has inserted or deleted rows that match the query&#x27;s criteria and committed those changes in between the two queries of the first transaction. The newly appeared (or disappeared) rows are called &quot;phantoms.&quot;</p><div class="bg-yellow-100 dark:bg-yellow-900/50 p-3 rounded text-sm mt-2"><h4 class="font-semibold mb-1 dark:text-yellow-100">Key Observation Points:</h4><ul class="text-xs space-y-1 list-disc list-inside text-yellow-700 dark:text-yellow-300"><li><strong>Step 2:</strong> T1&#x27;s first scan of &#x27;Engineering&#x27; employees finds Alice and David.</li><li><strong>Step 4 &amp; 5:</strong> T2 inserts &#x27;Charlie&#x27; into &#x27;Engineering&#x27; and commits this change.</li><li><strong>Step 6:</strong> T1&#x27;s second scan of &#x27;Engineering&#x27; employees now finds Alice, David, AND &#x27;Charlie&#x27;. &#x27;Charlie&#x27; is the phantom row.</li><li>This anomaly can lead to inconsistencies if T1 was performing calculations or making decisions based on the assumption that the set of rows matching its criteria would not change during its execution.</li><li>Phantom reads are typically prevented by higher isolation levels like Serializable, or by specific locking strategies (e.g., predicate locks, though not widely implemented, or careful range locking).</li></ul></div></div></div><button class="absolute right-4 top-4 z-50 flex items-center gap-2 px-3 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white transition-colors duration-200"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 4a1 1 0 011-1h4a1 1 0 010 2H5.414l2.293 2.293a1 1 0 11-1.414 1.414L4 6.414V8a1 1 0 01-2 0V4zm14 0a1 1 0 00-1-1h-4a1 1 0 100 2h2.586l-2.293 2.293a1 1 0 001.414 1.414L16 6.414V8a1 1 0 102 0V4zM3 16a1 1 0 001 1h4a1 1 0 100-2H5.414l2.293-2.293a1 1 0 00-1.414-1.414L4 13.586V12a1 1 0 10-2 0v4zm14 0a1 1 0 01-1 1h-4a1 1 0 110-2h2.586l-2.293-2.293a1 1 0 011.414-1.414L16 13.586V12a1 1 0 112 0v4z" clip-rule="evenodd"></path></svg>Full Screen</button></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" title="Database systems" class="tag_zVej tagRegular_sFm0" href="/byte_vault/tags/databases">Databases</a></li><li class="tag_QGVx"><a rel="tag" title="Transactions" class="tag_zVej tagRegular_sFm0" href="/byte_vault/tags/transactions">Transactions</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/byte_vault/database-isolation-visualised-mvcc-visibility-rules">DB-007: MVCC Visibility Rules</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-05-23T00:01:00.000Z">May 23, 2025</time> ¬∑ <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/byte_vault/authors/abeeshake"><img class="avatar__photo authorImage_XqGP" src="https://github.com/TwistingTwists.png" alt="Abhishek Tripathi"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/byte_vault/authors/abeeshake"><span class="authorName_yefp">Abhishek Tripathi</span></a></div><small class="authorTitle_nd0D" title="Curiosity brings awareness.">Curiosity brings awareness.</small><div class="authorSocials_rSDt"><a href="https://x.com/twistin456" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="X"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="none" viewBox="0 0 1200 1227" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf xSvg_y3PF"><path d="M714.163 519.284 1160.89 0h-105.86L667.137 450.887 357.328 0H0l468.492 681.821L0 1226.37h105.866l409.625-476.152 327.181 476.152H1200L714.137 519.284h.026ZM569.165 687.828l-47.468-67.894-377.686-540.24h162.604l304.797 435.991 47.468 67.894 396.2 566.721H892.476L569.165 687.854v-.026Z"></path></svg></a><a href="https://github.com/TwistingTwists" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a></div></div></div></div></div></header><div class="markdown"><div class="tableOfContentsInline_prmo"></div>
<!-- -->
<div class="relative"><div class="w-full min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 p-4 sm:p-6 font-sans"><header class="mb-6"><h1 class="text-2xl sm:text-3xl font-bold mb-1">MVCC Visibility Rules Demonstration</h1><p class="text-sm text-gray-600 dark:text-gray-400">Illustrates how transactions see data based on snapshot isolation. Focus on T3&#x27;s reads and how its snapshot (taken at t=40) affects what it sees from T1 and T2, even after they commit.</p></header><div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-4 mb-6"><div class="flex flex-col sm:flex-row items-center justify-between gap-3 mb-3"><div class="flex gap-2 flex-wrap justify-center"><button class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400 dark:disabled:bg-gray-600 text-sm">Auto Run</button><button class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 dark:bg-gray-600 dark:hover:bg-gray-700 text-sm">Reset</button><div class="sm:border-l border-gray-300 dark:border-gray-700 sm:pl-2 flex gap-2"><button disabled="" class="px-3 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:bg-gray-400 dark:disabled:bg-gray-600 text-sm">‚Üê Step</button><button class="px-3 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:bg-gray-400 dark:disabled:bg-gray-600 text-sm">Step ‚Üí</button></div></div><div class="text-right text-xs sm:text-sm"><div class="font-mono text-gray-700 dark:text-gray-300">Step: <!-- -->0<!-- -->/<!-- -->14<!-- --> | Time: <!-- -->0</div><div class="text-gray-500 dark:text-gray-400">Next TxID: <!-- -->1<!-- --> | Committed: [<!-- -->0<!-- -->]</div></div></div></div><div class="grid grid-cols-1 lg:grid-cols-5 gap-4 mb-6 text-xs sm:text-sm"><div class="lg:col-span-3 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-xl"><h3 class="font-semibold mb-3 text-base sm:text-lg border-b border-gray-200 dark:border-gray-700 pb-2 text-gray-800 dark:text-gray-200">Data Item Versions (Global State)</h3></div><div class="lg:col-span-2 space-y-4"><div class="bg-white dark:bg-gray-800 p-3 rounded-lg shadow-xl"><h3 class="font-semibold mb-2 border-b border-gray-200 dark:border-gray-700 pb-1 text-sm sm:text-base text-gray-800 dark:text-gray-200">Current Operation</h3><div class="text-gray-500 dark:text-gray-400 italic">None</div></div><div class="bg-white dark:bg-gray-800 p-3 rounded-lg shadow-xl max-h-80 overflow-y-auto"><h3 class="font-semibold mb-2 border-b border-gray-200 dark:border-gray-700 pb-1 text-sm sm:text-base text-gray-800 dark:text-gray-200">Transaction States &amp; Snapshots</h3><div class="text-gray-500 dark:text-gray-400 italic text-xs">No active transactions.</div></div></div></div><div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-4 sm:p-6"><h2 class="text-base sm:text-xl font-semibold mb-2 text-gray-800 dark:text-gray-200">Transaction Timelines</h2> <div class="relative mb-4 pt-4"> <div class="absolute top-4 left-0 right-0 h-px bg-gray-300 dark:bg-gray-600 z-0"></div> <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-2 px-[2.5%] w-[95%] relative z-10"> <div class="relative flex flex-col items-center"><div class="absolute w-px h-2 bg-gray-300 dark:bg-gray-600 -top-2"></div><div>0</div></div><div class="relative flex flex-col items-center"><div class="absolute w-px h-2 bg-gray-300 dark:bg-gray-600 -top-2"></div><div>10</div></div><div class="relative flex flex-col items-center"><div class="absolute w-px h-2 bg-gray-300 dark:bg-gray-600 -top-2"></div><div>20</div></div><div class="relative flex flex-col items-center"><div class="absolute w-px h-2 bg-gray-300 dark:bg-gray-600 -top-2"></div><div>30</div></div><div class="relative flex flex-col items-center"><div class="absolute w-px h-2 bg-gray-300 dark:bg-gray-600 -top-2"></div><div>40</div></div><div class="relative flex flex-col items-center"><div class="absolute w-px h-2 bg-gray-300 dark:bg-gray-600 -top-2"></div><div>50</div></div><div class="relative flex flex-col items-center"><div class="absolute w-px h-2 bg-gray-300 dark:bg-gray-600 -top-2"></div><div>60</div></div><div class="relative flex flex-col items-center"><div class="absolute w-px h-2 bg-gray-300 dark:bg-gray-600 -top-2"></div><div>70</div></div></div></div><div class="space-y-3 relative"> <div class="relative"><div class="flex items-center mb-0.5"> <div class="w-2.5 h-2.5 rounded-full mr-1.5 flex-shrink-0" style="background-color:#3b82f6"></div> <h3 class="text-xs sm:text-sm font-semibold text-gray-800 dark:text-gray-200">T1</h3></div><div class="relative h-6 bg-gray-100 dark:bg-gray-700 rounded"> <div class="absolute top-0 left-0 h-full rounded opacity-30" style="background-color:#3b82f6;width:53.4375%"></div><div class="absolute top-0.5 w-5 h-5 rounded-full border flex items-center justify-center text-[9px] font-bold transition-all duration-300 group bg-gray-200 dark:bg-gray-600 opacity-70 border-gray-400 dark:border-gray-500 border" style="left:calc(0% - 10px);color:text-gray-500 dark:text-gray-400" title="BEGIN">B</div><div class="absolute top-0.5 w-5 h-5 rounded-full border flex items-center justify-center text-[9px] font-bold transition-all duration-300 group bg-gray-200 dark:bg-gray-600 opacity-70 border-gray-400 dark:border-gray-500 border" style="left:calc(5.9375% - 10px);color:text-gray-500 dark:text-gray-400" title="READ DataA">R</div><div class="absolute top-0.5 w-5 h-5 rounded-full border flex items-center justify-center text-[9px] font-bold transition-all duration-300 group bg-gray-200 dark:bg-gray-600 opacity-70 border-gray-400 dark:border-gray-500 border" style="left:calc(11.875% - 10px);color:text-gray-500 dark:text-gray-400" title="WRITE DataA = 110">W</div><div class="absolute top-0.5 w-5 h-5 rounded-full border flex items-center justify-center text-[9px] font-bold transition-all duration-300 group bg-gray-200 dark:bg-gray-600 opacity-70 border-gray-400 dark:border-gray-500 border" style="left:calc(17.8125% - 10px);color:text-gray-500 dark:text-gray-400" title="READ DataA">R</div><div class="absolute top-0.5 w-5 h-5 rounded-full border flex items-center justify-center text-[9px] font-bold transition-all duration-300 group bg-gray-200 dark:bg-gray-600 opacity-70 border-gray-400 dark:border-gray-500 border" style="left:calc(53.4375% - 10px);color:text-gray-500 dark:text-gray-400" title="COMMIT">C</div></div></div><div class="relative"><div class="flex items-center mb-0.5"> <div class="w-2.5 h-2.5 rounded-full mr-1.5 flex-shrink-0" style="background-color:#10b981"></div> <h3 class="text-xs sm:text-sm font-semibold text-gray-800 dark:text-gray-200">T2</h3></div><div class="relative h-6 bg-gray-100 dark:bg-gray-700 rounded"> <div class="absolute top-0 left-0 h-full rounded opacity-30" style="background-color:#10b981;width:59.375%"></div><div class="absolute top-0.5 w-5 h-5 rounded-full border flex items-center justify-center text-[9px] font-bold transition-all duration-300 group bg-gray-200 dark:bg-gray-600 opacity-70 border-gray-400 dark:border-gray-500 border" style="left:calc(23.75% - 10px);color:text-gray-500 dark:text-gray-400" title="BEGIN">B</div><div class="absolute top-0.5 w-5 h-5 rounded-full border flex items-center justify-center text-[9px] font-bold transition-all duration-300 group bg-gray-200 dark:bg-gray-600 opacity-70 border-gray-400 dark:border-gray-500 border" style="left:calc(29.6875% - 10px);color:text-gray-500 dark:text-gray-400" title="READ DataA">R</div><div class="absolute top-0.5 w-5 h-5 rounded-full border flex items-center justify-center text-[9px] font-bold transition-all duration-300 group bg-gray-200 dark:bg-gray-600 opacity-70 border-gray-400 dark:border-gray-500 border" style="left:calc(35.625% - 10px);color:text-gray-500 dark:text-gray-400" title="WRITE DataB = 520">W</div><div class="absolute top-0.5 w-5 h-5 rounded-full border flex items-center justify-center text-[9px] font-bold transition-all duration-300 group bg-gray-200 dark:bg-gray-600 opacity-70 border-gray-400 dark:border-gray-500 border" style="left:calc(41.5625% - 10px);color:text-gray-500 dark:text-gray-400" title="READ DataB">R</div><div class="absolute top-0.5 w-5 h-5 rounded-full border flex items-center justify-center text-[9px] font-bold transition-all duration-300 group bg-gray-200 dark:bg-gray-600 opacity-70 border-gray-400 dark:border-gray-500 border" style="left:calc(59.375% - 10px);color:text-gray-500 dark:text-gray-400" title="COMMIT">C</div></div></div><div class="relative"><div class="flex items-center mb-0.5"> <div class="w-2.5 h-2.5 rounded-full mr-1.5 flex-shrink-0" style="background-color:#f59e0b"></div> <h3 class="text-xs sm:text-sm font-semibold text-gray-800 dark:text-gray-200">T3</h3></div><div class="relative h-6 bg-gray-100 dark:bg-gray-700 rounded"> <div class="absolute top-0 left-0 h-full rounded opacity-30" style="background-color:#f59e0b;width:83.125%"></div><div class="absolute top-0.5 w-5 h-5 rounded-full border flex items-center justify-center text-[9px] font-bold transition-all duration-300 group bg-gray-200 dark:bg-gray-600 opacity-70 border-gray-400 dark:border-gray-500 border" style="left:calc(47.5% - 10px);color:text-gray-500 dark:text-gray-400" title="BEGIN">B</div><div class="absolute top-0.5 w-5 h-5 rounded-full border flex items-center justify-center text-[9px] font-bold transition-all duration-300 group bg-gray-200 dark:bg-gray-600 opacity-70 border-gray-400 dark:border-gray-500 border" style="left:calc(65.3125% - 10px);color:text-gray-500 dark:text-gray-400" title="READ DataA">R</div><div class="absolute top-0.5 w-5 h-5 rounded-full border flex items-center justify-center text-[9px] font-bold transition-all duration-300 group bg-gray-200 dark:bg-gray-600 opacity-70 border-gray-400 dark:border-gray-500 border" style="left:calc(71.25% - 10px);color:text-gray-500 dark:text-gray-400" title="READ DataB">R</div><div class="absolute top-0.5 w-5 h-5 rounded-full border flex items-center justify-center text-[9px] font-bold transition-all duration-300 group bg-gray-200 dark:bg-gray-600 opacity-70 border-gray-400 dark:border-gray-500 border" style="left:calc(83.125% - 10px);color:text-gray-500 dark:text-gray-400" title="COMMIT">C</div></div></div></div><div class="mt-6 pt-3 border-t border-gray-200 dark:border-gray-700 text-xs"><h4 class="font-semibold mb-1 text-gray-700 dark:text-gray-300">Legend</h4><div class="flex flex-wrap gap-x-3 gap-y-1 text-gray-600 dark:text-gray-400"><div class="flex items-center gap-1.5"><div class="w-5 h-5 rounded-full border-2 border-gray-400 dark:border-gray-500 bg-gray-50 dark:bg-gray-700 flex items-center justify-center font-bold text-gray-700 dark:text-gray-200">B</div><span>Begin</span></div><div class="flex items-center gap-1.5"><div class="w-5 h-5 rounded-full border-2 border-gray-400 dark:border-gray-500 bg-gray-50 dark:bg-gray-700 flex items-center justify-center font-bold text-gray-700 dark:text-gray-200">R</div><span>Read</span></div><div class="flex items-center gap-1.5"><div class="w-5 h-5 rounded-full border-2 border-gray-400 dark:border-gray-500 bg-gray-50 dark:bg-gray-700 flex items-center justify-center font-bold text-gray-700 dark:text-gray-200">W</div><span>Write</span></div><div class="flex items-center gap-1.5"><div class="w-5 h-5 rounded-full border-2 border-gray-400 dark:border-gray-500 bg-gray-50 dark:bg-gray-700 flex items-center justify-center font-bold text-gray-700 dark:text-gray-200">C</div><span>Commit</span></div><div class="flex items-center gap-1.5"><div class="w-5 h-5 rounded-full border-2 border-gray-400 dark:border-gray-500 bg-gray-50 dark:bg-gray-700 flex items-center justify-center font-bold text-gray-700 dark:text-gray-200">A</div><span>Abort</span></div></div></div></div></div><button class="absolute right-4 top-4 z-50 flex items-center gap-2 px-3 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white transition-colors duration-200"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 4a1 1 0 011-1h4a1 1 0 010 2H5.414l2.293 2.293a1 1 0 11-1.414 1.414L4 6.414V8a1 1 0 01-2 0V4zm14 0a1 1 0 00-1-1h-4a1 1 0 100 2h2.586l-2.293 2.293a1 1 0 001.414 1.414L16 6.414V8a1 1 0 102 0V4zM3 16a1 1 0 001 1h4a1 1 0 100-2H5.414l2.293-2.293a1 1 0 00-1.414-1.414L4 13.586V12a1 1 0 10-2 0v4zm14 0a1 1 0 01-1 1h-4a1 1 0 110-2h2.586l-2.293-2.293a1 1 0 011.414-1.414L16 13.586V12a1 1 0 112 0v4z" clip-rule="evenodd"></path></svg>Full Screen</button></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" title="Database systems" class="tag_zVej tagRegular_sFm0" href="/byte_vault/tags/databases">Databases</a></li><li class="tag_QGVx"><a rel="tag" title="Transactions" class="tag_zVej tagRegular_sFm0" href="/byte_vault/tags/transactions">Transactions</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/byte_vault/database-isolation-visualised-dirty-reads">DB-001: Database Isolation (dirty reads)</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-04-21T00:00:00.000Z">April 21, 2025</time> ¬∑ <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/byte_vault/authors/abeeshake"><img class="avatar__photo authorImage_XqGP" src="https://github.com/TwistingTwists.png" alt="Abhishek Tripathi"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/byte_vault/authors/abeeshake"><span class="authorName_yefp">Abhishek Tripathi</span></a></div><small class="authorTitle_nd0D" title="Curiosity brings awareness.">Curiosity brings awareness.</small><div class="authorSocials_rSDt"><a href="https://x.com/twistin456" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="X"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="none" viewBox="0 0 1200 1227" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf xSvg_y3PF"><path d="M714.163 519.284 1160.89 0h-105.86L667.137 450.887 357.328 0H0l468.492 681.821L0 1226.37h105.866l409.625-476.152 327.181 476.152H1200L714.137 519.284h.026ZM569.165 687.828l-47.468-67.894-377.686-540.24h162.604l304.797 435.991 47.468 67.894 396.2 566.721H892.476L569.165 687.854v-.026Z"></path></svg></a><a href="https://github.com/TwistingTwists" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a></div></div></div></div></div></header><div class="markdown"><div class="tableOfContentsInline_prmo"><ul class="table-of-contents"><li><a href="#understanding-dirty-reads-a-database-isolation-problem">Understanding Dirty Reads: A Database Isolation Problem</a><ul><li><a href="#what-is-a-dirty-read">What is a Dirty Read?</a></li></ul></li></ul></div>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="understanding-dirty-reads-a-database-isolation-problem">Understanding Dirty Reads: A Database Isolation Problem<a href="#understanding-dirty-reads-a-database-isolation-problem" class="hash-link" aria-label="Direct link to Understanding Dirty Reads: A Database Isolation Problem" title="Direct link to Understanding Dirty Reads: A Database Isolation Problem">‚Äã</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-a-dirty-read">What is a Dirty Read?<a href="#what-is-a-dirty-read" class="hash-link" aria-label="Direct link to What is a Dirty Read?" title="Direct link to What is a Dirty Read?">‚Äã</a></h3>
<p>A <strong>dirty read</strong> occurs when a transaction reads data that has been written by another transaction but not yet committed. If the writing transaction rolls back, the data read by the first transaction becomes invalid‚Äîhence, &quot;dirty.&quot;</p>
<p>This can lead to inconsistent or incorrect results in applications, especially in systems where multiple users or processes are accessing and modifying the data concurrently.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" title="Database systems" class="tag_zVej tagRegular_sFm0" href="/byte_vault/tags/databases">Databases</a></li><li class="tag_QGVx"><a rel="tag" title="Transactions" class="tag_zVej tagRegular_sFm0" href="/byte_vault/tags/transactions">Transactions</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about DB-001: Database Isolation (dirty reads)" href="/byte_vault/database-isolation-visualised-dirty-reads"><b>Read more</b></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/byte_vault/tokio-internals-visualised">Understanding Eventloops (Tokio Internals)</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-04-19T00:00:00.000Z">April 19, 2025</time> ¬∑ <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/byte_vault/authors/abeeshake"><img class="avatar__photo authorImage_XqGP" src="https://github.com/TwistingTwists.png" alt="Abhishek Tripathi"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/byte_vault/authors/abeeshake"><span class="authorName_yefp">Abhishek Tripathi</span></a></div><small class="authorTitle_nd0D" title="Curiosity brings awareness.">Curiosity brings awareness.</small><div class="authorSocials_rSDt"><a href="https://x.com/twistin456" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="X"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="none" viewBox="0 0 1200 1227" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf xSvg_y3PF"><path d="M714.163 519.284 1160.89 0h-105.86L667.137 450.887 357.328 0H0l468.492 681.821L0 1226.37h105.866l409.625-476.152 327.181 476.152H1200L714.137 519.284h.026ZM569.165 687.828l-47.468-67.894-377.686-540.24h162.604l304.797 435.991 47.468 67.894 396.2 566.721H892.476L569.165 687.854v-.026Z"></path></svg></a><a href="https://github.com/TwistingTwists" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a></div></div></div></div></div></header><div class="markdown"><div class="tableOfContentsInline_prmo"><ul class="table-of-contents"><li><a href="#prelude">Prelude</a></li><li><a href="#multi-threaded-event-loop--server">Multi-Threaded Event Loop / Server</a></li><li><a href="#phase-0-the-problem">Phase 0: The Problem</a></li></ul></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prelude">Prelude<a href="#prelude" class="hash-link" aria-label="Direct link to Prelude" title="Direct link to Prelude">‚Äã</a></h2>
<p>This is the first post in a four part series that will provide an understanding of the mechanics behind the Tokio runtime in Rust. This post focuses on the challenges in a multi-threaded event loop that force us to think of async runtimes like Tokio.</p>
<p>Index of the four part series:</p>
<ol>
<li>Visualizing Tokio Internals: Part I - Multi-Threaded Event Loop / Server</li>
<li>Visualizing Tokio Internals: Part II - Reactor</li>
<li>Visualizing Tokio Internals: Part III - Wakers</li>
<li>Visualizing Tokio Internals: Part IV - Executors</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="multi-threaded-event-loop--server">Multi-Threaded Event Loop / Server<a href="#multi-threaded-event-loop--server" class="hash-link" aria-label="Direct link to Multi-Threaded Event Loop / Server" title="Direct link to Multi-Threaded Event Loop / Server">‚Äã</a></h2>
<p>What challenges in a multi-threaded event loop force us to think of async runtimes like Tokio?</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="phase-0-the-problem">Phase 0: The Problem<a href="#phase-0-the-problem" class="hash-link" aria-label="Direct link to Phase 0: The Problem" title="Direct link to Phase 0: The Problem">‚Äã</a></h2>
<div class="my-3 sm:my-4 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-950/30 dark:to-indigo-950/30 rounded-lg overflow-hidden shadow-sm dark:shadow-blue-900/5 border-l-4 border-blue-400 dark:border-blue-600"><div class="p-3 sm:p-4 space-y-2 sm:space-y-3"><div class="flex items-center gap-3"><div class="flex-shrink-0 p-2 bg-blue-100 dark:bg-blue-900/30 rounded-md group relative"><svg class="w-4 h-4 text-blue-600 dark:text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-label="Learning Objective"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg><div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-1 px-1.5 py-0.5 text-xs text-white bg-gray-800 dark:bg-gray-700 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none">Learning Objective</div></div><div class="flex-grow min-w-0"><p class="text-base font-medium text-blue-900 dark:text-blue-100 break-words">Why do we need async runtimes like Tokio?</p></div><button id="why-tokio-button" class="flex items-center gap-1 px-2 py-1 ml-auto text-2xs sm:text-xs font-medium text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors duration-200 focus:outline-none" aria-expanded="true" aria-controls="why-tokio">Hide<svg class="w-2.5 h-2.5 sm:w-3 sm:h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg></button></div><div id="why-tokio" role="region" aria-labelledby="why-tokio-button" class="overflow-hidden transition-all duration-300 ease-in-out max-h-[500px] opacity-100"><div class="pt-2 border-t border-blue-100 dark:border-blue-800 text-xs sm:text-sm text-gray-700 dark:text-gray-300"><ul>
<li><strong>Resource Efficiency:</strong> Traditional thread-per-connection models waste system resources</li>
<li><strong>Scalability:</strong> Async enables handling thousands of connections with minimal overhead</li>
<li><strong>Performance:</strong> Event-driven architecture reduces context switching and memory usage</li>
<li><strong>Cost-Effective:</strong> Better resource utilization means lower infrastructure costs</li>
</ul></div></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" title="Rust lang" class="tag_zVej tagRegular_sFm0" href="/byte_vault/tags/rust">Rust</a></li><li class="tag_QGVx"><a rel="tag" title="Tokio async runtime" class="tag_zVej tagRegular_sFm0" href="/byte_vault/tags/tokio">Tokio</a></li><li class="tag_QGVx"><a rel="tag" title="Asynchronous programming" class="tag_zVej tagRegular_sFm0" href="/byte_vault/tags/async">Async</a></li><li class="tag_QGVx"><a rel="tag" title="Event loop" class="tag_zVej tagRegular_sFm0" href="/byte_vault/tags/eventloop">Event Loop</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Understanding Eventloops (Tokio Internals)" href="/byte_vault/tokio-internals-visualised"><b>Read more</b></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/byte_vault/connection-pooling-in-depth">Connection Pooling - in Depth</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-03-13T00:00:00.000Z">March 13, 2025</time> ¬∑ <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/byte_vault/authors/abeeshake"><img class="avatar__photo authorImage_XqGP" src="https://github.com/TwistingTwists.png" alt="Abhishek Tripathi"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/byte_vault/authors/abeeshake"><span class="authorName_yefp">Abhishek Tripathi</span></a></div><small class="authorTitle_nd0D" title="Curiosity brings awareness.">Curiosity brings awareness.</small><div class="authorSocials_rSDt"><a href="https://x.com/twistin456" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="X"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="none" viewBox="0 0 1200 1227" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf xSvg_y3PF"><path d="M714.163 519.284 1160.89 0h-105.86L667.137 450.887 357.328 0H0l468.492 681.821L0 1226.37h105.866l409.625-476.152 327.181 476.152H1200L714.137 519.284h.026ZM569.165 687.828l-47.468-67.894-377.686-540.24h162.604l304.797 435.991 47.468 67.894 396.2 566.721H892.476L569.165 687.854v-.026Z"></path></svg></a><a href="https://github.com/TwistingTwists" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a></div></div></div></div></div></header><div class="markdown"><p>Here‚Äôs a <strong>Markdown table</strong> that maps <strong>real-life reverse proxy scenarios</strong> to recommended <strong>TCP tuning parameters</strong> for optimal performance and security:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-legend-quick-reference">‚úÖ <strong>Legend (Quick Reference)</strong><a href="#-legend-quick-reference" class="hash-link" aria-label="Direct link to -legend-quick-reference" title="Direct link to -legend-quick-reference">‚Äã</a></h3>
<table><thead><tr><th><strong>Parameter</strong></th><th><strong>Purpose</strong></th></tr></thead><tbody><tr><td><code>tcp_fin_timeout</code></td><td>How long to keep closing connection in FIN state.</td></tr><tr><td><code>tcp_keepalive_time</code></td><td>Idle time before sending first keep-alive probe.</td></tr><tr><td><code>tcp_keepalive_intvl</code></td><td>Interval between successive keep-alive probes.</td></tr><tr><td><code>tcp_keepalive_probes</code></td><td>Number of probes before dropping connection.</td></tr><tr><td><code>tcp_retries2</code></td><td>Max TCP retransmissions before giving up.</td></tr></tbody></table></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" title="Network connections" class="tag_zVej tagRegular_sFm0" href="/byte_vault/tags/connection">Connection</a></li><li class="tag_QGVx"><a rel="tag" title="Database systems" class="tag_zVej tagRegular_sFm0" href="/byte_vault/tags/database">Database</a></li><li class="tag_QGVx"><a rel="tag" title="Networking concepts" class="tag_zVej tagRegular_sFm0" href="/byte_vault/tags/network">Network</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Connection Pooling - in Depth" href="/byte_vault/connection-pooling-in-depth"><b>Read more</b></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/byte_vault/reliable-structured-outputs-with-llms">Reliable Structured Outputs with LLMs</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-03-01T00:00:00.000Z">March 1, 2025</time> ¬∑ <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/byte_vault/authors/abeeshake"><img class="avatar__photo authorImage_XqGP" src="https://github.com/TwistingTwists.png" alt="Abhishek Tripathi"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/byte_vault/authors/abeeshake"><span class="authorName_yefp">Abhishek Tripathi</span></a></div><small class="authorTitle_nd0D" title="Curiosity brings awareness.">Curiosity brings awareness.</small><div class="authorSocials_rSDt"><a href="https://x.com/twistin456" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="X"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="none" viewBox="0 0 1200 1227" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf xSvg_y3PF"><path d="M714.163 519.284 1160.89 0h-105.86L667.137 450.887 357.328 0H0l468.492 681.821L0 1226.37h105.866l409.625-476.152 327.181 476.152H1200L714.137 519.284h.026ZM569.165 687.828l-47.468-67.894-377.686-540.24h162.604l304.797 435.991 47.468 67.894 396.2 566.721H892.476L569.165 687.854v-.026Z"></path></svg></a><a href="https://github.com/TwistingTwists" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a></div></div></div></div></div></header><div class="markdown"><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ensuring-deterministic-outputs-from-llms">Ensuring Deterministic Outputs from LLMs<a href="#ensuring-deterministic-outputs-from-llms" class="hash-link" aria-label="Direct link to Ensuring Deterministic Outputs from LLMs" title="Direct link to Ensuring Deterministic Outputs from LLMs">‚Äã</a></h3>
<p>There are several strategies to obtain structured outputs from LLMs.</p>
<p>In Python, libraries such as Pydantic and Instructor facilitate structured output via JSON schema-based tool invocation. If you have the capability to host your own model, sglang is a viable option.</p>
<p>Pydantic validators are highly effective, provided that the input is in the form of a valid JSON string.</p>
<p>Let&#x27;s see by example. For starters, here is the schema we want to parse.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> pydantic </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> BaseModel</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ValidationError</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">User</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BaseModel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    email</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    active</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">bool</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># default value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># JSON representation of the data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">json_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token triple-quoted-string string" style="color:#e3116c">&#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;id&quot;: 123,</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;name&quot;: &quot;Alice&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;email&quot;: &quot;alice@example.com&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&#x27;&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Directly validate and parse the JSON string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> User</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model_validate_json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">json_data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Validated Data:&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">except</span><span class="token plain"> ValidationError </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Validation Error:&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>This works. Pydantic has a pretty solid <em>json</em> to data model convertor. But it has to be a valid json string. Let&#x27;s explore further.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># JSON representation of the data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># typical replies of a small LLM which does not adhere well to &#x27;output_json&#x27; command</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">json_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token triple-quoted-string string" style="color:#e3116c">&#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">Here is your json</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;id&quot;: 123,</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;name&quot;: &quot;Alice&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;email&quot;: &quot;alice@example.com&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&#x27;&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Directly validate and parse the JSON string using the new method</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> User</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model_validate_json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">json_data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Validated Data:&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">except</span><span class="token plain"> ValidationError </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Validation Error:&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>Error is:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Validation Error</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;json_invalid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;loc&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;msg&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;Invalid JSON: expected value at line 2 column 1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;input&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;\nHere is your json\n{\n    \&quot;id\&quot;: 123,\n    \&quot;name\&quot;: \&quot;Alice\&quot;,\n    \&quot;email\&quot;: \&quot;alice@example.com\&quot;\n}\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;ctx&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;error&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;expected value at line 2 column 1&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;url&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;https://errors.pydantic.dev/2.10/v/json_invalid&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre></div></div>
<p>Now, let&#x27;s add one more step in the mix. Let&#x27;s use the json_partial_py library to parse the JSON string. and then pass it to pydantic.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> json_partial_py </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> to_json_string </span><span class="token comment" style="color:#999988;font-style:italic"># &lt;---- this is a new import</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># typical replies of a small LLM which does not adhere well to &#x27;output_json&#x27; command</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">json_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token triple-quoted-string string" style="color:#e3116c">&#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">Here is your json</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;id&quot;: 123,</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;name&quot;: &quot;Alice&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;email&quot;: &quot;alice@example.com&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&#x27;&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stringified_json </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> to_json_string</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">json_data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Directly validate and parse the JSON string using the new method</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> User</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model_validate_json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">stringified_json</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Validated Data:&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">except</span><span class="token plain"> ValidationError </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Validation Error:&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>and voila!! Now you can rest assured that you will get clean json parsed from the LLM output.</p>
<p>P.S. I am author of the <a href="https://pypi.org/project/json_partial_python/" target="_blank" rel="noopener noreferrer"><code>json_partial_py</code> library</a>. It was extracted from <a href="https://github.com/BoundaryML/baml?tab=readme-ov-file" target="_blank" rel="noopener noreferrer">baml project</a>.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" title="Parsing JSON" class="tag_zVej tagRegular_sFm0" href="/byte_vault/tags/json-parser">JSON Parser</a></li><li class="tag_QGVx"><a rel="tag" title="Large Language Models" class="tag_zVej tagRegular_sFm0" href="/byte_vault/tags/llm">LLM</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/byte_vault/string-interning-rust">String interning in Rust</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-03-01T00:00:00.000Z">March 1, 2025</time> ¬∑ <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/byte_vault/authors/abeeshake"><img class="avatar__photo authorImage_XqGP" src="https://github.com/TwistingTwists.png" alt="Abhishek Tripathi"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/byte_vault/authors/abeeshake"><span class="authorName_yefp">Abhishek Tripathi</span></a></div><small class="authorTitle_nd0D" title="Curiosity brings awareness.">Curiosity brings awareness.</small><div class="authorSocials_rSDt"><a href="https://x.com/twistin456" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="X"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="none" viewBox="0 0 1200 1227" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf xSvg_y3PF"><path d="M714.163 519.284 1160.89 0h-105.86L667.137 450.887 357.328 0H0l468.492 681.821L0 1226.37h105.866l409.625-476.152 327.181 476.152H1200L714.137 519.284h.026ZM569.165 687.828l-47.468-67.894-377.686-540.24h162.604l304.797 435.991 47.468 67.894 396.2 566.721H892.476L569.165 687.854v-.026Z"></path></svg></a><a href="https://github.com/TwistingTwists" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a></div></div></div></div></div></header><div class="markdown"><h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-string-interning">What is String Interning?<a href="#what-is-string-interning" class="hash-link" aria-label="Direct link to What is String Interning?" title="Direct link to What is String Interning?">‚Äã</a></h3>
<p>String interning is a technique that ensures each unique string is stored only once in memory, reducing redundancy and improving performance.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-string-interning-matters-in-real-world-scenarios"><strong>Why String Interning Matters in Real-World Scenarios</strong><a href="#why-string-interning-matters-in-real-world-scenarios" class="hash-link" aria-label="Direct link to why-string-interning-matters-in-real-world-scenarios" title="Direct link to why-string-interning-matters-in-real-world-scenarios">‚Äã</a></h3>
<p>String interning is <strong>critical in performance-sensitive applications</strong> where <strong>redundant string storage leads to memory overhead and slower lookups</strong>. Here‚Äôs why it matters in real-world scenarios:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="real-world-use-cases"><strong>Real-World Use Cases</strong><a href="#real-world-use-cases" class="hash-link" aria-label="Direct link to real-world-use-cases" title="Direct link to real-world-use-cases">‚Äã</a></h3>
<p>String interning reduces memory usage and improves performance by storing each unique string only once.</p>
<p>The following table highlights some real-world use cases where string interning is beneficial:</p>
<table><thead><tr><th>Use Case</th><th>Example</th></tr></thead><tbody><tr><td>Compiler and Interpreter Optimization</td><td>Rust‚Äôs compiler, Python‚Äôs CPython, and Java‚Äôs JVM use string interning to optimize symbol tables.</td></tr><tr><td>Embedded Systems &amp; IoT</td><td>Logging frameworks like <code>defmt</code> use interning to minimize <strong>flash storage usage</strong> on microcontrollers.</td></tr><tr><td>Web Servers &amp; API Performance</td><td>High-traffic APIs handling millions of requests often receive the same strings (e.g., headers, JSON keys).</td></tr><tr><td>Databases &amp; Search Engines</td><td>Search engines like Elasticsearch and databases like PostgreSQL intern frequently queried strings.</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-it-works"><strong>How It Works</strong><a href="#how-it-works" class="hash-link" aria-label="Direct link to how-it-works" title="Direct link to how-it-works">‚Äã</a></h3>
<ul>
<li><code>InternedString::new()</code> returns an <strong>empty interned string</strong>.</li>
<li><code>InternedString::from(s)</code> interns a string, ensuring uniqueness.</li>
<li><code>as_str()</code>, <code>len()</code>, and <code>is_empty()</code> mimic <code>String</code> methods.</li>
<li>A <strong>global HashMap</strong> stores interned strings, avoiding duplicates.</li>
<li><strong>Thread safety</strong> is ensured using <code>Lazy&lt;Mutex&lt;HashMap&gt;&gt;</code>.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-of-string-interning-in-rust">Implementation of String Interning in Rust<a href="#implementation-of-string-interning-in-rust" class="hash-link" aria-label="Direct link to Implementation of String Interning in Rust" title="Direct link to Implementation of String Interning in Rust">‚Äã</a></h3>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">collections</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">HashMap</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">sync</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token punctuation" style="color:#393A34">{</span><span class="token class-name">Arc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Mutex</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">once_cell</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">sync</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Lazy</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Ensures thread-safe global interner</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[derive(Debug, Clone, PartialEq, Eq, Hash)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token type-definition class-name">InternedString</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    inner</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Arc</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">str</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Global interner (singleton)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">INTERNER</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Lazy</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">Mutex</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">HashMap</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">Arc</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">str</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Lazy</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token plain"> </span><span class="token class-name">Mutex</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">HashMap</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">impl</span><span class="token plain"> </span><span class="token class-name">InternedString</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Creates an empty interned string (similar to `String::new()`)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Self</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">Self</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">intern</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Interns a given string and returns an InternedString</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">from</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">S</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">AsRef</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">str</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">S</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Self</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">Self</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">intern</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">as_ref</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Returns a reference to the interned string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">as_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">str</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">inner</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Returns the length of the interned string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">usize</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">inner</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Checks if the interned string is empty</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">is_empty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">bool</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">inner</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">is_empty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Interns a string, ensuring no duplicates exist</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">intern</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Self</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> interner </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">INTERNER</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">lock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unwrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// If the string is already interned, return the existing reference</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token class-name">Some</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">existing</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> interner</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">keys</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token closure-params">k</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token plain"> k</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">as_ref</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">InternedString</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                inner</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Arc</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">clone</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">existing</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Otherwise, intern the new string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> arc_str </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Arc</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        interner</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">insert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Arc</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">clone</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">arc_str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">InternedString</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> inner</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> arc_str </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[cfg(test)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">mod</span><span class="token plain"> </span><span class="token module-declaration namespace" style="opacity:0.7">tests</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">super</span><span class="token punctuation" style="color:#393A34">::</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attribute attr-name" style="color:#00a4db">#[test]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">test_empty_string</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> empty1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">InternedString</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> empty2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">InternedString</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token macro property" style="color:#36acaa">assert_eq!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">empty1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> empty2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token macro property" style="color:#36acaa">assert!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">empty1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">is_empty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attribute attr-name" style="color:#00a4db">#[test]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">test_interning</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> s1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">InternedString</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;hello&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> s2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">InternedString</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;hello&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> s3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">InternedString</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;world&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token macro property" style="color:#36acaa">assert_eq!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> s2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token macro property" style="color:#36acaa">assert_ne!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> s3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attribute attr-name" style="color:#00a4db">#[test]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">test_string_length</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> s </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">InternedString</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;test&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token macro property" style="color:#36acaa">assert_eq!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attribute attr-name" style="color:#00a4db">#[test]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">test_string_content</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> s </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">InternedString</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;RustLang&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token macro property" style="color:#36acaa">assert_eq!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">as_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;RustLang&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" title="Rust lang" class="tag_zVej tagRegular_sFm0" href="/byte_vault/tags/rust">Rust</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/byte_vault/rust-tips-tricks">Rust tricks for the average developer (me)</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-01-18T00:00:00.000Z">January 18, 2025</time> ¬∑ <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/byte_vault/authors/abeeshake"><img class="avatar__photo authorImage_XqGP" src="https://github.com/TwistingTwists.png" alt="Abhishek Tripathi"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/byte_vault/authors/abeeshake"><span class="authorName_yefp">Abhishek Tripathi</span></a></div><small class="authorTitle_nd0D" title="Curiosity brings awareness.">Curiosity brings awareness.</small><div class="authorSocials_rSDt"><a href="https://x.com/twistin456" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="X"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="none" viewBox="0 0 1200 1227" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf xSvg_y3PF"><path d="M714.163 519.284 1160.89 0h-105.86L667.137 450.887 357.328 0H0l468.492 681.821L0 1226.37h105.866l409.625-476.152 327.181 476.152H1200L714.137 519.284h.026ZM569.165 687.828l-47.468-67.894-377.686-540.24h162.604l304.797 435.991 47.468 67.894 396.2 566.721H892.476L569.165 687.854v-.026Z"></path></svg></a><a href="https://github.com/TwistingTwists" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a></div></div></div></div></div></header><div class="markdown"><h3 class="anchor anchorWithStickyNavbar_LWe7" id="001--str-and-asrefosstr">001 : <code>&amp;str</code> and <code>AsRef&lt;OsStr&gt;</code><a href="#001--str-and-asrefosstr" class="hash-link" aria-label="Direct link to 001--str-and-asrefosstr" title="Direct link to 001--str-and-asrefosstr">‚Äã</a></h3>
<p>The change from:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">load_extension</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<p>to:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">load_extension</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">P</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">AsRef</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">ffi</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">OsStr</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">P</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<p>improves flexibility and usability. The original function only accepted <code>&amp;str</code>, requiring explicit conversion for types like <code>String</code>, <code>PathBuf</code>, or <code>Path</code>. The updated version uses a generic parameter <code>P</code> with the <code>AsRef&lt;std::ffi::OsStr&gt;</code> trait, allowing it to accept any type that can be referenced as an <code>OsStr</code>, such as <code>&amp;str</code>, <code>String</code>, <code>Path</code>, or <code>PathBuf</code>.</p>
<p><strong>Original Implementation:</strong></p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">path</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Path</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> path_str </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/some/path&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> path_ref </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Path</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/another/path&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Example 1: Using String</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">load_extension</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path_str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Example 2: Using &amp;Path</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">load_extension</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">path_ref</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Example 3: Using Path directly</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">load_extension</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Path</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/yet/another/path&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>This reduces boilerplate and improves compatibility with different path types.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" title="Rust lang" class="tag_zVej tagRegular_sFm0" href="/byte_vault/tags/rust">Rust</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/byte_vault/authors/abeeshake/authors/2"><div class="pagination-nav__label">Older entries</div></a></nav></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/byte_vault/">Blog</a></li><li class="footer__item"><a href="https://github.com/TwistingTwists/bytevault" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright 2025 Abhishek Tripathi</div></div></div></footer></div>
</body>
</html>